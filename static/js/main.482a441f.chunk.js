(this.webpackJsonpvitessce=this.webpackJsonpvitessce||[]).push([[0],{1013:function(e,t){},1015:function(e,t){},1033:function(e,t){},1044:function(e,t){},1280:function(e,t){},1310:function(e,t,n){},1313:function(e,t,n){"use strict";n.r(t);n(881);var r=n(47),a=n.n(r),o=n(8),i=n(0),l=n.n(i),c="card card-body my-2 ".concat("tooltip-ancestor"),s="".concat(c," bg-primary"),u="".concat(c," bg-secondary"),p="".concat(c," bg-black"),d="".concat(s," scroll");function f(e){var t=e.title,n=e.preformatted,r=e.unformatted,a=e.theme;return l.a.createElement("div",{className:"vitessce-container vitessce-theme-".concat(a)},l.a.createElement("div",{className:"warning-layout container-fluid"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-12"},l.a.createElement("div",{className:s},l.a.createElement("h1",null,t),l.a.createElement("pre",null,n),l.a.createElement("div",null,r))))))}var m=n(181),h=n.n(m),b=n(1400),v=n(1437),g=n(1429),y=n(46),O=n.n(y),j=n(211),E=n(1398),x=n(846),C=n(490),S=Object(E.a)((function(){return{paper:{maxHeight:200,overflow:"auto",zIndex:1500},span:{width:"70px",textAlign:"center",paddingLeft:"2px",paddingRight:"2px"},popper:{zIndex:4}}})),L={dark:Object(x.a)({palette:{type:"dark",primary:C.a,secondary:C.a,primaryBackground:"#222222",primaryBackgroundHighlight:"#000000",primaryBackgroundInput:"#D3D3D3",primaryBackgroundDim:"#333333",primaryBackgroundLight:"#757575",primaryForeground:"#D3D3D3",primaryForegroundDim:"#000000",primaryForegroundActive:"#9bb7d6",secondaryBackground:"#000000",secondaryBackgroundDim:"#444444",secondaryForeground:"#D3D3D3"},props:{MuiButtonBase:{disableRipple:!0}}}),light:Object(x.a)({palette:{type:"light",primary:C.a,secondary:C.a,primaryBackground:"#F1F1F1",primaryBackgroundHighlight:"#FFFFFF",primaryBackgroundInput:"#FFFFFF",primaryBackgroundDim:"#8A8A8A",primaryBackgroundLight:"#e0e0e0",primaryForeground:"#333333",primaryForegroundDim:"#808080",primaryForegroundActive:"#0074D9",secondaryBackground:"#F1F1F1",secondaryBackgroundDim:"#C0C0C0",secondaryForeground:"#222222"},props:{MuiButtonBase:{disableRipple:!0}}})},w=n(449),T=n(781),_=n(782),k=n(177),I=n(203),A=n(9),N=n(12),P=n(16),R=n(17),M=n(595),G=n(11),D=n(14);function z(e){return Object(G.a)(e).reduce((function(e,t){var n=t[0],r=t[1];return Object.assign(e,Object(D.a)({},n,r))}),{})}function H(e,t,n){return 1===n?e:t}function F(e){return e.charAt(0).toUpperCase()+e.slice(1)}function B(e){var t,n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=[0];function a(){var e=[];r.forEach((function(t){e.unshift(n[t])}));for(var t=!0,a=0;a<r.length;a++){if(!(++r[a]>=n.length)){t=!1;break}r[a]=0}return t&&r.push(0),e.join("")}do{t=a()}while(e.includes(t));return t}function U(e,t){var n=e.data;return Array.isArray(n)?n[t||n.length-1]:n}function X(e){var t=U(e),n=t.shape,r=t.dtype;return 3===n[t.labels.indexOf("c")]&&"Uint8"===r}function Z(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r+1]-e[r]);return Object.entries(t).map((function(t){var r,a=Object(o.a)(t,2),i=a[0],l=a[1];return{i:i,y:l.y,h:l.h||1,x:e[l.x],w:(r=n.slice(l.x,l.x+(l.w||1)),r.reduce((function(e,t){return e+t}),0))}}))}function V(e){var t,n={},r={},a={},i={},l={};if(("components"in e?e.components:e).forEach((function(e,t){var n="".concat("i").concat(t);i[n]={component:e.component,props:e.props||{},coordinationScopes:e.coordinationScopes||{}},l[n]={id:n,x:e.x,y:e.y,w:e.w,h:e.h}})),"components"in e)Object.entries(e.columns).forEach((function(e){var t=Object(o.a)(e,2),i=t[0],c=t[1];n[i]=c[c.length-1],r[i]=Z(c,l),a[i]=i}));else{n.ID=12,r.ID=Z((t=13,Object(G.a)(Array(t).keys())),l),a.ID=1e3}return{cols:n,layouts:r,breakpoints:a,components:i}}var Y=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"componentDidUpdate",value:function(e){this.props.height!==e.height&&this.onWindowResize()}}]),n}(Object(M.WidthProvider)(M.Responsive));function W(e){var t,n=e.layout,r=e.getComponent,a=e.padding,i=e.margin,c=e.draggableHandle,s=e.reactGridLayoutProps,u=e.rowHeight,p=e.theme,d=e.height,f=e.onRemoveComponent,m=e.onLayoutChange,h=V(n),b=h.cols,v=h.layouts,g=h.breakpoints,y=h.components,j=(t=v,Math.max.apply(Math,Object(G.a)(Object.values(t).map((function(e){return Math.max.apply(Math,Object(G.a)(e.map((function(e){return e.y+e.h}))))}))))),E=l.a.createElement("style",null,"\n        ".concat(c," {\n          cursor: grab;\n        }\n        ").concat(c,":active {\n          cursor: grabbing;\n        }\n     ")),x=Object.entries(y).map((function(e,t){var n=Object(o.a)(e,2),a=n[0],i=n[1],c=r(i.component);return l.a.createElement("div",{key:a},l.a.createElement(c,Object.assign({},i.props,{uuid:t,coordinationScopes:i.coordinationScopes,theme:p,removeGridComponent:function(){f(t)}})))}));return v&&y&&g&&b&&l.a.createElement(l.a.Fragment,null,E,l.a.createElement(Y,Object.assign({className:"layout",cols:b,layouts:v,breakpoints:g,height:d,rowHeight:u||(window.innerHeight-2*a-(j-1)*i)/j,containerPadding:[a,a],margin:[i,i],draggableHandle:c,onLayoutChange:function(e){if(e.length===Object.entries(y).length){var t=[];e.forEach((function(e){var n=e.i,r=y[n];if(r){var a=parseInt(n.substring(n.indexOf("i")+1),10),o={x:e.x,y:e.y,w:e.w,h:e.h},i={x:r.x,y:r.y,w:r.w,h:r.h};O()(o,i)||t.push([a,o])}})),t.length>0&&m(t)}}},s),x))}W.defaultProps={padding:10,margin:10};var q=n(178),$=n.n(q),J=function(){function e(t){var n=t.type,r=t.url,a=t.requestInit,o=t.options;Object(A.a)(this,e),this.type=n,this.url=r,this.requestInit=a,this.options=o,this.subscriptions={}}return Object(N.a)(e,[{key:"load",value:function(){throw new Error("The load() method has not been implemented.")}},{key:"subscribe",value:function(e){var t=$()();return this.subscriptions[t]=e,t}},{key:"unsubscribe",value:function(e){delete this.subscriptions[e]}},{key:"publish",value:function(e){Object.values(this.subscriptions).forEach((function(t){t(e)}))}}]),e}(),K=function(){function e(t){Object(A.a)(this,e),this.message=t}return Object(N.a)(e,[{key:"warnInConsole",value:function(){throw new Error("The warnInConsole() method has not been implemented.")}}]),e}(),Q=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e,r,a,o){var i;return Object(A.a)(this,n),(i=t.call(this,"Error HTTP status fetching ".concat(e,"."))).name="LoaderFetchError",i.datasetType=e,i.datasetFileType=r,i.datasetUrl=a,i.responseHeaders=o,i}return Object(N.a)(n,[{key:"warnInConsole",value:function(){var e=this.datasetType,t=this.datasetUrl,n=this.responseHeaders;console.warn("".concat(e," from ").concat(t,": fetch failed"),n)}}]),n}(K),ee=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e,r,a,o){var i;return Object(A.a)(this,n),(i=t.call(this,"Error while validating ".concat(e,"."))).name="LoaderValidationError",i.datasetType=e,i.datasetFileType=r,i.datasetUrl=a,i.reason=o,i}return Object(N.a)(n,[{key:"warnInConsole",value:function(){var e=this.datasetType,t=this.datasetUrl,n=this.reason;console.warn("".concat(e," from ").concat(t,": validation failed"),JSON.stringify(n,null,2))}}]),n}(K),te=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e,r,a){var o;return Object(A.a)(this,n),(o=t.call(this,"Error finding loader for ".concat(e,"."))).name="LoaderNotFoundError",o.datasetType=e,o.datasetFileType=r,o.datasetUrl=a,o}return Object(N.a)(n,[{key:"warnInConsole",value:function(){var e=this.datasetType,t=this.datasetFileType,n=this.datasetUrl;t&&n?console.warn("".concat(e," from ").concat(n,": unable to find loader for fileType ").concat(t)):console.warn("".concat(e,": unable to find loader"))}}]),n}(K),ne=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(A.a)(this,e),this.data=t,this.url=n,this.coordinationValues=r},re={cells:n(783),molecules:n(784),neighborhoods:n(785),raster:I,"cell-sets":k},ae=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;Object(A.a)(this,n),r=t.call(this,e);var a=e.type;return r.schema=re[a],r}return Object(N.a)(n,[{key:"load",value:function(){var e=this,t=this.url,n=this.requestInit,r=this.type,a=this.fileType;return this.data||(this.data=fetch(t,n).then((function(e){return e.ok?e.json():Promise.reject(new Q(r,a,t,e.headers))})).catch((function(e){return Promise.resolve(e)})).then((function(n){if(n instanceof K)return Promise.reject(n);var i=e.validate(n),l=Object(o.a)(i,2),c=l[0],s=l[1];return c?Promise.resolve(new ne(n,t)):Promise.reject(new ee(r,a,t,s))}))),this.data}},{key:"validate",value:function(e){var t=this.schema,n=this.type;if(!t)throw Error("No schema for ".concat(n));var r,a=(new h.a).compile(t),o=a(e);return o||(r=a.errors),[o,r]}}]),n}(J),oe=n(109),ie=n(2),le=n.n(ie),ce=n(13),se=n(38),ue=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;Object(A.a)(this,n),r=t.call(this,e);var a=Object(se.a)(r),o=a.url,i=a.requestInit;return r.store=new oe.a(o,{supportedMethods:["GET"],fetchOptions:i}),r}return Object(N.a)(n,[{key:"getJson",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.store.getItem(t);case 3:return n=e.sent,r=new TextDecoder("utf-8").decode(n),e.abrupt("return",JSON.parse(r));case 8:if(e.prev=8,e.t0=e.catch(0),!(e.t0 instanceof oe.b)){e.next=12;break}return e.abrupt("return",{});case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(J),pe=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"loadAttrs",value:function(){return this.attrs||(this.attrs=this.getJson(".zattrs")),this.attrs}},{key:"loadArr",value:function(){var e=this.store;return this.arr||(this.arr=Object(oe.c)({store:e,path:"/",mode:"r"}).then((function(e){return new Promise((function(t){e.getRaw([null,null]).then(t)}))}))),this.arr}},{key:"load",value:function(){return Promise.all([this.loadAttrs(),this.loadArr()]).then((function(e){return Promise.resolve(new ne(e,null))}))}}]),n}(ue),de=n(53),fe=n(65),me=n(786),he=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).schema=me,r}return Object(N.a)(n,[{key:"load",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,r,a,o,i,l,c,s;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fe.a)(Object(de.a)(n.prototype),"load",this).call(this).catch((function(e){return Promise.resolve(e)}));case 2:if(!((t=e.sent)instanceof K)){e.next=5;break}return e.abrupt("return",Promise.reject(t));case 5:return r=t.data,a=t.url,o=Object.keys(r),i=o.length>0?Object.keys(r[o[0]].cells):[],l={rows:i,cols:o},c=i.flatMap((function(e){return o.map((function(t){return r[t].cells[e]/r[t].max*255}))})),s={data:Uint8Array.from(c)},e.abrupt("return",Promise.resolve(new ne([l,s],a)));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ae),be=n(1401),ve=n(113),ge=n.n(ve),ye=n(787),Oe=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).schema=ye,r}return Object(N.a)(n,[{key:"load",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,r,a,i,l,c,s,u,p,d,f,m;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fe.a)(Object(de.a)(n.prototype),"load",this).call(this).catch((function(e){return Promise.resolve(e)}));case 2:if(!((t=e.sent)instanceof K)){e.next=5;break}return e.abrupt("return",Promise.reject(t));case 5:return r=t.data,a=t.url,i=r.rows,l=r.cols,c=r.matrix,u=[(s={rows:l,cols:i}).rows.length,s.cols.length],p=c.map((function(e){var t=Object(be.a)(e),n=Object(o.a)(t,2),r=n[0],a=n[1];return e.map((function(e){return Math.floor((e-r)/(a-r)*255)}))})),d=ge()(u[0]).map((function(e){return ge()(u[1]).map((function(t){return p[t][e]}))})),f=d.flat(),m={data:Uint8Array.from(f)},e.abrupt("return",Promise.resolve(new ne([s,m],a)));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ae),je=n(19),Ee=n(69),xe=n(807),Ce=n.n(xe),Se=n(105),Le=n(1431),we=n(45),Te=n(808),_e={cell:{latestVersion:"0.1.3",schema:k}},ke={cell:{schema:Te}};function Ie(e,t,n,r){return{coordinateSystem:we.a.CARTESIAN,data:e,pickable:!0,autoHighlight:!0,stroked:!0,filled:!0,getElevation:0,onHover:function(e){if(r&&r(),e.object){var a=Object(o.a)(e.object,2),i=a[0],l=a[1].factors;t&&t((c=void 0===l?{}:l,Object.entries(c).map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join("; "))),n&&n(i)}else n&&n("");var c}}}var Ae=[128,128,128],Ne=[[68,119,170],[136,204,238],[68,170,153],[17,119,51],[153,153,51],[221,204,119],[204,102,119],[136,34,85],[170,68,153]],Pe=[[0,0,255],[0,255,0],[255,0,255],[255,255,0],[0,255,255],[255,255,255],[255,128,0],[255,0,0]],Re=["viridis","greys","magma","jet","hot","bone","copper","summer","density","inferno"],Me={webgl2:!0};function Ge(e,t){var n=1;if(e)for(;e.find((function(e){return e.name==="".concat(t).concat(n)}));)n++;return"".concat(t).concat(n)}function De(e,t,n,r,a,o,i){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"Selection ",c="My Selections",s=null===t||void 0===t?void 0:t.tree.find((function(e){return e.name===c})),u={version:_e.cell.latestVersion,datatype:"cell",tree:Object(G.a)(t?t.tree:[])},p=Ge(null===s||void 0===s?void 0:s.children,l),d=0;s?(d=s.children.length,s.children.push({name:p,set:e.map((function(e){return[e,null]}))})):u.tree.push({name:c,children:[{name:p,set:e.map((function(e){return[e,null]}))}]}),a(u);var f=["My Selections",p];o([].concat(Object(G.a)(n||[]),[{path:f,color:Ne[d%Ne.length]}])),r([f]),i("cellSetSelection")}function ze(e,t){return{version:_e.cell.latestVersion,datatype:"cell",tree:[].concat(Object(G.a)(e?e.tree:[]),Object(G.a)(t?t.tree:[]))}}function He(e){return{__esModule:!0,default:e}}var Fe=["z","t"],Be={visible:!0,colormap:null,opacity:1,domainType:"Min/Max",transparentColor:[0,0,0],renderingMode:Ee.e.ADDITIVE,use3d:!1},Ue={opacity:1,radius:20,visible:!0},Xe={opacity:1,radius:50,visible:!0,stroked:!1},Ze={visible:!1},Ve=n(32),Ye=n(679),We=n(680),qe=n(326),$e=n(25);function Je(e,t,n){for(var r=Object(G.a)(e),a=0;a<n;a+=1)r.push(t);return r}var Ke=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"getShaders",value:function(){return{fs:"\n#define SHADER_NAME bitmask-layer-fragment-shader\nprecision highp float;\n\n// Data (mask) texture\nuniform sampler2D channel0;\nuniform sampler2D channel1;\nuniform sampler2D channel2;\nuniform sampler2D channel3;\nuniform sampler2D channel4;\nuniform sampler2D channel5;\n\n// Color texture\nuniform sampler2D colorTex;\nuniform float colorTexHeight;\nuniform float colorTexWidth;\nuniform float hovered;\n// range\nuniform bool channelIsOn[6];\n\n// opacity\nuniform float opacity;\n\nvarying vec2 vTexCoord;\n\nvec4 sampleAndGetColor(sampler2D dataTex, vec2 coord, bool isOn){\n  float sampledData = texture(dataTex, coord).r;\n  vec4 hoveredColor = float(sampledData == hovered && sampledData > 0. && hovered > 0.) * vec4(0., 0., 1., 1.);\n  // Colors are laid out corresponding to ids in row-major order in the texture.  So if width of the texture is 10, and you want ID 25,\n  // you need coordinate (1, 4) (i.e 2 rows down, and 5 columns over indexed from 0 for a total of 25 units covered in row major order).\n  vec2 colorTexCoord = vec2(mod(sampledData, colorTexWidth) / colorTexWidth, floor(sampledData / colorTexWidth) / (colorTexHeight - 1.));\n  vec4 sampledColor = vec4(texture(colorTex, colorTexCoord).rgb, 1.);\n  // Only return a color if the data is non-zero.\n  return max(0., min(sampledData, 1.)) * float(isOn) * (sampledColor + hoveredColor);\n}\n\nvoid main() {\n\n  gl_FragColor = sampleAndGetColor(channel0, vTexCoord, channelIsOn[0]);\n\n  // If the sampled color and the currently stored color (gl_FragColor) are identical, don't blend and use the sampled color,\n  // otherwise just use the currently stored color.  Repeat this for all channels.\n  vec4 sampledColor = sampleAndGetColor(channel1, vTexCoord, channelIsOn[1]);\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\n  sampledColor = sampleAndGetColor(channel2, vTexCoord, channelIsOn[2]);\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\n  sampledColor = sampleAndGetColor(channel3, vTexCoord, channelIsOn[3]);\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\n  sampledColor = sampleAndGetColor(channel4, vTexCoord, channelIsOn[4]);\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\n  sampledColor = sampleAndGetColor(channel5, vTexCoord, channelIsOn[5]);\n  gl_FragColor = (sampledColor == gl_FragColor || sampledColor == vec4(0.)) ? gl_FragColor : sampledColor;\n  // Apply the opacity if there is pixel data, and if the pixel data is empty i.e no segmentation, use 0 opacity.\n  gl_FragColor = vec4(gl_FragColor.rgb, (gl_FragColor.rgb == vec3(0., 0., 0.)) ? 0.0 : opacity);\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",vs:"\n#define SHADER_NAME bitmask-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute vec3 instancePickingColors;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vTexCoord = texCoords;\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",modules:[Ye.a,We.a]}}},{key:"updateState",value:function(e){var t,r,a=e.props,o=e.oldProps,i=e.changeFlags;Object(fe.a)(Object(de.a)(n.prototype),"updateState",this).call(this,{props:a,oldProps:o,changeFlags:i}),(null===(t=a.cellColor)||void 0===t?void 0:t.data)!==(null===(r=o.cellColor)||void 0===r?void 0:r.data)&&this.setColorTexture()}},{key:"setColorTexture",value:function(){var e,t=this.props.cellColor,n=t.height,r=t.width,a=t.data,o=new qe.a(this.context.gl,{width:r,height:n,data:a,mipmaps:!1,parameters:(e={},Object(D.a)(e,Ve.default.TEXTURE_MIN_FILTER,Ve.default.NEAREST),Object(D.a)(e,Ve.default.TEXTURE_MAG_FILTER,Ve.default.NEAREST),Object(D.a)(e,Ve.default.TEXTURE_WRAP_S,Ve.default.CLAMP_TO_EDGE),Object(D.a)(e,Ve.default.TEXTURE_WRAP_T,Ve.default.CLAMP_TO_EDGE),e),format:Ve.default.RGB,dataFormat:Ve.default.RGB,type:Ve.default.UNSIGNED_BYTE});this.setState({colorTex:o})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,r=n.channelIsOn,a=n.hoveredCell,o=this.state,i=o.textures,l=o.model,c=o.colorTex;i&&l&&c&&l.setUniforms(Object.assign({},t,Object(je.a)({hovered:a||0,colorTex:c,colorTexHeight:c.height,colorTexWidth:c.width,channelIsOn:Je(r,!1,6-r.length)},i))).draw()}},{key:"dataToTexture",value:function(e,t,n){var r,a=Object($e.j)(this.context.gl);return new qe.a(this.context.gl,{width:t,height:n,data:new Float32Array(e),mipmaps:!1,parameters:(r={},Object(D.a)(r,Ve.default.TEXTURE_MIN_FILTER,Ve.default.NEAREST),Object(D.a)(r,Ve.default.TEXTURE_MAG_FILTER,Ve.default.NEAREST),Object(D.a)(r,Ve.default.TEXTURE_WRAP_S,Ve.default.CLAMP_TO_EDGE),Object(D.a)(r,Ve.default.TEXTURE_WRAP_T,Ve.default.CLAMP_TO_EDGE),r),format:a?Ve.default.R32F:Ve.default.LUMINANCE,dataFormat:a?Ve.default.RED:Ve.default.LUMINANCE,type:Ve.default.FLOAT})}}]),n}(Ee.h);function Qe(e){return et.apply(this,arguments)}function et(){return(et=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o,i,l,c;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,a=Array.isArray(n)?n[n.length-1]:n,e.next=4,a.getRaster({selection:r});case 4:return o=e.sent,i=Object(Ee.j)(o.data),l=i.domain,c=i.autoSliders,e.abrupt("return",{domain:l,slider:c});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(e){return nt.apply(this,arguments)}function nt(){return(nt=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o,i,l,c,s,u,p,d,f;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,a=n[n.length-1],o=a.shape,i=a.labels,l=o[i.indexOf("z")]>>n.length-1,e.next=6,a.getRaster({selection:Object(je.a)({},r,{z:0})});case 6:return c=e.sent,e.next=9,a.getRaster({selection:Object(je.a)({},r,{z:Math.floor(l/2)})});case 9:return s=e.sent,e.next=12,a.getRaster({selection:Object(je.a)({},r,{z:l-1})});case 12:return u=e.sent,p=Object(Ee.j)(c.data),d=Object(Ee.j)(s.data),f=Object(Ee.j)(u.data),e.abrupt("return",{domain:[Math.min(p.domain[0],d.domain[0],f.domain[0]),Math.max(p.domain[1],d.domain[1],f.domain[1])],slider:[Math.min(p.autoSliders[0],d.autoSliders[0],f.autoSliders[0]),Math.max(p.autoSliders[1],d.autoSliders[1],f.autoSliders[1])]});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Ke.layerName="BitmaskLayer",Ke.defaultProps={hoveredCell:{type:"number",value:null,compare:!0},cellColor:{type:"object",value:null,compare:!0}};var rt=function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,a=t.use3d,o=a?tt:Qe,e.abrupt("return",o({loader:n,selection:r}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),at=function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o,i,l;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selections,a=t.use3d,e.next=3,Promise.all(r.map((function(e){return rt({loader:n,selection:e,use3d:a})})));case 3:return o=e.sent,i=o.map((function(e){return e.domain})),l=o.map((function(e){return e.slider})),e.abrupt("return",{domains:i,sliders:l});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function ot(e){var t=Array.isArray(e)?e[0]:e,n=t.shape,r=t.labels,a=function(e){var t,n,r=null!==(t=null===e||void 0===e||null===(n=e.meta)||void 0===n?void 0:n.physicalSizes)&&void 0!==t?t:{},a=r.x,o=r.y,i=r.z;if((null===a||void 0===a?void 0:a.size)&&(null===o||void 0===o?void 0:o.size)&&(null===i||void 0===i?void 0:i.size)){var l=Math.min(i.size,a.size,o.size),c=[a.size/l,o.size/l,i.size/l];return(new Se.Matrix4).scale(c)}return(new Se.Matrix4).identity()}(t);return[[0,a[0]*n[r.indexOf("x")]],[0,a[5]*n[r.indexOf("y")]],[0,a[10]*n[r.indexOf("z")]]]}function it(e){for(var t=[],n=function(e){var t=e.labels.filter((function(e){return Fe.includes(e)})),n={};return t.forEach((function(t){n[t]=Math.floor((e.shape[e.labels.indexOf(t)]||0)/2)})),n}(e),r=e.labels.filter((function(t){return!Fe.includes(t)&&e.shape[e.labels.indexOf(t)]}))[0],a=0;a<Math.min(4,e.shape[e.labels.indexOf(r)]);a+=1)t.push(Object(je.a)(Object(D.a)({},r,a),n));return t}function lt(e){var t=e[e.length-1];return 3===t||4===t}function ct(e,t){return st.apply(this,arguments)}function st(){return(st=Object(ce.a)(le.a.mark((function e(t,n){var r,a,o,i,l,c,s;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],a=U(t),o=it(a),o=lt(a.shape)?[Object(je.a)({},o[0],{c:0})]:o,e.next=6,at({loader:t.data,selections:o,use3d:n});case 6:return i=e.sent,l=X(t)?[[0,255],[0,255],[0,255]]:i.domains,c=X(t)?[[255,0,0],[0,255,0],[0,0,255]]:null,s=X(t)?[[0,255],[0,255],[0,255]]:i.sliders,o.forEach((function(e,t){var n=l[t],a=s[t],i={selection:e,color:c?c[t]:1!==o.length?Pe[t]:[255,255,255],visible:!0,slider:a||n};r.push(i)})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(e,t){var n=t.map((function(e){return U(e)}));if(e.map((function(e){var t,n,r,a,o,i;return(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(n=t.transform)||void 0===n?void 0:n.matrix)||(null===e||void 0===e||null===(r=e.metadata)||void 0===r||null===(a=r.transform)||void 0===a?void 0:a.scale)||(null===e||void 0===e||null===(o=e.metadata)||void 0===o||null===(i=o.transform)||void 0===i?void 0:i.translate)})).some(Boolean)||n.every((function(e){var t,n,r,a;return!(null===(t=e.meta)||void 0===t||null===(n=t.physicalSizes)||void 0===n?void 0:n.x)||!(null===(r=e.meta)||void 0===r||null===(a=r.physicalSizes)||void 0===a?void 0:a.y)})))return e;var r=n.reduce((function(e,t){var n,r,a,o,i,l,c,s,u,p=null===(n=t.meta)||void 0===n||null===(r=n.physicalSizes)||void 0===r||null===(a=r.z)||void 0===a?void 0:a.size,d=[Object(Le.c)("".concat(null===(o=t.meta)||void 0===o?void 0:o.physicalSizes.x.size," ").concat(null===(i=t.meta)||void 0===i?void 0:i.physicalSizes.x.unit).replace("\xb5","u")),Object(Le.c)("".concat(null===(l=t.meta)||void 0===l?void 0:l.physicalSizes.y.size," ").concat(null===(c=t.meta)||void 0===c?void 0:c.physicalSizes.y.unit).replace("\xb5","u"))];p&&d.push(Object(Le.c)("".concat(null===(s=t.meta)||void 0===s?void 0:s.physicalSizes.z.size," ").concat(null===(u=t.meta)||void 0===u?void 0:u.physicalSizes.z.unit).replace("\xb5","u")));return e[0]=void 0===e[0]||-1===Object(Le.a)(d[0],e[0])?d[0]:e[0],e[1]=void 0===e[1]||-1===Object(Le.a)(d[1],e[1])?d[1]:e[1],e[2]=void 0===e[2]||-1===Object(Le.a)(d[2],e[2])?d[2]:e[2],e}),[]);return e.map((function(e,t){var a,o,i,l,c,s,u,p,d,f=n[t],m=null===(a=f.meta)||void 0===a||null===(o=a.physicalSizes)||void 0===o||null===(i=o.z)||void 0===i?void 0:i.size,h=[Object(Le.c)("".concat(null===(l=f.meta)||void 0===l?void 0:l.physicalSizes.x.size," ").concat(null===(c=f.meta)||void 0===c?void 0:c.physicalSizes.x.unit).replace("\xb5","u")),Object(Le.c)("".concat(null===(s=f.meta)||void 0===s?void 0:s.physicalSizes.y.size," ").concat(null===(u=f.meta)||void 0===u?void 0:u.physicalSizes.y.unit).replace("\xb5","u"))];m&&h.push(Object(Le.c)("".concat(null===(p=f.meta)||void 0===p?void 0:p.physicalSizes.z.size," ").concat(null===(d=f.meta)||void 0===d?void 0:d.physicalSizes.z.unit).replace("\xb5","u")));var b=h.map((function(e,t){return Object(Le.b)(e,r[t])}));if(b[2]||(b[2]=1),O()(b,[1,1,1]))return e;var v=(new Se.Matrix4).scale(Object(G.a)(b)),g=Object(je.a)({},e);return g.metadata=Object(je.a)({},g.metadata,{transform:{matrix:v.toArray()}}),g}))}function pt(e,t,n){return dt.apply(this,arguments)}function dt(){return(dt=Object(ce.a)(le.a.mark((function e(t,n,r){var a,o,i,l,c,s,u,p,d,f,m,h,b,v;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],o=[],i=[],e.next=5,Promise.all(t.map((function(e){return e.loaderCreator()})));case 5:for(l=e.sent,c=0;c<t.length;c++)s=t[c],u=l[c],a[c]=u,o[c]=s;if(r&&(o=ut(o,a)),n)for(m=n.map((function(e){return t.findIndex((function(t){return t.name===e}))})),h=function(e){var t=m[e],n=ct(a[t]).then((function(n){var r,a,i,l,c;return Promise.resolve(Object(je.a)({type:(null===(r=o[t])||void 0===r||null===(a=r.metadata)||void 0===a?void 0:a.isBitmask)?"bitmask":"raster",index:t},Be,{channels:n.map((function(e,n){return Object(je.a)({},e,{},o[t].channels?o[t].channels[n]:[])})),domainType:"Min/Max",modelMatrix:null===(i=o[t])||void 0===i||null===(l=i.metadata)||void 0===l||null===(c=l.transform)||void 0===c?void 0:c.matrix,transparentColor:e>0?[0,0,0]:null}))}));i.push(n)},b=0;b<m.length;b++)h(b);else p=Math.floor(t.length/2),d=a[p],f=ct(d).then((function(e){var t,n,r,a,i;return Promise.resolve(Object(je.a)({type:(null===(t=o[p])||void 0===t||null===(n=t.metadata)||void 0===n?void 0:n.isBitmask)?"bitmask":"raster",index:p},Be,{channels:e.map((function(e,t){return Object(je.a)({},e,{},o[p].channels?o[p].channels[t]:[])})),modelMatrix:null===(r=o[p])||void 0===r||null===(a=r.metadata)||void 0===a||null===(i=a.transform)||void 0===i?void 0:i.matrix,transparentColor:p>0?[0,0,0]:null}))})),i.push(f);return e.next=11,Promise.all(i);case 11:return v=e.sent,e.abrupt("return",[v,a,o]);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ft(e){var t=e.tile,n=t.bbox,r=n.left,a=n.top,i=n.right,l=n.bottom,c=t.x,s=t.y,u=t.z,p=e.data,d=e.id,f=e.loader;if([r,l,i,a].some((function(e){return e<0}))||!p)return null;var m=f[0],h=f[0].shape.slice(-2),b=Object(o.a)(h,2),v=b[0],g=b[1],y=[r,p.height<m.tileSize?v:l,p.width<m.tileSize?g:i,a];return new Ke(e,{channelData:p,cellColor:{data:e.cellColorData,height:e.cellColorHeight,width:e.cellColorWidth},bounds:y,id:"sub-layer-".concat(y,"-").concat(d),tileId:{x:c,y:s,z:u}})}function mt(e){return ht.apply(this,arguments)}function ht(){return(ht=Object(ce.a)(le.a.mark((function e(t){var n,r,a,i,l,c,s,u,p,d,f,m,h,b,v,g,y,O,j,E,x,C,S,L,w,T,_,k,I;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.type,r=t.url,a=t.metadata,i=t.requestInit,e.t0=n,e.next="zarr"===e.t0?4:"ome-tiff"===e.t0?30:53;break;case 4:if(c=(l=a||{}).dimensions,s=l.isPyramid,u=l.transform,p=c.map((function(e){return e.field})),!s){e.next=25;break}return f="".concat(r).concat("/"===r.slice(-1)?"":"/",".zmetadata"),e.next=10,fetch(f);case 10:return m=e.sent,e.next=13,m.json();case 13:return h=e.sent,b=h.metadata,v=Object.keys(b).filter((function(e){return e.includes(".zarray")})).map((function(e){return e.slice(0,-7)})),e.next=18,Promise.all(v.map((function(e){return Object(oe.c)({store:r,path:e})})));case 18:g=e.sent,y=g[0].chunks.slice(-2),O=Object(o.a)(y,2),j=O[0],E=O[1],x=Math.min(j,E),C=Math.pow(2,Math.floor(Math.log2(x))),d=g.map((function(e){return new Ee.i(e,p,C)})),e.next=29;break;case 25:return e.next=27,Object(oe.c)({store:r});case 27:S=e.sent,d=new Ee.i(S,p);case 29:return e.abrupt("return",{data:d,metadata:{dimensions:c,transform:u},channels:(c.find((function(e){return"channel"===e.field}))||c[0]).values});case 30:if(!a||!("omeTiffOffsetsUrl"in a)){e.next=47;break}return w=a.omeTiffOffsetsUrl,e.next=34,fetch(w,i||{});case 34:if(!(T=e.sent).ok){e.next=44;break}return e.next=38,T.json();case 38:return _=e.sent,e.next=41,Object(Ee.l)(r,{offsets:_,headers:null===i||void 0===i?void 0:i.headers});case 41:L=e.sent,e.next=45;break;case 44:throw new Error("Offsets not found but provided.");case 45:e.next=50;break;case 47:return e.next=49,Object(Ee.l)(r,{headers:null===i||void 0===i?void 0:i.headers});case 49:L=e.sent;case 50:return k=L.metadata.Pixels.Channels,I=Array.isArray(k)?k.map((function(e,t){return e.Name||"Channel ".concat(t)})):[k.Name||"Channel ".concat(0)],e.abrupt("return",Object(je.a)({},L,{channels:I}));case 53:throw Error("Image type (".concat(n,") is not supported"));case 54:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var bt=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;Object(A.a)(this,n),r=t.call(this,e);var a=e.url,o=e.options;return!a&&o&&(r.url=URL.createObjectURL(new Blob([JSON.stringify(o)])),r.options=void 0),r.schema=I,r}return Object(N.a)(n,[{key:"load",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,r,a,i,l,c,s,u;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fe.a)(Object(de.a)(n.prototype),"load",this).call(this).catch((function(e){return Promise.resolve(e)}));case 2:if(!((t=e.sent)instanceof K)){e.next=5;break}return e.abrupt("return",Promise.reject(t));case 5:return r=t.data,a=r.images,i=r.renderLayers,l=r.usePhysicalSizeScaling,c=void 0!==l&&l,s=a.filter((function(e){return!e.url.includes("zarr")})).map((function(e){return[e.url,e.name]})),u=a.map((function(e){return Object(je.a)({},e,{loaderCreator:function(){var t=Object(ce.a)(le.a.mark((function t(){return le.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",mt(e));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()})})),this.autoImageCache||(this.autoImageCache=pt(u,i,c)),e.abrupt("return",this.autoImageCache.then((function(e){var t=Object(o.a)(e,3),n=t[0],r=t[1],a=t[2];return new ne({loaders:r,meta:a},s,{spatialRasterLayers:n})})));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ae);function vt(e){var t=/^#?([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})$/i.exec(e);return[parseInt(t[1].toLowerCase(),16),parseInt(t[2].toLowerCase(),16),parseInt(t[3].toLowerCase(),16)]}var gt=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"load",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n,r,a,i,l,c,s,u,p,d,f,m,h,b,v,g;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getJson(".zattrs").catch((function(e){return Promise.resolve(e)}));case 2:if(!((r=e.sent)instanceof K)){e.next=5;break}return e.abrupt("return",Promise.reject(r));case 5:return e.next=7,Object(Ee.m)(this.url,{fetchOptions:this.requestInit,type:"multiscales"});case 7:if(a=e.sent,i=a.metadata,l=i.omero){e.next=13;break}return console.error("Path for image not valid"),e.abrupt("return",Promise.reject(r));case 13:return c=l.rdefs,s=l.channels,u=null!==(t=c.defaultT)&&void 0!==t?t:0,p=null!==(n=c.defaultZ)&&void 0!==n?n:0,d=[{name:l.name,channels:s.map((function(e,t){return{selection:{z:p,t:u,c:t},slider:[e.window.start,e.window.end],color:vt(e.color)}})),loaderCreator:function(){var e=Object(ce.a)(le.a.mark((function e(){return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(je.a)({},a,{channels:s.map((function(e){return e.label}))}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],e.next=19,pt(d,void 0);case 19:return f=e.sent,m=Object(o.a)(f,3),h=m[0],b=m[1],v=m[2],g={spatialRasterLayers:h},e.abrupt("return",Promise.resolve(new ne({loaders:b,meta:v},[],g)));case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ue),yt=n(373),Ot=n.n(yt),jt=n(1407),Et=n(809),xt=n(468),Ct=n.n(xt);function St(e,t,n){e.key===t&&(e.preventDefault(),n())}function Lt(e){return Ct()({r:e[0],g:e[1],b:e[2]}).toHexString()}function wt(e){var t=Ct()(e).toRgb();return[t.r,t.g,t.b]}function Tt(e){if(0===e)return"Color by hierarchy";if(e<=2){return"Color by ".concat("sub".repeat(e-1),"cluster")}return"Color by cluster level ".concat(e)}function _t(e,t){return e.length<=t.length&&O()(e,t.slice(0,e.length))}function kt(e,t,n){return _t(e,t)?[].concat(Object(G.a)(n),Object(G.a)(t.slice(n.length))):t}function It(e){return e.join("___")}var At=n(52),Nt=n(353),Pt=n.n(Nt),Rt=n(810),Mt=n.n(Rt);function Gt(e){return e?e.children?e.children.flatMap((function(e){return Gt(e)})):e.set||[]:[]}function Dt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.children)return t;var n=t+1,r=e.children.map((function(e){return Dt(e,n)}));return Math.max.apply(Math,Object(G.a)(r).concat([n]))}function zt(e,t){var n=e.tree.map((function(e){return function e(t,n,r){var a=n[r];if(t.name===a){if(r===n.length-1)return t;if(t.children){var o=t.children.map((function(t){return e(t,n,r+1)})).filter(Boolean);if(1===o.length)return o[0]}}return null}(e,t,0)})).filter(Boolean);return 1===n.length?n[0]:null}function Ht(e,t,n,r,a){var o;return o=a?Object(G.a)(a):[e.name],t(e,o)?(r.push(o),n(e,o)):e.children?Object(je.a)({},e,{children:e.children.map((function(e){return Ht(e,t,n,r,o.concat([e.name]))}))}):e}function Ft(e,t){return Object(je.a)({},e,{children:[].concat(Object(G.a)(e.children),[t])})}function Bt(e,t){var n=t.map((function(t){return zt(e,t)})).map((function(e){return Gt(e).map((function(e){return Object(o.a)(e,1)[0]}))}));return n.reduce((function(e,t){return e.concat(t.filter((function(t){return!e.includes(t)})))}),n[0]||[])}function Ut(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e.children?0===t?[[].concat(Object(G.a)(n),[e.name])]:e.children.flatMap((function(a){return Ut(a,t-1,[].concat(Object(G.a)(n),[e.name]),r)})).filter(Boolean):r?[[].concat(Object(G.a)(n),[e.name])]:null}function Xt(e,t){return{version:_e[t].latestVersion,datatype:t,tree:e.tree}}function Zt(e,t,n,r){var a=zt(e,t),o=function e(t,n,r,a,o){var i;i=o?Object(G.a)(o):[t.name];var l=t;return n(t,i)&&(a.push(i),l=r(t,i)),t.children?Object(je.a)({},l,{children:l.children.map((function(t){return e(t,n,r,a,i.concat([t.name]))}))}):l}(a,(function(){return!0}),(function(e,t){var n,a,o=null!==(n=null===r||void 0===r||null===(a=r.find((function(e){return O()(e.path,t)})))||void 0===a?void 0:a.color)&&void 0!==n?n:Ae;return Object(je.a)({},e,{color:o.slice(0,3)})}),[]);return{treeToExport:Xt(Object(je.a)({},e,{tree:[o]}),n),nodeName:a.name}}function Vt(e){return{version:_e[e].latestVersion,datatype:e,tree:[]}}function Yt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[128,128,128];return[(e[0]-n[0])*t+n[0],(e[1]-n[1])*t+n[1],(e[2]-n[2])*t+n[2]]}function Wt(e,t,n){var r=[];return t.forEach((function(t){var a=zt(e,t);if(a){var o,i=Gt(a),l=(null===(o=n.find((function(e){return O()(e.path,t)})))||void 0===o?void 0:o.color)||Ae;r.push({key:$()(),name:a.name,size:i.length,color:l})}})),r}function qt(e,t,n){return O()([].concat(Object(G.a)(t),[e.name]),n)?null:e.children?Object(je.a)({},e,{children:e.children.map((function(r){return qt(r,[].concat(Object(G.a)(t),[e.name]),n)})).filter(Boolean)}):e}function $t(e,t){var n=[],r=[],a=!1;function o(e,t){n.push([].concat(Object(G.a)(t),[e.name])),e.children&&e.children.forEach((function(n){return o(n,[].concat(Object(G.a)(t),[e.name]))}))}return e.tree.forEach((function(e){return o(e,[])})),t.tree.forEach((function(e){return t=e,n=[],r.push([].concat(Object(G.a)(n),[t.name])),void(t.children&&t.children.forEach((function(e){return o(e,[].concat(Object(G.a)(n),[t.name]))})));var t,n})),r.forEach((function(e){n.find((function(t){return O()(t,e)}))&&(a=!0)})),a}function Jt(e,t){var n=Object(G.a)(t||[]),r=e.tree.map((function(e){return Array.from({length:Dt(e)+1}).fill(0)}));return e.tree.forEach((function(e,t){return function e(t,a,o,i){var l=r[i][o],c=[].concat(Object(G.a)(a),[t.name]);n.find((function(e){return O()(e.path,c)}))||n.push({path:c,color:Ne[l%Ne.length]}),r[i][o]+=1,t.children&&t.children.forEach((function(t){return e(t,c,o+1,i)}))}(e,[],0,t)})),n}function Kt(e){var t=e.cells,n=e.mapping,r=e.cellSets,a=e.cellSetSelection,i=e.cellSetColor;return a&&a.length>0&&r&&t?function(e,t,n,r,a){var i=[];return r.forEach((function(r){var l=zt(e,r);if(l){var c,s=Gt(l),u=(null===a||void 0===a||null===(c=a.find((function(e){return O()(e.path,r)})))||void 0===c?void 0:c.color)||Ae,p=s.map((function(e){var r,a,i=Object(o.a)(e,1)[0];return[null===(r=t[i])||void 0===r?void 0:r.mappings[n][0],-(null===(a=t[i])||void 0===a?void 0:a.mappings[n][1])]})).filter((function(e){return e.every((function(e){return"number"===typeof e}))}));if(p.length>2){var d=Object(At.featureCollection)(p.map(At.point)),f=Mt()(p,1/0);if(f){var m=Pt()(d).geometry.coordinates;i.push({path:r,name:r[r.length-1],hull:f,color:u,centroid:m})}}}})),i}(r,t,n,a,i):[]}function Qt(e,t){var n=(new h.a).compile(_e[t].schema);if(!n(e)){var r=JSON.stringify(n.errors,null,2);throw new Error("Tree validation failed: ".concat(r))}if(e.datatype!==t)throw new Error("The data type does not match the expected data type of '".concat(t,"'."));return"0.1.2"===e.version?Object(je.a)({},e,{version:_e[t].latestVersion,tree:e.tree.map((function(e){return Ht(e,(function(e){return!e.children&&Array.isArray(e.set)}),(function(e){return Object(je.a)({},e,{set:e.set.map((function(e){return[e,null]}))})}),[])}))}):e}function en(e,t){var n=JSON.parse(e);return n=Qt(n,t)}function tn(e,t){var n=Object(jt.a)(",").parse(e,(function(e){return{groupName:e.groupName,setName:e.setName,setColor:e.setColor?wt(e.setColor):Ae,obsId:e.obsId,predictionScore:Ot()(e.predictionScore)||"NA"===e.predictionScore?null:+e.predictionScore}})),r=(new h.a).compile(ke[t].schema);if(r(n)){var a={version:_e[t].latestVersion,datatype:t,tree:[]};return Array.from(new Set(n.map((function(e){return e.groupName})))).forEach((function(e){var t={name:e,children:[]},r=n.filter((function(t){return t.groupName===e}));Array.from(new Set(r.map((function(e){return e.setName})))).forEach((function(e){var n=r.filter((function(t){return t.setName===e})),a=n[0].setColor,o={name:e,color:a,set:n.map((function(e){return[e.obsId,e.predictionScore]}))};t.children.push(o)})),a.tree.push(t)})),a}var o=JSON.stringify(r.errors,null,2);throw new Error("Import validation failed: ".concat(o))}function nn(e){var t=JSON.stringify(e);return"data:".concat("application/json",";charset=utf-8,").concat(encodeURIComponent(t))}function rn(e,t){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove()}var an=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).schema=k,r}return Object(N.a)(n,[{key:"load",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,r,a,o,i,l,c,s,u;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(fe.a)(Object(de.a)(n.prototype),"load",this).call(this).catch((function(e){return Promise.resolve(e)}));case 2:if(!((t=e.sent)instanceof K)){e.next=5;break}return e.abrupt("return",Promise.reject(t));case 5:return r=t.data,a=t.url,o=Qt(r,"cell"),i={cellSetSelection:[],cellSetColor:[]},o&&o.tree.length>=1&&(l=o.tree,c=l[0].name,s=l[0].children.map((function(e){return[c,e.name]})),u=Jt(o,[]),i.cellSetSelection=s,i.cellSetColor=u),e.abrupt("return",Promise.resolve(new ne(o,a,i)));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ae),on=function(e){if(4!==e.length)throw new Error("readFloat32 only takes in length 4 byte buffers");return new Int32Array(e.buffer)[0]};function ln(e){var t=new TextDecoder,n=0,r=n+e.length,a=on(e.slice(n,4));if(e.length<4)throw new Error("corrupt buffer, missing or truncated header");n+=4;for(var o=new Array(a),i=0;i<a;i+=1){if(n+4>r)throw new Error("corrupt buffer, data seem truncated");var l=on(e.slice(n,n+4));if((n+=4)+l>r)throw new Error("corrupt buffer, data seem truncated");o[i]=t.decode(e.slice(n,n+l)),n+=l}return o}var cn,sn=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"loadCellSetIds",value:function(e){var t=this,n=this.store;return this.cellSets||(this.cellSets=Promise.all(e.map(function(){var e=Object(ce.a)(le.a.mark((function e(r){var a,o,i,l,c,s,u,p;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getJson("".concat(r,"/.zattrs"));case 2:if(a=e.sent,!(o=a.categories)){e.next=13;break}return e.next=7,t.getJson("/obs/".concat(o,"/.zarray"));case 7:if(l=e.sent,"|O"!==l.dtype){e.next=13;break}return e.next=12,t.getFlatArrDecompressed("/obs/".concat(o));case 12:i=e.sent;case 13:return e.next=15,Object(oe.c)({store:n,path:r,mode:"r"});case 15:return c=e.sent,e.next=18,c.get();case 18:return s=e.sent,u=s.data,p=Array.from(u).map((function(e){return i?i[e]:String(e)})),e.abrupt("return",p);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))),this.cellSets}},{key:"loadNumeric",value:function(e){var t=this.store;return Object(oe.c)({store:t,path:e,mode:"r"}).then((function(e){return e.get()}))}},{key:"getFlatArrDecompressed",value:function(e){var t=this.store;return Object(oe.c)({store:t,path:e,mode:"r"}).then(function(){var e=Object(ce.a)(le.a.mark((function e(n){var r,a,i,l,c,s,u;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){var t=ln(e);r=r?r.concat(t):t},i=function(e){if(r){var t=new Uint8Array(e.buffer.byteLength+r.buffer.byteLength);t.set(new Uint8Array(r.buffer),0),t.set(e,r.buffer.byteLength),r=t}else r=e},l=Math.ceil(n.meta.shape[0]/n.meta.chunks[0]),c=ge()(l).map(function(){var e=Object(ce.a)(le.a.mark((function e(r){return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.getItem("".concat(n.keyPrefix).concat(String(r))).then((function(e){return n.compressor.then((function(t){return t.decode(e)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=6,Promise.all(c);case 6:return e.sent.forEach((function(e){Array.isArray(n.meta.filters)&&"vlen-utf8"===n.meta.filters[0].id?a(e):i(e)})),s=Object(o.a)(n.meta.shape,1),u=s[0],e.abrupt("return",r.slice(0,u));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"loadCellNames",value:function(){var e=this;return this.cellNames||(this.cellNames=this.getJson("obs/.zattrs").then((function(t){var n=t._index;return e.getFlatArrDecompressed("/obs/".concat(n))}))),this.cellNames}}]),n}(ue),un=function(e){var t=Object(be.a)(e),n=Object(o.a)(t,2),r=n[0],a=255/(n[1]-r);return{data:new Uint8Array(e.map((function(e){return Math.floor((e-r)*a)})))}},pn=function(e){for(var t=e.length,n=e[0].length,r=e[0].BYTES_PER_ELEMENT,a=new DataView(new ArrayBuffer(t*n*r)),o=e[0].constructor,i=o.name.replace("Array",""),l=0;l<t;l+=1)for(var c=0;c<n;c+=1)a["set".concat(i)](r*(c*t+l),e[l][c],!0);return new o(a.buffer)},dn={CellSetsZarrLoader:function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"load",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n,r,a,i,l,c,s;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cellSetsTree||(t=this.options,n=t.map((function(e){return e.setName})),this.cellSetsTree=Promise.all([this.loadCellNames(),this.loadCellSetIds(n)]).then((function(e){var n=Object(o.a)(e,2),r=n[0],a=n[1],i=Vt("cell");return a.forEach((function(e,n){var a={name:t[n].groupName,children:[]},o=Array.apply(void 0,Object(G.a)(new Set(e))).sort(),l={};o.forEach((function(e){return l[e]={name:e,set:[]}})),e.forEach((function(e,t){return l[e].set.push([r[t],null])})),Object.values(l).forEach((function(e){return a=Ft(a,e)})),i.tree.push(a)})),i}))),e.next=3,this.cellSetsTree;case 3:return r=e.sent,a={},i=r.tree,l=i[0].name,c=i[0].children.map((function(e){return[l,e.name]})),s=Jt(r,[]),a.cellSetSelection=c,a.cellSetColor=s,e.abrupt("return",Promise.resolve(new ne(r,null,a)));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(sn),CellsZarrLoader:function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"loadXy",value:function(){var e=(this.options||{}).xy;return this.xy?this.xy:!this.xy&&e?(this.xy=this.loadNumeric(e),this.xy):(this.xy=Promise.resolve(null),this.xy)}},{key:"loadPoly",value:function(){var e=(this.options||{}).poly;return this.poly?this.poly:!this.poly&&e?(this.poly=this.loadNumeric(e),this.poly):(this.poly=Promise.resolve(null),this.poly)}},{key:"loadMappings",value:function(){var e=this,t=(this.options||{}).mappings;return this.mappings?this.mappings:!this.mappings&&t?(this.mappings=Promise.all(Object.keys(t).map(function(){var n=Object(ce.a)(le.a.mark((function n(r){var a;return le.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t[r].key,n.t0=r,n.next=4,e.loadNumeric(a);case 4:return n.t1=n.sent,n.abrupt("return",{coordinationName:n.t0,arr:n.t1});case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())),this.mappings):(this.mappings=Promise.resolve(null),this.mappings)}},{key:"loadFactors",value:function(){var e=(this.options||{}).factors;return e?this.loadCellSetIds(e):Promise.resolve(null)}},{key:"load",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t=this;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cells||(this.cells=Promise.all([this.loadMappings(),this.loadXy(),this.loadPoly(),this.loadCellNames(),this.loadFactors()]).then((function(e){var n=Object(o.a)(e,5),r=n[0],a=n[1],i=n[2],l=n[3],c=n[4],s={};return l.forEach((function(e,n){if(s[e]={},r&&r.forEach((function(r){var a=r.coordinationName,o=r.arr;s[e].mappings||(s[e].mappings={});var i=t.options.mappings[a].dims;s[e].mappings[a]=i.map((function(e){return o.data[n][e]}))})),a&&(s[e].xy=a.data[n]),i&&(s[e].poly=i.data[n]),c){var o={};c.forEach((function(e,r){return o[t.options.factors[r].split("/").slice(-1)]=e[n]})),s[e].factors=o}})),s}))),e.t0=Promise,e.t1=ne,e.next=5,this.cells;case 5:return e.t2=e.sent,e.t3=new e.t1(e.t2,null),e.abrupt("return",e.t0.resolve.call(e.t0,e.t3));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(sn),MatrixZarrLoader:function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"loadGeneNames",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n,r,a;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.geneNames){e.next=2;break}return e.abrupt("return",this.geneNames);case 2:if(!(t=this.options.geneFilter)){e.next=7;break}return e.next=6,this.getFlatArrDecompressed(t);case 6:n=e.sent;case 7:return e.next=9,this.getJson("var/.zattrs");case 9:if(r=e.sent,a=r._index,!this.geneNames){e.next=13;break}return e.abrupt("return",this.geneNames);case 13:return this.geneNames=this.getFlatArrDecompressed("var/".concat(a)).then((function(e){return e.filter((function(e,t){return!n||n[t]}))})),e.abrupt("return",this.geneNames);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredGenes",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFlatArrDecompressed(t);case 2:return n=e.sent,e.next=5,this.loadGeneNames();case 5:return r=e.sent,a=r.filter((function(e,t){return n[t]})),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getGeneIndices",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadGeneNames();case 2:return n=e.sent,e.abrupt("return",t.map((function(e){return n.indexOf(e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getNumCells",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadCellNames();case 2:return t=e.sent,e.abrupt("return",t.length);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getNumGenes",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadGeneNames();case 2:return t=e.sent,e.abrupt("return",t.length);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_openSparseArrays",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.options.matrix,n=this.store,!this.sparseArrays){e.next=3;break}return e.abrupt("return",this.sparseArrays);case 3:return this.sparseArrays=Promise.all(["indptr","indices","data"].map((function(e){return Object(oe.c)({store:n,path:"".concat(t,"/").concat(e),mode:"r"})}))),e.abrupt("return",this.sparseArrays);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_loadCSCGeneSelection",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a,i,l,c,s,u,p;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getGeneIndices(t);case 2:return n=e.sent,e.next=5,this._openSparseArrays();case 5:return r=e.sent,a=Object(o.a)(r,3),i=a[0],l=a[1],c=a[2],e.next=12,this._getNumCells();case 12:return s=e.sent,e.next=15,i.getRaw(null);case 15:return u=e.sent,p=u.data,e.abrupt("return",Promise.all(n.map(function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o,i,u,d,f,m;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p[t],r=p[t+1],a=n===r,o=new Float32Array(s).fill(0),!a){e.next=6;break}return e.abrupt("return",o);case 6:return e.next=8,l.get([Object(oe.d)(n,r)]);case 8:return i=e.sent,u=i.data,e.next=12,c.get([Object(oe.d)(n,r)]);case 12:for(d=e.sent,f=d.data,m=0;m<u.length;m+=1)o[u[m]]=f[m];return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_loadCSRGeneSelection",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getGeneIndices(t);case 2:return n=e.sent,e.next=5,this._getNumGenes();case 5:return r=e.sent,e.next=8,this._getNumCells();case 8:return a=e.sent,e.next=11,this._loadCSRSparseCellXGene();case 11:return o=e.sent,e.abrupt("return",n.map((function(e){for(var t=new Float32Array(a).fill(0),n=0;n<a;n+=1)t[n]=o[n*r+e];return t})));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_loadCSRSparseCellXGene",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t=this;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._sparseMatrix){e.next=2;break}return e.abrupt("return",this._sparseMatrix);case 2:return this._sparseMatrix=this._openSparseArrays().then(function(){var e=Object(ce.a)(le.a.mark((function e(n){var r,a,i,l,c,s,u,p,d,f;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.options.matrix,e.next=3,t.getJson("".concat(r,"/.zattrs"));case 3:return a=e.sent,i=a.shape,e.next=7,Promise.all(n.map(function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRaw(null);case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return l=e.sent,c=Object(o.a)(l,3),s=c[0],u=c[1],p=c[2],d=new Float32Array(i[0]*i[1]).fill(0),f=0,s.forEach((function(e,t){for(var n=s[t],r=s[t+1],a=n;a<r;a+=1){var o=p[a],l=u[a];d[f*i[1]+l]=o}f+=1})),e.abrupt("return",d);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",this._sparseMatrix);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_loadCSCSparseCellXGene",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t=this;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._sparseMatrix){e.next=2;break}return e.abrupt("return",this._sparseMatrix);case 2:return this._sparseMatrix=this._openSparseArrays().then(function(){var e=Object(ce.a)(le.a.mark((function e(n){var r,a,i,l,c,s,u,p,d,f;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.options.matrix,e.next=3,t.getJson("".concat(r,"/.zattrs"));case 3:return a=e.sent,i=a.shape,e.next=7,Promise.all(n.map(function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRaw(null);case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return l=e.sent,c=Object(o.a)(l,3),s=c[0],u=c[1],p=c[2],d=new Float32Array(i[0]*i[1]).fill(0),f=0,s.forEach((function(e,t){for(var n=s[t],r=s[t+1],a=n;a<r;a+=1){var o=p[a],l=u[a];d[l*i[1]+f]=o}f+=1})),e.abrupt("return",d);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",this._sparseMatrix);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadCellXGene",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n,r,a,o,i,l=this;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.store,!this.cellXGene){e.next=3;break}return e.abrupt("return",this.cellXGene);case 3:if(n=this.options,r=n.matrix,a=n.matrixGeneFilter,this._matrixZattrs){e.next=8;break}return e.next=7,this.getJson("".concat(r,"/.zattrs"));case 7:this._matrixZattrs=e.sent;case 8:if(o=this._matrixZattrs["encoding-type"],a){e.next=13;break}"csr_matrix"===o?this.cellXGene=this._loadCSRSparseCellXGene().then((function(e){return un(e)})):"csc_matrix"===o?this.cellXGene=this._loadCSCSparseCellXGene().then((function(e){return un(e)})):(this.arr||(this.arr=Object(oe.c)({store:t,path:r,mode:"r"})),this.cellXGene=this.arr.then((function(e){return e.getRaw(null).then((function(e){var t=e.data;return un(t)}))}))),e.next=21;break;case 13:if("csr_matrix"!==o){e.next=17;break}this.cellXGene=this._loadCSRSparseCellXGene().then(function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,o,i,c,s,u,p,d;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l._getFilteredGenes(a);case 2:return n=e.sent,r=n.length,e.next=6,l.loadGeneNames();case 6:return o=e.sent,i=o.length,e.next=10,l._getNumCells();case 10:for(c=e.sent,s=new Float32Array(c*r).fill(0),u=0;u<r;u+=1)for(p=o.indexOf(n[u]),d=0;d<c;d+=1)s[d*r+u]=t[d*i+p];return e.abrupt("return",un(s));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=21;break;case 17:return e.next=19,this._getFilteredGenes(a);case 19:i=e.sent,this.cellXGene=this.loadGeneSelection({selection:i,shouldNormalize:!1}).then((function(e){var t=e.data;return un(pn(t))}));case 21:return e.abrupt("return",this.cellXGene);case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadGeneSelection",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o,i,l,c,s,u=this;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selection,r=t.shouldNormalize,a=void 0===r||r,o=this.options.matrix,i=this.store,this._matrixZattrs){e.next=6;break}return e.next=5,this.getJson("".concat(o,"/.zattrs"));case 5:this._matrixZattrs=e.sent;case 6:if("csc_matrix"!==(l=this._matrixZattrs["encoding-type"])){e.next=13;break}return e.next=10,this._loadCSCGeneSelection(n);case 10:c=e.sent,e.next=26;break;case 13:if("csr_matrix"!==l){e.next=19;break}return e.next=16,this._loadCSRGeneSelection(n);case 16:c=e.sent,e.next=26;break;case 19:return this.arr||(this.arr=Object(oe.c)({store:i,path:o,mode:"r"})),e.next=22,this._getGeneIndices(n);case 22:return s=e.sent,e.next=25,Promise.all(s.map((function(e){return u.arr.then((function(t){return t.get([null,e])})).then((function(e){return e.data}))})));case 25:c=e.sent;case 26:return e.abrupt("return",{data:c.map((function(e){return a?un(e).data:e})),url:null});case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadAttrs",value:function(){return Promise.all([this.loadCellNames(),this.loadGeneNames()]).then((function(e){var t=Object(o.a)(e,2);return{data:{rows:t[0],cols:t[1]},url:null}}))}},{key:"load",value:function(){var e=this;return Promise.all([this.loadAttrs(),this.loadCellXGene()]).then(function(){var t=Object(ce.a)(le.a.mark((function t(n){var r,a,i,l,c;return le.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object(o.a)(n,2),a=r[0].data,i=r[1],!(l=e.options.matrixGeneFilter)){t.next=7;break}return t.next=5,e.getFlatArrDecompressed(l);case 5:c=t.sent,a.cols=a.cols.filter((function(e,t){return c[t]}));case 7:return t.abrupt("return",Promise.resolve(new ne([a,i],null)));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}]),n}(sn)},fn=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;Object(A.a)(this,n),r=t.call(this,e);var a=Object(se.a)(r),o=a.url;a.requestInit;return r.store=new oe.a(o),r}return Object(N.a)(n,[{key:"loadAttrs",value:function(){var e=this.store;return this.attrs||(this.attrs=e.getItem(".zattrs").then((function(e){var t=new TextDecoder("utf-8");return JSON.parse(t.decode(e))}))),this.attrs}},{key:"load",value:function(){var e=this.url;return this.loadAttrs().then((function(t){return Promise.resolve(new ne(t,e))}))}}]),n}(J),mn=(cn={"expression-matrix.zarr":pe,"clusters.json":Oe,"genes.json":he,"cells.json":ae,"molecules.json":ae,"neighborhoods.json":ae,"raster.json":bt,"raster.ome-zarr":gt,"cell-sets.json":an},Object(D.a)(cn,"".concat("anndata","-cell-sets.zarr"),dn.CellSetsZarrLoader),Object(D.a)(cn,"".concat("anndata","-cells.zarr"),dn.CellsZarrLoader),Object(D.a)(cn,"".concat("anndata","-expression-matrix.zarr"),dn.MatrixZarrLoader),Object(D.a)(cn,"genomic-profiles.zarr",fn),cn);var hn=n(273),bn=n(602),vn=n.n(bn),gn=Object(hn.a)((function(e){return{viewConfig:null,loaders:null,setViewConfig:function(t){return e({viewConfig:t})},setLoaders:function(t){return e({loaders:t})},setCoordinationValue:function(t){var n=t.parameter,r=t.scope,a=t.value;return e((function(e){return{viewConfig:Object(je.a)({},e.viewConfig,{coordinationSpace:Object(je.a)({},e.viewConfig.coordinationSpace,Object(D.a)({},n,Object(je.a)({},e.viewConfig.coordinationSpace[n],Object(D.a)({},r,a))))})}}))},removeComponent:function(t){return e((function(e){var n=e.viewConfig.layout.slice();return n.splice(t,1),{viewConfig:Object(je.a)({},e.viewConfig,{layout:n})}}))},changeLayout:function(t){return e((function(e){var n=e.viewConfig.layout.slice();return t.forEach((function(e){var t=Object(o.a)(e,2),r=t[0],a=t[1];n[r]=Object(je.a)({},n[r],{},a)})),{viewConfig:Object(je.a)({},e.viewConfig,{layout:n})}}))}}})),yn=Object(hn.a)((function(e){return{auxiliaryStore:null,setCoordinationValue:function(t){var n=t.parameter,r=t.scope,a=t.value;return e((function(e){return{auxiliaryStore:Object(je.a)({},e.auxiliaryStore,Object(D.a)({},n,Object(D.a)({},r,a)))}}))}}})),On=Object(hn.a)((function(e){return{componentHover:null,setComponentHover:function(t){return e({componentHover:t})}}})),jn=Object(hn.a)((function(e){return{warning:null,setWarning:function(t){return e({warning:t})}}})),En=Object(hn.a)((function(e){return{viewInfo:{},setComponentViewInfo:function(t,n){return e((function(e){return{viewInfo:Object(je.a)({},e.viewInfo,Object(D.a)({},t,n))}}))}}})),xn=Object(hn.a)((function(e){return{resizeCount:{},incrementResizeCount:function(){return e((function(e){return{resizeCount:e.resizeCount+1}}))}}}));function Cn(e,t){var n=gn((function(e){return e.setCoordinationValue}));return[gn((function(n){var r=n.viewConfig.coordinationSpace;return z(e.map((function(e){return r&&r[e]?[e,r[e][t[e]]]:[e,void 0]})))}),vn.a),Object(i.useMemo)((function(){return z(e.map((function(e){return["set".concat(F(e)),function(r){return n({parameter:e,scope:t[e],value:r})}]})))}),[e,t])]}var Sn={spatialRasterLayers:["rasterLayersCallbacks","areLoadingRasterChannnels"]};function Ln(e,t){var n=yn((function(e){return e.setCoordinationValue})),r=function(e){var t={};return Object.keys(e).forEach((function(n){(Sn[n]||[]).forEach((function(r){t[r||n]=e[n]}))})),t}(t),a=function(e){return e.map((function(e){return Sn[e]})).filter(Boolean).flat()}(e);return[yn((function(e){var t=e.auxiliaryStore;return z(a.map((function(e){return t&&t[e]?[e,t[e][r[e]]]:[e,void 0]})))}),vn.a),Object(i.useMemo)((function(){return z(a.map((function(e){return["set".concat(F(e)),function(t){return n({parameter:e,scope:r[e],value:t})}]})))}),[e,t])]}function wn(){return gn((function(e){return e.loaders}))}function Tn(){return On((function(e){return e.componentHover}))}function _n(){return On((function(e){return e.setComponentHover}))}function kn(){return jn((function(e){return e.warning}))}function In(){return jn((function(e){return e.setWarning}))}function An(e){return En(Object(i.useCallback)((function(t){return t.viewInfo[e]}),[e]))}function Nn(e){var t=Object(i.useRef)(En.getState().setComponentViewInfo);return function(n){return t.current(e,n)}}function Pn(){return xn((function(e){return e.resizeCount}))}function Rn(){return xn((function(e){return e.incrementResizeCount}))}function Mn(e){var t=e.rowHeight,n=e.config,r=e.getComponent,a=e.theme,c=e.height,s=function(e,t,n,r,a){var l=Object(i.useState)(n),c=Object(o.a)(l,2),s=c[0],u=c[1],p=Object(i.useState)(t),d=Object(o.a)(p,2),f=d[0],m=d[1],h=Object(i.useRef)();return Object(i.useEffect)((function(){var t=function(e){for(var t,n=0,r=0,a=e.length;r<a;r++)(t=e[r].y+e[r].h)>n&&(n=t);return n}(e.layout),n=function(e,t,n,r){return(e-2*r-(t-1)*n)/t}(s,t,r,a);m(n)}),[s,e,r,a]),Object(i.useEffect)((function(){null!==n&&void 0!==n&&u(n)}),[n]),Object(i.useEffect)((function(){if(null!==n&&void 0!==n)return function(){};function e(){if(h.current){var e=h.current.getBoundingClientRect();u(e.height)}}return window.addEventListener("resize",e),e(),function(){window.removeEventListener("resize",e)}}),[h,n]),[f,h]}(n,t,c,5,10),u=Object(o.a)(s,2),p=u[0],d=u[1],f=Rn();Object(i.useEffect)((function(){f()}),[p,f]);var m=Object(i.useRef)(gn.getState().setViewConfig).current,h=gn((function(e){return e.setLoaders})),b=gn((function(e){return e.removeComponent})),v=gn((function(e){return e.changeLayout})),g=gn((function(e){var t;return null===(t=e.viewConfig)||void 0===t?void 0:t.layout}));return Object(i.useEffect)((function(){if(n){m(n);var e=function(e,t){var n={};return e.forEach((function(e){var r={name:e.name,description:e.description||t,loaders:{}};e.files.forEach((function(e){var t=mn[e.fileType]||ae;r.loaders[e.type]=new t(e)})),n[e.uid]=r})),n}(n.datasets,n.description);h(e)}else h({})}),[n,m,h]),l.a.createElement("div",{ref:d,className:"vitessce-container vitessce-theme-".concat(a)},g&&l.a.createElement(W,{layout:g,height:c,rowHeight:p,theme:a,getComponent:r,draggableHandle:".title",margin:5,padding:10,onRemoveComponent:b,onLayoutChange:v,reactGridLayoutProps:{onResize:f,onResizeStop:f}}))}function Gn(e){var t=e.onWarn,n=e.onConfigChange,r=e.onLoaderChange,a=e.validateOnConfigChange,o=kn(),l=wn();return Object(i.useEffect)((function(){return gn.subscribe((function(e){a&&e&&function(e){try{var t=(new h.a).addSchema(k).addSchema(I).compile(w);if(!t(e)){var n=JSON.stringify(t.errors,null,2);throw new Error("Config validation failed: ".concat(n))}}catch(r){console.error(r)}}(e),n&&e&&n(e)}),(function(e){return e.viewConfig}))}),[n,a]),Object(i.useEffect)((function(){t&&o&&t(o)}),[o,t]),Object(i.useEffect)((function(){r&&l&&r(l)}),[l,r]),null}var Dn=n(206),zn=n.n(Dn);function Hn(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}function Fn(){var e=Object(i.useRef)(),t=Object(i.useState)(),n=Object(o.a)(t,2),r=n[0],a=n[1],l=Object(i.useState)(),c=Object(o.a)(l,2),s=c[0],u=c[1],p=Pn(),d=Rn();return Object(i.useEffect)((function(){function e(){d()}var t=zn()(e,100,{trailing:!0});return window.addEventListener("resize",t),e(),function(){window.removeEventListener("resize",t)}}),[d]),Object(i.useEffect)((function(){if(e.current){var t=e.current.getBoundingClientRect();a(t.height),u(t.width)}}),[p]),[s,r,e]}function Bn(){var e=Object(i.useRef)(),t=Object(i.useState)(),n=Object(o.a)(t,2),r=n[0],a=n[1],l=Object(i.useState)(),c=Object(o.a)(l,2),s=c[0],u=c[1],p=Pn(),d=Rn();return Object(i.useEffect)((function(){function e(){d()}var t=zn()(e,100,{trailing:!0});return window.addEventListener("resize",t),e(),function(){window.removeEventListener("resize",t)}}),[d]),Object(i.useEffect)((function(){if(e.current){var t=e.current.deck.canvas.getBoundingClientRect();a(t.height),u(t.width)}}),[p]),[s,r,e]}function Un(e){var t=e,n=Object(i.useState)(t),r=Object(o.a)(n,2),a=r[0],l=r[1],c=Object(i.useCallback)((function(e){l((function(t){var n=t.filter((function(t){return t!==e}));return console.log("cleared ".concat(e,"; waiting on ").concat(n.length,": ").concat(JSON.stringify(n))),n}))}),[l]),s=Object(i.useCallback)((function(){l(t),console.log("waiting on ".concat(t.length,": ").concat(JSON.stringify(t)))}),[l,t]);return[0===a.length,c,s]}function Xn(){var e=Object(i.useState)([]),t=Object(o.a)(e,2),n=t[0],r=t[1];return[n,Object(i.useCallback)((function(e,t){e&&r((function(n){return[].concat(Object(G.a)(n),[{url:e,name:t}])}))}),[r]),Object(i.useCallback)((function(){r([])}),[r])]}var Zn,Vn=n(175),Yn=n.n(Vn),Wn={DATASET:"dataset",EMBEDDING_TYPE:"embeddingType",EMBEDDING_ZOOM:"embeddingZoom",EMBEDDING_ROTATION:"embeddingRotation",EMBEDDING_TARGET_X:"embeddingTargetX",EMBEDDING_TARGET_Y:"embeddingTargetY",EMBEDDING_TARGET_Z:"embeddingTargetZ",EMBEDDING_CELL_SET_POLYGONS_VISIBLE:"embeddingCellSetPolygonsVisible",EMBEDDING_CELL_SET_LABELS_VISIBLE:"embeddingCellSetLabelsVisible",EMBEDDING_CELL_SET_LABEL_SIZE:"embeddingCellSetLabelSize",EMBEDDING_CELL_RADIUS:"embeddingCellRadius",SPATIAL_ZOOM:"spatialZoom",SPATIAL_ROTATION:"spatialRotation",SPATIAL_TARGET_X:"spatialTargetX",SPATIAL_TARGET_Y:"spatialTargetY",SPATIAL_TARGET_Z:"spatialTargetZ",SPATIAL_ROTATION_X:"spatialRotationX",SPATIAL_ROTATION_Y:"spatialRotationY",SPATIAL_ROTATION_Z:"spatialRotationZ",SPATIAL_ROTATION_ORBIT:"spatialRotationOrbit",SPATIAL_ORBIT_AXIS:"spatialOrbitAxis",SPATIAL_AXIS_FIXED:"spatialAxisFixed",HEATMAP_ZOOM_X:"heatmapZoomX",HEATMAP_ZOOM_Y:"heatmapZoomY",HEATMAP_TARGET_X:"heatmapTargetX",HEATMAP_TARGET_Y:"heatmapTargetY",CELL_FILTER:"cellFilter",CELL_HIGHLIGHT:"cellHighlight",CELL_SET_SELECTION:"cellSetSelection",CELL_SET_HIGHLIGHT:"cellSetHighlight",CELL_SET_COLOR:"cellSetColor",GENE_FILTER:"geneFilter",GENE_HIGHLIGHT:"geneHighlight",GENE_SELECTION:"geneSelection",GENE_EXPRESSION_COLORMAP:"geneExpressionColormap",GENE_EXPRESSION_TRANSFORM:"geneExpressionTransform",GENE_EXPRESSION_COLORMAP_RANGE:"geneExpressionColormapRange",CELL_COLOR_ENCODING:"cellColorEncoding",SPATIAL_RASTER_LAYERS:"spatialRasterLayers",SPATIAL_CELLS_LAYER:"spatialCellsLayer",SPATIAL_MOLECULES_LAYER:"spatialMoleculesLayer",SPATIAL_NEIGHBORHOODS_LAYER:"spatialNeighborhoodsLayer",GENOMIC_ZOOM_X:"genomicZoomX",GENOMIC_ZOOM_Y:"genomicZoomY",GENOMIC_TARGET_X:"genomicTargetX",GENOMIC_TARGET_Y:"genomicTargetY",ADDITIONAL_CELL_SETS:"additionalCellSets",MOLECULE_HIGHLIGHT:"moleculeHighlight"},qn=(Zn={},Object(D.a)(Zn,Wn.EMBEDDING_ZOOM,null),Object(D.a)(Zn,Wn.EMBEDDING_ROTATION,0),Object(D.a)(Zn,Wn.EMBEDDING_TARGET_X,null),Object(D.a)(Zn,Wn.EMBEDDING_TARGET_Y,null),Object(D.a)(Zn,Wn.EMBEDDING_TARGET_Z,0),Object(D.a)(Zn,Wn.EMBEDDING_CELL_SET_POLYGONS_VISIBLE,!1),Object(D.a)(Zn,Wn.EMBEDDING_CELL_SET_LABELS_VISIBLE,!1),Object(D.a)(Zn,Wn.EMBEDDING_CELL_SET_LABEL_SIZE,14),Object(D.a)(Zn,Wn.EMBEDDING_CELL_RADIUS,1),Object(D.a)(Zn,Wn.SPATIAL_ZOOM,null),Object(D.a)(Zn,Wn.SPATIAL_ROTATION,0),Object(D.a)(Zn,Wn.SPATIAL_TARGET_X,null),Object(D.a)(Zn,Wn.SPATIAL_TARGET_Y,null),Object(D.a)(Zn,Wn.SPATIAL_TARGET_Z,null),Object(D.a)(Zn,Wn.SPATIAL_ROTATION_X,null),Object(D.a)(Zn,Wn.SPATIAL_ROTATION_Y,null),Object(D.a)(Zn,Wn.SPATIAL_ROTATION_Z,null),Object(D.a)(Zn,Wn.SPATIAL_AXIS_FIXED,!1),Object(D.a)(Zn,Wn.SPATIAL_ROTATION_ORBIT,0),Object(D.a)(Zn,Wn.SPATIAL_ORBIT_AXIS,"Y"),Object(D.a)(Zn,Wn.SPATIAL_RASTER_LAYERS,null),Object(D.a)(Zn,Wn.SPATIAL_CELLS_LAYER,null),Object(D.a)(Zn,Wn.SPATIAL_MOLECULES_LAYER,null),Object(D.a)(Zn,Wn.SPATIAL_NEIGHBORHOODS_LAYER,null),Object(D.a)(Zn,Wn.HEATMAP_ZOOM_X,0),Object(D.a)(Zn,Wn.HEATMAP_ZOOM_Y,0),Object(D.a)(Zn,Wn.HEATMAP_TARGET_X,0),Object(D.a)(Zn,Wn.HEATMAP_TARGET_Y,0),Object(D.a)(Zn,Wn.GENE_EXPRESSION_COLORMAP,"plasma"),Object(D.a)(Zn,Wn.GENE_EXPRESSION_COLORMAP_RANGE,[0,1]),Object(D.a)(Zn,Wn.GENE_EXPRESSION_TRANSFORM,null),Object(D.a)(Zn,Wn.GENE_FILTER,null),Object(D.a)(Zn,Wn.GENE_HIGHLIGHT,null),Object(D.a)(Zn,Wn.GENE_SELECTION,null),Object(D.a)(Zn,Wn.CELL_FILTER,null),Object(D.a)(Zn,Wn.CELL_HIGHLIGHT,null),Object(D.a)(Zn,Wn.CELL_SET_SELECTION,null),Object(D.a)(Zn,Wn.CELL_SET_HIGHLIGHT,null),Object(D.a)(Zn,Wn.CELL_SET_COLOR,null),Object(D.a)(Zn,Wn.CELL_COLOR_ENCODING,"cellSetSelection"),Object(D.a)(Zn,Wn.GENOMIC_ZOOM_X,0),Object(D.a)(Zn,Wn.GENOMIC_ZOOM_Y,0),Object(D.a)(Zn,Wn.GENOMIC_TARGET_X,1549999999.5),Object(D.a)(Zn,Wn.GENOMIC_TARGET_Y,1549999999.5),Object(D.a)(Zn,Wn.ADDITIONAL_CELL_SETS,null),Object(D.a)(Zn,Wn.MOLECULE_HIGHLIGHT,null),Zn),$n=[Wn.HEATMAP_ZOOM_X,Wn.HEATMAP_ZOOM_Y,Wn.HEATMAP_TARGET_X,Wn.HEATMAP_TARGET_Y,Wn.EMBEDDING_ZOOM,Wn.EMBEDDING_TARGET_X,Wn.EMBEDDING_TARGET_Y,Wn.EMBEDDING_TARGET_Z,Wn.EMBEDDING_CELL_SET_POLYGONS_VISIBLE,Wn.EMBEDDING_CELL_SET_LABELS_VISIBLE,Wn.EMBEDDING_CELL_SET_LABEL_SIZE,Wn.EMBEDDING_CELL_RADIUS],Jn={scatterplot:[Wn.DATASET,Wn.EMBEDDING_TYPE,Wn.EMBEDDING_ZOOM,Wn.EMBEDDING_ROTATION,Wn.EMBEDDING_TARGET_X,Wn.EMBEDDING_TARGET_Y,Wn.EMBEDDING_TARGET_Z,Wn.EMBEDDING_CELL_SET_POLYGONS_VISIBLE,Wn.EMBEDDING_CELL_SET_LABELS_VISIBLE,Wn.EMBEDDING_CELL_SET_LABEL_SIZE,Wn.EMBEDDING_CELL_RADIUS,Wn.CELL_FILTER,Wn.CELL_HIGHLIGHT,Wn.CELL_SET_SELECTION,Wn.CELL_SET_HIGHLIGHT,Wn.CELL_SET_COLOR,Wn.GENE_HIGHLIGHT,Wn.GENE_SELECTION,Wn.GENE_EXPRESSION_COLORMAP,Wn.GENE_EXPRESSION_COLORMAP_RANGE,Wn.CELL_COLOR_ENCODING,Wn.ADDITIONAL_CELL_SETS],spatial:[Wn.DATASET,Wn.SPATIAL_ZOOM,Wn.SPATIAL_ROTATION,Wn.SPATIAL_RASTER_LAYERS,Wn.SPATIAL_CELLS_LAYER,Wn.SPATIAL_MOLECULES_LAYER,Wn.SPATIAL_NEIGHBORHOODS_LAYER,Wn.SPATIAL_TARGET_X,Wn.SPATIAL_TARGET_Y,Wn.SPATIAL_TARGET_Z,Wn.SPATIAL_ROTATION_X,Wn.SPATIAL_ROTATION_Y,Wn.SPATIAL_ROTATION_Z,Wn.SPATIAL_ROTATION_ORBIT,Wn.SPATIAL_ORBIT_AXIS,Wn.SPATIAL_AXIS_FIXED,Wn.CELL_FILTER,Wn.CELL_HIGHLIGHT,Wn.CELL_SET_SELECTION,Wn.CELL_SET_HIGHLIGHT,Wn.CELL_SET_COLOR,Wn.GENE_HIGHLIGHT,Wn.GENE_SELECTION,Wn.GENE_EXPRESSION_COLORMAP,Wn.GENE_EXPRESSION_COLORMAP_RANGE,Wn.CELL_COLOR_ENCODING,Wn.ADDITIONAL_CELL_SETS,Wn.MOLECULE_HIGHLIGHT],heatmap:[Wn.DATASET,Wn.HEATMAP_ZOOM_X,Wn.HEATMAP_ZOOM_Y,Wn.HEATMAP_TARGET_X,Wn.HEATMAP_TARGET_Y,Wn.CELL_FILTER,Wn.CELL_HIGHLIGHT,Wn.CELL_SET_SELECTION,Wn.CELL_SET_HIGHLIGHT,Wn.CELL_SET_COLOR,Wn.GENE_FILTER,Wn.GENE_HIGHLIGHT,Wn.GENE_SELECTION,Wn.GENE_EXPRESSION_COLORMAP,Wn.GENE_EXPRESSION_COLORMAP_RANGE,Wn.CELL_COLOR_ENCODING,Wn.ADDITIONAL_CELL_SETS],cellSets:[Wn.DATASET,Wn.CELL_SET_SELECTION,Wn.CELL_SET_HIGHLIGHT,Wn.CELL_SET_COLOR,Wn.CELL_COLOR_ENCODING,Wn.ADDITIONAL_CELL_SETS],cellSetSizes:[Wn.DATASET,Wn.CELL_SET_SELECTION,Wn.CELL_SET_HIGHLIGHT,Wn.CELL_SET_COLOR,Wn.ADDITIONAL_CELL_SETS],cellSetExpression:[Wn.DATASET,Wn.GENE_SELECTION,Wn.GENE_EXPRESSION_TRANSFORM,Wn.CELL_SET_SELECTION,Wn.CELL_SET_HIGHLIGHT,Wn.CELL_SET_COLOR,Wn.ADDITIONAL_CELL_SETS],status:[Wn.DATASET,Wn.CELL_HIGHLIGHT,Wn.GENE_HIGHLIGHT,Wn.CELL_SET_HIGHLIGHT,Wn.MOLECULE_HIGHLIGHT],genes:[Wn.DATASET,Wn.GENE_FILTER,Wn.GENE_HIGHLIGHT,Wn.GENE_SELECTION,Wn.CELL_COLOR_ENCODING],expressionHistogram:[Wn.DATASET,Wn.GENE_SELECTION],layerController:[Wn.DATASET,Wn.SPATIAL_RASTER_LAYERS,Wn.SPATIAL_CELLS_LAYER,Wn.SPATIAL_MOLECULES_LAYER,Wn.SPATIAL_NEIGHBORHOODS_LAYER,Wn.SPATIAL_ZOOM,Wn.SPATIAL_TARGET_X,Wn.SPATIAL_TARGET_Y,Wn.SPATIAL_TARGET_Z,Wn.SPATIAL_ROTATION_X,Wn.SPATIAL_ROTATION_Y,Wn.SPATIAL_ROTATION_Z,Wn.SPATIAL_ROTATION_ORBIT,Wn.SPATIAL_ORBIT_AXIS],higlass:[Wn.DATASET,Wn.GENOMIC_ZOOM_X,Wn.GENOMIC_ZOOM_Y,Wn.GENOMIC_TARGET_X,Wn.GENOMIC_TARGET_Y,Wn.GENE_FILTER,Wn.GENE_HIGHLIGHT,Wn.GENE_SELECTION],genomicProfiles:[Wn.DATASET,Wn.GENOMIC_ZOOM_X,Wn.GENOMIC_ZOOM_Y,Wn.GENOMIC_TARGET_X,Wn.GENOMIC_TARGET_Y,Wn.GENE_FILTER,Wn.GENE_HIGHLIGHT,Wn.GENE_SELECTION,Wn.CELL_SET_SELECTION,Wn.CELL_SET_HIGHLIGHT,Wn.CELL_SET_COLOR,Wn.ADDITIONAL_CELL_SETS],description:[Wn.DATASET,Wn.SPATIAL_RASTER_LAYERS]};function Kn(e,t){t(e.message),console.warn(e.message),e instanceof K&&e.warnInConsole()}function Qn(e,t,n){e&&t&&Object.entries(e).forEach((function(e){var r=Object(o.a)(e,2),a=r[0],i=r[1],l="set".concat(F(a)),c=t[l],s=n&&n[a];Yn()(s,qn[a])&&c&&c(i)}))}function er(e,t,n,r,a,l,c){var s=Object(i.useState)({}),u=Object(o.a)(s,2),p=u[0],d=u[1],f=Object(i.useState)(0),m=Object(o.a)(f,2),h=m[0],b=m[1],v=In();return Object(i.useEffect)((function(){e[t]&&(e[t].loaders.cells?e[t].loaders.cells.load().catch((function(e){return Kn(e,v)})).then((function(e){if(e){var t=e.data,a=e.url,o=e.coordinationValues;d(t),b(Object.keys(t).length),r(a,"Cells"),Qn(Object(je.a)({spatialCellsLayer:Xe},o),l,c),n("cells")}})):(d({}),b(0),a?Kn(new te(t,"cells",null,null),v):n("cells")))}),[e,t]),[p,h]}function tr(e,t,n,r,a,l,c){var s=Object(i.useState)(),u=Object(o.a)(s,2),p=u[0],d=u[1],f=In();return Object(i.useEffect)((function(){e[t]&&(e[t].loaders["cell-sets"]?e[t].loaders["cell-sets"].load().catch((function(e){return Kn(e,f)})).then((function(e){if(e){var t=e.data,a=e.url,o=e.coordinationValues;d(t),r(a,"Cell Sets"),Qn(o,l,c),n("cell-sets")}})):(d(null),a?Kn(new te(t,"cell-sets",null,null),f):n("cell-sets")))}),[e,t]),[p]}function nr(e,t,n,r,a,l,c){var s=Object(i.useState)(),u=Object(o.a)(s,2),p=u[0],d=u[1],f=In();return Object(i.useEffect)((function(){e[t]&&(e[t].loaders["expression-matrix"]?e[t].loaders["expression-matrix"].load().catch((function(e){return Kn(e,f)})).then((function(e){if(e){var t=e.data,a=e.url,i=e.coordinationValues,s=Object(o.a)(t,2),u=s[0],p=s[1];d({cols:u.cols,rows:u.rows,matrix:p.data}),r(a,"Expression Matrix"),Qn(i,l,c),n("expression-matrix")}})):(d(null),a?Kn(new te(t,"expression-matrix",null,null),f):n("expression-matrix")))}),[e,t]),[p]}function rr(e,t,n,r,a){var l=Object(i.useState)(),c=Object(o.a)(l,2),s=c[0],u=c[1],p=In();return Object(i.useEffect)((function(){if(e[t])if(a){var i=e[t].loaders["expression-matrix"];if(i)"function"===typeof i.loadGeneSelection?e[t].loaders["expression-matrix"].loadGeneSelection({selection:a}).catch((function(e){return Kn(e,p)})).then((function(e){if(e){var t=e.data;u(t)}})):i.load().catch((function(e){return Kn(e,p)})).then((function(e){if(e){var t=e.data,n=Object(o.a)(t,2),r=n[0],i=n[1].data,l=a.map((function(e){for(var t=r.cols.indexOf(e),n=r.cols.length,a=r.rows.length,o=new Uint8Array(a),l=0;l<a;l+=1)o[l]=i[l*n+t];return o}));u(l)}}));else u(null),r?Kn(new te(t,"expression-matrix",null,null),p):n("expression-matrix")}else n("expression-matrix")}),[e,t,a]),[s]}function ar(e,t,n,r,a){var l=Object(i.useState)(),c=Object(o.a)(l,2),s=c[0],u=c[1],p=In();return Object(i.useEffect)((function(){if(e[t]){var o=e[t].loaders["expression-matrix"];if(o)"function"===typeof o.loadAttrs?o.loadAttrs().catch((function(e){return Kn(e,p)})).then((function(e){if(e){var t=e.data,a=e.url;u(t),r(a,"Expression Matrix"),n("expression-matrix")}})):o.load().catch((function(e){return Kn(e,p)})).then((function(e){if(e){var t=e.data,a=e.url;u(t[0]),r(a,"Expression Matrix"),n("expression-matrix")}}));else u(null),a?Kn(new te(t,"expression-matrix",null,null),p):n("expression-matrix")}}),[e,t]),[s]}function or(e,t,n,r,a,l,c){var s=Object(i.useState)(),u=Object(o.a)(s,2),p=u[0],d=u[1],f=Object(i.useState)(0),m=Object(o.a)(f,2),h=m[0],b=m[1],v=Object(i.useState)(0),g=Object(o.a)(v,2),y=g[0],O=g[1],j=In();return Object(i.useEffect)((function(){e[t]&&(e[t].loaders.molecules?e[t].loaders.molecules.load().catch((function(e){return Kn(e,j)})).then((function(e){if(e){var t=e.data,a=e.url,o=e.coordinationValues;d(t),b(Object.keys(t).length),O(Object.values(t).map((function(e){return e.length})).reduce((function(e,t){return e+t}),0)),r(a,"Molecules"),Qn(Object(je.a)({spatialMoleculesLayer:Ue},o),l,c),n("molecules")}})):(d({}),b(0),O(0),a?Kn(new te(t,"molecules",null,null),j):n("molecules")))}),[e,t]),[p,h,y]}function ir(e,t,n,r,a,l,c){var s=Object(i.useState)(),u=Object(o.a)(s,2),p=u[0],d=u[1],f=Object(i.useState)([]),m=Object(o.a)(f,2),h=m[0],b=m[1],v=Object(i.useState)([]),g=Object(o.a)(v,2),y=g[0],O=g[1],j=In();return Object(i.useEffect)((function(){e[t]&&(e[t].loaders.raster?e[t].loaders.raster.load().catch((function(e){return Kn(e,j)})).then((function(e){if(e){var t=e.data,a=e.url,i=e.coordinationValues;d(t),a.forEach((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];r(n,a)}));var s=t.loaders,u=t.meta;b(s),O(u),Qn(i,l,c),n("raster")}})):(b([]),O([]),a?Kn(new te(t,"raster",null,null),j):n("raster")))}),[e,t]),[p,h,y]}var lr=n(813),cr=n.n(lr),sr=n(1449),ur=n(1323),pr=n(1413),dr=n(604),fr=n.n(dr),mr=n(603),hr=n.n(mr),br=n(812),vr=n.n(br),gr=n(814),yr=n.n(gr),Or=n(1408);function jr(){return l.a.createElement("div",{className:"loading-indicator-backdrop"},l.a.createElement("div",{className:"loading-indicator-container"},l.a.createElement(Or.a,null)))}var Er=n(1411),xr=n(1410),Cr=n(1451),Sr=n(1412);function Lr(e){var t=S(),n=e.anchorEl,r=e.open,a=e.placement,o=void 0===a?"bottom-start":a,i=e.children;return l.a.createElement(xr.a,{className:t.popper,open:r,anchorEl:n.current,placement:o},i)}function wr(e){var t=e.children,n=S();return l.a.createElement(Er.a,{className:n.paper,elevation:4},t)}function Tr(e){var t=e.children,n=S();return l.a.createElement("span",{className:n.span},t)}function _r(e){var t=e.buttonIcon,n=e.open,r=e.toggle,a=e.children,o=e.placement,c=e.buttonClassName,s=Object(i.useRef)(null),u=S();return l.a.createElement(l.a.Fragment,null,l.a.createElement(ur.a,{onClick:r,size:"small",ref:s,className:c},t),l.a.createElement(Lr,{className:u.popper,open:n,anchorEl:s,placement:o},l.a.createElement(wr,null,l.a.createElement(Sr.a,{onClickAway:r},l.a.createElement(Cr.a,null,a)))))}var kr=Object(E.a)((function(e){return{iconButton:{border:"none",marginLeft:0,background:"none",color:e.palette.primaryForeground,paddingLeft:"0.25em",paddingRight:"0.25em",borderRadius:"2px","&:hover":{backgroundColor:e.palette.primaryBackgroundLight},"&:first-child":{marginLeft:"0.75em"},"&:last-child":{marginRight:"0.25em"},"& svg":{width:"0.7em",height:"0.7em",verticalAlign:"middle"}},downloadLink:{color:e.palette.primaryForeground}}}));function Ir(e){var t=e.open;return l.a.createElement(l.a.Fragment,null,l.a.createElement(vr.a,null),t?l.a.createElement(hr.a,null):l.a.createElement(fr.a,null))}function Ar(e){var t=e.options,n=Object(i.useReducer)((function(e){return!e}),!1),r=Object(o.a)(n,2),a=r[0],c=r[1],s=kr();return l.a.createElement(_r,{open:a,toggle:c,buttonIcon:l.a.createElement(Ir,{open:a}),buttonClassName:s.iconButton,placement:"bottom-end"},t)}function Nr(e){var t=e.open;return l.a.createElement(l.a.Fragment,null,l.a.createElement(cr.a,null),t?l.a.createElement(hr.a,null):l.a.createElement(fr.a,null))}function Pr(e){var t=e.urls,n=Object(i.useReducer)((function(e){return!e}),!1),r=Object(o.a)(n,2),a=r[0],c=r[1],s=kr();return l.a.createElement(_r,{open:a,toggle:c,buttonIcon:l.a.createElement(Nr,{open:a}),buttonClassName:s.iconButton,placement:"bottom-end"},t.map((function(e){var t=e.url,n=e.name;return l.a.createElement(sr.a,{dense:!0,key:t},l.a.createElement(pr.a,{underline:"none",href:t,target:"_blank",rel:"noopener",className:s.downloadLink},"Download ",n))})))}function Rr(e){var t=e.removeGridComponent,n=kr();return l.a.createElement(ur.a,{onClick:t,size:"small",className:n.iconButton,title:"close"},l.a.createElement(yr.a,null))}function Mr(e){var t=e.title,n=e.info,r=e.children,a=e.isScroll,o=e.isSpatial,i=e.removeGridComponent,c=e.urls,s=e.isReady,f=e.options,m=a?d:o?p:u;return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"title d-flex justify-content-between align-items-baseline"},l.a.createElement("div",{className:"justify-content-between d-flex align-items-end"},l.a.createElement("span",null,t)),l.a.createElement("span",{className:"details pl-2 align-items-end"},l.a.createElement("span",{className:"d-flex justify-content-between"},n,f&&l.a.createElement(Ar,{options:f}),c&&c.length>0&&l.a.createElement(Pr,{urls:c}),l.a.createElement(Rr,{removeGridComponent:i})))),l.a.createElement("div",{className:m},!s&&l.a.createElement(jr,null),r))}function Gr(e){var t=e.description,n=e.metadata;return l.a.createElement("div",{className:"description"},l.a.createElement("p",null,t),n&&Array.from(n.entries()).map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1],a=r.name,i=r.metadata;return i&&Object.entries(i).length>0?l.a.createElement("details",{key:n},l.a.createElement("summary",null,a),l.a.createElement("div",{className:"metadata-container"},l.a.createElement("table",null,l.a.createElement("tbody",null,Object.entries(i).map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return l.a.createElement("tr",{key:n},l.a.createElement("th",{title:n},n),l.a.createElement("td",{title:r},r))})))))):null})))}var Dr=["raster"];function zr(e){var t=e.info,n=e.warn,r=[];return t&&r.push(l.a.createElement("p",{className:"details",key:"info"},t)),n&&r.push(l.a.createElement("p",{className:"alert alert-warning my-0 details",key:"warn"},n)),r}var Hr=n(611),Fr=n(817),Br=n.n(Fr),Ur=n(818),Xr=n.n(Ur);function Zr(e){var t=e.hasColorEncoding,n=e.columns,r=e.data,a=e.onChange,c=e.idKey,s=void 0===c?"id":c,u=e.valueKey,p=void 0===u?"value":u,d=e.allowMultiple,f=void 0!==d&&d,m=e.allowUncheck,h=void 0!==m&&m,b=e.showTableHead,v=void 0===b||b,g=e.showTableInputs,y=void 0!==g&&g,j=e.testHeight,E=void 0===j?void 0:j,x=e.testWidth,C=void 0===x?void 0:x,S=Object(i.useState)(null),L=Object(o.a)(S,2),w=L[0],T=L[1],_=Object(i.useCallback)((function(e,t){(t||h)&&T(f?t?Br()(w||[],[e]):Xr()(w||[],[e]):t?[e]:[])}),[f,h,w]),k=Object(i.useCallback)((function(e){var t=e.target,n=t.checked,r=t.value;_(r,n)}),[_]),I=Object(i.useCallback)((function(e){return e.map((function(e){var t;return t={},Object(D.a)(t,s,e),Object(D.a)(t,"data",r.find((function(t){return t[s]===e}))),t}))}),[r,s]),A=Object(i.useCallback)((function(e){return Array.isArray(w)&&w.includes(e)}),[w]);Object(i.useEffect)((function(){var e=r.map((function(e){return e[p]?e[s]:null})).filter(Boolean);O()(e,w)||(e.length>0?T(e):T(null))}),[r,s,p]),Object(i.useEffect)((function(){if(a&&w){var e=I(w);f?a(e):1===w.length?a(e[0]):0===w.length&&a(null)}}),[w]);var N=$()(),P=y?"":"hidden-input-column",R=function(e){var a=e.index,o=e.style;return l.a.createElement("div",{key:r[a][s],className:"table-item table-row ".concat(A(r[a][s])?"row-checked ":""),style:o,role:"button",onClick:function(){return _(r[a][s],!A(r[a][s])||!t)}},l.a.createElement("div",{className:"input-container ".concat(P," table-cell")},l.a.createElement("label",{htmlFor:"".concat(N,"_").concat(r[a][s])},l.a.createElement("input",{id:"".concat(N,"_").concat(r[a][s]),type:"checkbox",className:f?"checkbox":"radio",name:N,value:r[a][s],onChange:k,checked:A(r[a][s])}))),n.map((function(e){return l.a.createElement("div",{className:"table-cell",key:e},r[a][e])})))},M=function(e){var t=e.style;return l.a.createElement("div",{className:"".concat(P," table-row"),style:t},n.map((function(e){return l.a.createElement("div",{key:e},e)})))};return l.a.createElement("div",{className:"selectable-table"},l.a.createElement(Hr.a,null,(function(e){var t=e.width,n=e.height;return l.a.createElement(Hr.b,{height:E||n,gridStyle:{outline:"none"},rowCount:r.length,rowHeight:24,headerHeight:v?24:void 0,rowRenderer:R,width:C||t,headerRowRenderer:v?M:void 0,rowGetter:function(e){var t=e.index;return r[t]}})})))}function Vr(e){var t=e.hasColorEncoding,n=e.geneList,r=void 0===n?[]:n,a=e.geneSelection,c=void 0===a?[]:a,s=e.geneFilter,u=void 0===s?null:s,p=e.setGeneSelection,d=Object(i.useState)(""),f=Object(o.a)(d,2),m=f[0],h=f[1],b=Object(i.useState)(r),v=Object(o.a)(b,2),g=v[0],y=v[1];Object(i.useEffect)((function(){var e=r.filter((function(e){return e.toLowerCase().includes(m.toLowerCase())}));y(e)}),[m,r]);var O=g.filter((function(e){return!u||u.includes(e)})).sort((function(e,t){return e.localeCompare(t)})).map((function(e){return{name:e,value:!!c&&c.includes(e)}}));return l.a.createElement(l.a.Fragment,null,l.a.createElement("input",{className:"search-bar",type:"text",placeholder:"Search",value:m,onChange:function(e){h(e.target.value)}}),l.a.createElement(Zr,{columns:["name"],data:O,hasColorEncoding:t,idKey:"name",valueKey:"value",onChange:function(e){p&&e&&e.name&&p([e.name])},allowUncheck:!1,showTableHead:!1}))}var Yr=["expression-matrix"];var Wr=n(485),qr=n(78),$r=n.n(qr),Jr=l.a.forwardRef((function(e,t){var n,r=e.prefixCls,a=e.className,o=e.showIcon,i=e.blockNode,c=e.children,s=e.checkable;return l.a.createElement(Wr.b,Object.assign({itemHeight:32,ref:t},e,{className:$r()(a,(n={},Object(D.a)(n,"".concat(r,"-icon-hide"),!o),Object(D.a)(n,"".concat(r,"-block-node"),i),n)),checkable:s?l.a.createElement("span",{className:"".concat(r,"-checkbox-inner")}):s}),c)}));Jr.defaultProps={virtual:!1,checkable:!1,showIcon:!1,blockNode:!0,prefixCls:"rc-tree"};var Kr=Jr,Qr=n(210),ea=n(27),ta=n(64),na=n(819),ra=n(845);function aa(e){var t=e.title,n=e.content,r=e.overlayClassName,a=Object(i.useRef)(),o=Object(i.useCallback)((function(){return a.current?a.current.closest(".vitessce-container"):null}),[a]),c=t||n;return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{ref:a}),l.a.createElement(ra.a,Object.assign({getTooltipContainer:o,overlayClassName:r,overlay:c},e)))}function oa(e){return l.a.createElement(aa,e)}function ia(e){var t=e.title,n=e.subtitle,r=e.onClick,a=e.handler,c=e.handlerKey,s=e.confirm,u=e.visible,p=Object(i.useState)(!1),d=Object(o.a)(p,2),f=d[0],m=d[1];function h(){!s||f?(r(),a()):m(!0)}Object(i.useEffect)((function(){m(!1)}),[u]);var b="".concat(f?"Confirm ":"").concat(t);return l.a.createElement("button",{title:b,type:"button",onClick:h,onKeyPress:function(e){return St(e,c,h)}},b,n&&l.a.createElement(l.a.Fragment,null,l.a.createElement("br",null),l.a.createElement("span",{className:"small"},n)))}function la(e){var t=e.menuConfig,n=e.onClick,r=e.color,a=void 0===r?null:r,o=e.palette,i=void 0===o?null:o,c=e.setColor,s=void 0===c?null:c,u=e.visible;var p=i?i.map(Lt):Ne.concat([[255,255,255],[128,128,128],[0,0,0]]).map(Lt);return l.a.createElement("div",null,a&&s&&p&&l.a.createElement(na.TwitterPicker,{className:"popover-menu-color",disableAlpha:!0,width:108,triangle:"hide",colors:p,color:Lt(a),onChangeComplete:function(e){var t=e.rgb;t&&s&&s([t.r,t.g,t.b])}}),l.a.createElement("ul",{className:"popover-menu-list"},t.map((function(e){return l.a.createElement("li",{key:e.title+e.subtitle},l.a.createElement(ia,Object.assign({},e,{onClick:n,visible:u})))}))))}function ca(e){var t=e.menuConfig,n=e.placement,r=e.children,a=e.color,c=void 0===a?null:a,s=e.setColor,u=void 0===s?null:s,p=e.palette,d=void 0===p?null:p,f=Object(i.useState)(!1),m=Object(o.a)(f,2),h=m[0],b=m[1];return l.a.createElement(oa,{content:l.a.createElement(la,{menuConfig:t,onClick:function(){return b(!1)},color:c,setColor:u,palette:d,visible:h}),placement:n,visible:h,onVisibleChange:b},r)}function sa(){return(sa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ua(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}aa.defaultProps={overlayClassName:"help-tooltip",placement:"top",trigger:"hover",mouseEnterDelay:.2,mouseLeaveDelay:0},oa.defaultProps={overlayClassName:"popover",placement:"top",trigger:"click",mouseEnterDelay:0,mouseLeaveDelay:0};var pa=i.createElement("path",{d:"M12 18c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3z"});function da(e){var t=e.svgRef,n=e.title,r=e.titleId,a=ua(e,["svgRef","title","titleId"]);return i.createElement("svg",sa({width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":r},a),n?i.createElement("title",{id:r},n):null,pa)}var fa=i.forwardRef((function(e,t){return i.createElement(da,sa({svgRef:t},e))}));n.p;function ma(e){var t=e.path,n=e.level,r=e.height,a=e.onCheckNode,o=e.onNodeRemove,i=e.onNodeSetIsEditing,l=e.onExportLevelZeroNodeJSON,c=e.onExportLevelZeroNodeTabular,s=e.onExportSetJSON,u=e.checkable,p=e.editable,d=e.exportable,f=e.checked;return[].concat(Object(G.a)(p?[{title:"Rename",handler:function(){i(t,!0)},handlerKey:"r"},{title:"Delete",confirm:!0,handler:function(){o(t)},handlerKey:"d"}]:[]),Object(G.a)(0===n&&d?[{title:"Export hierarchy",subtitle:"(to JSON file)",handler:function(){l(t)},handlerKey:"j"}].concat(Object(G.a)(r<=1?[{title:"Export hierarchy",subtitle:"(to CSV file)",handler:function(){c(t)},handlerKey:"t"}]:[])):[]),Object(G.a)(n>0?[].concat(Object(G.a)(u?[{title:f?"Uncheck":"Check",handler:function(){a(t,!f)},handlerKey:"s"}]:[]),Object(G.a)(d?[{title:"Export set",subtitle:"(to JSON file)",handler:function(){s(t)},handlerKey:"e"}]:[])):[]))}function ha(e){var t,n=e.title,r=e.path,a=e.nodeKey,o=e.level,i=e.height,c=e.color,s=e.checkbox,u=e.isChecking,p=e.isLeaf,d=e.onNodeSetColor,f=e.onNodeView,m=e.expanded,h=e.onCheckLevel,b=e.checkedLevelPath,v=e.checkedLevelIndex,g=e.disableTooltip,y=e.size,j=e.datatype,E=e.editable,x=0===o&&!m,C=v&&O()(r,b)&&v<i?v+1:1,S=new Intl.NumberFormat("en-US").format(y);t=x?Tt(C):p||!m?"Color individual set (".concat(S," ").concat(j).concat(1===y?"":"s",")"):"Color by expanded descendants";var L=0!==o||m?function(){return f(r)}:function(){return h(a,C)},w=g?{visible:!1}:{},T=ma(e);return l.a.createElement("span",null,l.a.createElement(aa,Object.assign({title:t},w),l.a.createElement("button",{type:"button",onClick:L,onKeyPress:function(e){return St(e,"v",(function(){return f(r)}))},className:"title-button"},n)),T.length>0?l.a.createElement(ca,{menuConfig:ma(e),color:o>0&&E?c||Ae:null,setColor:function(e){return d(r,e)}},l.a.createElement(fa,{className:"node-menu-icon"})):null,o>0&&u?s:null,o>0&&l.a.createElement("span",{className:"node-size-label"},S))}function ba(e){var t=e.title,n=e.path,r=e.onNodeSetName,a=e.onNodeCheckNewName,c=Object(i.useState)(t),s=Object(o.a)(c,2),u=s[0],p=s[1],d=a(n,u);function f(){d||r(n,u,!0)}return l.a.createElement("span",{className:"title-button-with-input"},l.a.createElement("input",{autoFocus:!0,className:"title-input",type:"text",value:u,onChange:function(e){p(e.target.value)},onKeyPress:function(e){return St(e,"Enter",f)},onFocus:function(e){return e.target.select()}}),!d&&l.a.createElement("button",{type:"button",className:"title-save-button",onClick:f},"Save"))}function va(e){var t=e.isEditing,n=e.isCurrentSet;return t||n?l.a.createElement(ba,e):l.a.createElement(ha,e)}function ga(e){var t=e.nodeKey,n=e.path,r=e.height,a=e.onCheckLevel,o=e.checkedLevelPath,i=e.checkedLevelIndex,c=e.hasColorEncoding;function s(e){if(e.target.checked){var n=parseInt(e.target.value,10);a(t,n)}}return l.a.createElement("div",{className:"level-buttons-container"},ge()(1,r+1).map((function(e){var t=O()(n,o)&&e===i;return l.a.createElement("div",{className:"level-buttons",key:e},l.a.createElement(aa,{title:Tt(e)},l.a.createElement("input",{className:Object(ea.a)("level-radio-button",{checked:t&&!c}),type:"checkbox",value:e,checked:t&&c,onChange:s})))})))}function ya(e){var t=e.isLeaf,n=e.isOpen,r=e.color,a=r?Lt(r):void 0;return t?l.a.createElement("i",{className:"anticon anticon-circle rc-tree-switcher-icon"},l.a.createElement("svg",{viewBox:"0 0 1024 1024",focusable:"false","data-icon":"caret-down",width:"1em",height:"1em","aria-hidden":"true"},l.a.createElement("rect",{fill:a,x:300,y:300,width:424,height:424}))):l.a.createElement("i",{className:"anticon anticon-caret-down rc-tree-switcher-icon"},l.a.createElement("svg",{viewBox:"0 0 1024 1024",focusable:"false","data-icon":"caret-down",width:"1em",height:"1em","aria-hidden":"true"},l.a.createElement("path",{fill:n?"#444":a,d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"})))}var Oa=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){var e;Object(A.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).renderSelector=function(){var t=e.props,n=t.title,r=t.isCurrentSet,a=t.isSelected,o=t.isEditing,i=t.onDragStart,c=e.context.rcTree,s=c.prefixCls,u=c.draggable,p="".concat(s,"-node-content-wrapper"),d=!r&&!o&&u;return l.a.createElement("span",{ref:e.setSelectHandle,title:n,className:$r()(p,"".concat(p,"-").concat(e.getNodeState()||"normal"),a&&"".concat(s,"-node-selected"),d&&"draggable"),draggable:d,"aria-grabbed":d,onDragStart:d?function(t){i(),e.onDragStart(t)}:void 0},l.a.createElement(va,Object.assign({},e.props,{prefixClass:s,checkbox:e.renderCheckbox()})),e.renderLevels())},e.renderLevels=function(){var t=e.props,n=t.level,r=t.expanded;return 0!==n||r?null:l.a.createElement(ga,e.props)},e.renderSwitcher=function(){var t=e.props,n=t.expanded,r=t.isLeaf,a=t.color,o=e.context.rcTree,i=o.prefixCls,c=o.onNodeExpand,s=function(t){r||c(t,Object(se.a)(e))},u=$r()("".concat(i,"-switcher"),Object(D.a)({},"".concat(i,"-switcher_").concat(n?"open":"close"),!r));return l.a.createElement("span",{className:u,onClick:s,onKeyPress:function(e){return St(e,"d",s)},role:"button",tabIndex:"0"},l.a.createElement(ya,{isLeaf:r,isOpen:n,color:a}))},e}return Object(N.a)(n,[{key:"render",value:function(){var e,t=this,n=this.props,r=n.style,a=n.loading,o=n.level,i=n.dragOver,c=n.dragOverGapTop,s=n.dragOverGapBottom,u=n.isLeaf,p=n.expanded,d=n.selected,f=n.checked,m=n.halfChecked,h=n.onDragEnd,b=n.expandable,v=Object(Qr.a)(n,["style","loading","level","dragOver","dragOverGapTop","dragOverGapBottom","isLeaf","expanded","selected","checked","halfChecked","onDragEnd","expandable"]),g=this.context.rcTree,y=g.prefixCls,O=g.filterTreeNode,j=g.draggable,E=this.isDisabled(),x=Object(ta.i)(v);return l.a.createElement("li",Object.assign({className:$r()("rc-tree-treenode","level-".concat(o,"-treenode"),(e={},Object(D.a)(e,"".concat(y,"-treenode-disabled"),E),Object(D.a)(e,"".concat(y,"-treenode-switcher-").concat(p?"open":"close"),!u),Object(D.a)(e,"".concat(y,"-treenode-checkbox-checked"),f),Object(D.a)(e,"".concat(y,"-treenode-checkbox-indeterminate"),m),Object(D.a)(e,"".concat(y,"-treenode-selected"),d),Object(D.a)(e,"".concat(y,"-treenode-loading"),a),Object(D.a)(e,"drag-over",!E&&i),Object(D.a)(e,"drag-over-gap-top",!E&&c),Object(D.a)(e,"drag-over-gap-bottom",!E&&s),Object(D.a)(e,"filter-node",O&&O(this)),e)),style:r,role:"treeitem",onDragEnter:j?this.onDragEnter:void 0,onDragOver:j?this.onDragOver:void 0,onDragLeave:j?this.onDragLeave:void 0,onDrop:j?this.onDrop.bind(this):void 0,onDragEnd:j?function(e){h(),t.onDragEnd(e)}:void 0},x),b?this.renderSwitcher():null,this.renderSelector(),this.renderChildren())}}]),n}(Wr.a);function ja(){return(ja=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Ea(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function xa(e){var t=e.svgRef,n=e.title,r=e.titleId,a=Ea(e,["svgRef","title","titleId"]);return i.createElement("svg",ja({viewBox:"0 0 16.433999 10.234",height:12,width:18,ref:t,"aria-labelledby":r},a),n?i.createElement("title",{id:r},n):null,i.createElement("g",{transform:"translate(0.117,-2.883)"},i.createElement("path",{d:"m 11.467471,11.811278 c 0.198237,-0.322177 0.508,-1.011333 0.653661,-1.454255 0.659343,-2.0049141 0.44323,-4.2620847 -0.577734,-6.0340822 l -0.168844,-0.2930481 0.105744,0.017887 c 0.759902,0.1285441 1.368762,0.3699553 1.856675,0.7361658 1.988296,1.4923476 2.192477,4.3353549 0.434717,6.0529895 -0.641216,0.626581 -1.299647,0.94683 -2.294136,1.115833 l -0.108488,0.01844 z M 4.3162122,11.919169 C 1.9278944,11.487872 0.46692382,9.0323123 1.234873,6.7401372 1.5621727,5.763213 2.2610593,4.9489746 3.1840041,4.4693005 3.5978035,4.2542401 3.9427842,4.145371 4.5197023,4.0477802 L 4.6254464,4.0298927 4.4571836,4.3223069 C 3.4332707,6.1017061 3.2180432,8.3476022 3.878868,10.357023 c 0.1458466,0.443487 0.4554716,1.132155 0.6542959,1.455285 0.054471,0.08853 0.087814,0.159599 0.074096,0.157937 -0.013718,-0.0017 -0.1446898,-0.02465 -0.2910477,-0.05108 z M 5.0000001,3 C 2.2,3 0,5.2 0,8 c 0,2.8 2.2,5 5.0000001,5 0.6,0 1.1,-0.1 1.6,-0.3 C 5.3000001,11.6 4.5,9.7999998 4.5,8 4.5,6.2 5.3000001,4.5 6.6000001,3.3 c -0.5,-0.2 -1,-0.3 -1.6,-0.3 z M 4.65,4.02 C 3.92,5.17 3.51,6.54 3.51,8 c 0,1.4599998 0.42,2.83 1.14,3.98 C 2.61,11.8 1.01,10.08 1.01,8 1.01,5.92 2.61,4.2 4.65,4.02 Z M 8,4 C 6.8,4.9 6,6.4 6,8 6,9.6 6.8,11.1 8,12 9.2,11.1 10,9.7 10,8 10,6.3 9.2,4.9 8,4 Z m 3,-1 c 2.8,0 5,2.2 5,5 0,2.8 -2.2,5 -5,5 C 10.4,13 9.9,12.9 9.4,12.7 10.7,11.6 11.5,9.8 11.5,8 11.5,6.2 10.7,4.5 9.4,3.3 9.9,3.1 10.4,3 11,3 Z m 0.35,1.02 c 0.73,1.15 1.14,2.52 1.14,3.98 0,1.46 -0.42,2.83 -1.14,3.98 2.04,-0.18 3.64,-1.9 3.64,-3.98 0,-2.08 -1.6,-3.8 -3.64,-3.98 z",style:{strokeWidth:.234,strokeMiterlimit:4,strokeDasharray:"none",strokeOpacity:1}})))}var Ca=i.forwardRef((function(e,t){return i.createElement(xa,ja({svgRef:t},e))}));n.p;function Sa(){return(Sa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function La(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function wa(e){var t=e.svgRef,n=e.title,r=e.titleId,a=La(e,["svgRef","title","titleId"]);return i.createElement("svg",Sa({width:18,height:12,viewBox:"0 0 16 10",ref:t,"aria-labelledby":r},a),n?i.createElement("title",{id:r},n):null,i.createElement("g",{transform:"translate(0,-3)"},i.createElement("path",{d:"M 5.0000001,3 C 2.2,3 0,5.2 0,8 c 0,2.8 2.2,5 5.0000001,5 0.6,0 1.1,-0.1 1.6,-0.3 C 5.3000001,11.6 4.5,9.7999998 4.5,8 4.5,6.2 5.3000001,4.5 6.6000001,3.3 c -0.5,-0.2 -1,-0.3 -1.6,-0.3 z M 4.65,4.02 C 3.92,5.17 3.51,6.54 3.51,8 c 0,1.4599998 0.42,2.83 1.14,3.98 C 2.61,11.8 1.01,10.08 1.01,8 1.01,5.92 2.61,4.2 4.65,4.02 Z M 8,4 C 6.8,4.9 6,6.4 6,8 6,9.6 6.8,11.1 8,12 9.2,11.1 10,9.7 10,8 10,6.3 9.2,4.9 8,4 Z m 3,-1 c 2.8,0 5,2.2 5,5 0,2.8 -2.2,5 -5,5 C 10.4,13 9.9,12.9 9.4,12.7 10.7,11.6 11.5,9.8 11.5,8 11.5,6.2 10.7,4.5 9.4,3.3 9.9,3.1 10.4,3 11,3 Z m 0.35,1.02 c 0.73,1.15 1.14,2.52 1.14,3.98 0,1.46 -0.42,2.83 -1.14,3.98 2.04,-0.18 3.64,-1.9 3.64,-3.98 0,-2.08 -1.6,-3.8 -3.64,-3.98 z",style:{strokeWidth:.234,strokeMiterlimit:4,strokeDasharray:"none",strokeOpacity:1}})))}var Ta=i.forwardRef((function(e,t){return i.createElement(wa,Sa({svgRef:t},e))}));n.p;function _a(){return(_a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ka(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ia=i.createElement("rect",{x:"5%",width:"90%",height:"100%",fill:"white"}),Aa=i.createElement("g",null,i.createElement("rect",{x:0,y:0,width:25.3804963846,height:16,mask:"url(#union-mask)"}));function Na(e){var t=e.svgRef,n=e.title,r=e.titleId,a=ka(e,["svgRef","title","titleId"]);return i.createElement("svg",_a({id:"svg14",viewBox:"0 0 25.3804963846 16",height:16,width:25.3804963846,ref:t,"aria-labelledby":r},a),n?i.createElement("title",{id:r},n):null,i.createElement("defs",null,i.createElement("mask",{id:"union-mask",x:0,y:0,width:25.3804963846,height:16},Ia,i.createElement("g",{transform:"translate(4.69,0)"},i.createElement("path",{d:"m 11.467471,11.811278 c 0.198237,-0.322177 0.508,-1.011333 0.653661,-1.454255 0.659343,-2.0049141 0.44323,-4.2620847 -0.577734,-6.0340822 l -0.168844,-0.2930481 0.105744,0.017887 c 0.759902,0.1285441 1.368762,0.3699553 1.856675,0.7361658 1.988296,1.4923476 2.192477,4.3353549 0.434717,6.0529895 -0.641216,0.626581 -1.299647,0.94683 -2.294136,1.115833 l -0.108488,0.01844 z M 4.3162122,11.919169 C 1.9278944,11.487872 0.46692382,9.0323123 1.234873,6.7401372 1.5621727,5.763213 2.2610593,4.9489746 3.1840041,4.4693005 3.5978035,4.2542401 3.9427842,4.145371 4.5197023,4.0477802 L 4.6254464,4.0298927 4.4571836,4.3223069 C 3.4332707,6.1017061 3.2180432,8.3476022 3.878868,10.357023 c 0.1458466,0.443487 0.4554716,1.132155 0.6542959,1.455285 0.054471,0.08853 0.087814,0.159599 0.074096,0.157937 -0.013718,-0.0017 -0.1446898,-0.02465 -0.2910477,-0.05108 z M 5.0000001,3 C 2.2,3 0,5.2 0,8 c 0,2.8 2.2,5 5.0000001,5 0.6,0 1.1,-0.1 1.6,-0.3 C 5.3000001,11.6 4.5,9.7999998 4.5,8 4.5,6.2 5.3000001,4.5 6.6000001,3.3 c -0.5,-0.2 -1,-0.3 -1.6,-0.3 z M 4.65,4.02 C 3.92,5.17 3.51,6.54 3.51,8 c 0,1.4599998 0.42,2.83 1.14,3.98 C 2.61,11.8 1.01,10.08 1.01,8 1.01,5.92 2.61,4.2 4.65,4.02 Z M 8,4 C 6.8,4.9 6,6.4 6,8 6,9.6 6.8,11.1 8,12 9.2,11.1 10,9.7 10,8 10,6.3 9.2,4.9 8,4 Z m 3,-1 c 2.8,0 5,2.2 5,5 0,2.8 -2.2,5 -5,5 C 10.4,13 9.9,12.9 9.4,12.7 10.7,11.6 11.5,9.8 11.5,8 11.5,6.2 10.7,4.5 9.4,3.3 9.9,3.1 10.4,3 11,3 Z m 0.35,1.02 c 0.73,1.15 1.14,2.52 1.14,3.98 0,1.46 -0.42,2.83 -1.14,3.98 2.04,-0.18 3.64,-1.9 3.64,-3.98 0,-2.08 -1.6,-3.8 -3.64,-3.98 z",style:{strokeWidth:.234,strokeMiterlimit:4,strokeDasharray:"none",strokeOpacity:1},fill:"black"})))),Aa)}var Pa=i.forwardRef((function(e,t){return i.createElement(Na,_a({svgRef:t},e))}));n.p;function Ra(e){var t=e.datatype,n=e.onError,r=e.onImportTree,a=e.onCreateLevelZeroNode,o=e.importable,c=e.editable,s=Object(i.useCallback)((function(e,a){return function(){var o=document.createElement("input");o.setAttribute("type","file"),o.setAttribute("accept",a),document.body.appendChild(o),o.click(),o.addEventListener("change",(function(a){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var o=a.target.files;if(o&&1===o.length){var i=new FileReader;i.addEventListener("load",(function(){var a=i.result;try{var o=e(a,t);n(!1),r(o)}catch(l){n(l.message)}}),!1),i.readAsText(o[0])}else n("Incorrect number of files selected.")}else n("Local file reading APIs are not fully supported in this browser.")})),o.remove()}}),[t,n,r]),u=[].concat(Object(G.a)(c?[{title:"Create hierarchy",handler:a,handlerKey:"n"}]:[]),Object(G.a)(o?[{title:"Import hierarchy",subtitle:"(from CSV file)",handler:s(tn,"text/csv"),handlerKey:"c"},{title:"Import hierarchy",subtitle:"(from JSON file)",handler:s(en,"application/json"),handlerKey:"j"}]:[]));return u.length>0?l.a.createElement(ca,{menuConfig:u},l.a.createElement("button",{className:"plus-button",type:"submit"},"+")):null}function Ma(e){var t=e.onUnion,n=e.onIntersection,r=e.onComplement,a=e.operatable,o=e.hasCheckedSetsToUnion,i=e.hasCheckedSetsToIntersect,c=e.hasCheckedSetsToComplement;return l.a.createElement(l.a.Fragment,null,a&&l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{onClick:t,title:"New set from union of checked sets",type:"submit",disabled:!o},l.a.createElement(Ca,null)),l.a.createElement("button",{onClick:n,title:"New set from intersection of checked sets",type:"submit",disabled:!i},l.a.createElement(Ta,null)),l.a.createElement("button",{onClick:r,title:"New set from complement of checked sets",type:"submit",disabled:!c},l.a.createElement(Pa,null))))}function Ga(e,t){return Object(je.a)({},e,{tree:e?e.tree.map((function(e){return function e(t,n,r){var a,o=[].concat(Object(G.a)(n),[t.name]);return Object(je.a)({},t,{},t.children?{children:t.children.map((function(t){return e(t,o,r)}))}:{},{color:(null===r||void 0===r||null===(a=r.find((function(e){return O()(e.path,o)})))||void 0===a?void 0:a.color)||Ae})}(e,[],t)})):[]})}function Da(e){var t=e.sets,n=e.additionalSets,r=e.setColor,a=e.levelSelection,c=e.setSelection,s=e.setExpansion,u=e.hasColorEncoding,p=e.datatype,d=e.draggable,f=void 0===d||d,m=e.checkable,h=void 0===m||m,b=e.editable,v=void 0===b||b,g=e.expandable,y=void 0===g||g,j=e.operatable,E=void 0===j||j,x=e.exportable,C=void 0===x||x,S=e.importable,L=void 0===S||S,w=e.onError,T=e.onCheckNode,_=e.onExpandNode,k=e.onDropNode,I=e.onCheckLevel,A=e.onNodeSetColor,N=e.onNodeSetName,P=e.onNodeCheckNewName,R=e.onNodeRemove,M=e.onNodeView,D=e.onImportTree,z=e.onCreateLevelZeroNode,H=e.onExportLevelZeroNodeJSON,F=e.onExportLevelZeroNodeTabular,B=e.onExportSetJSON,U=e.onUnion,X=e.onIntersection,Z=e.onComplement,V=e.hasCheckedSetsToUnion,Y=e.hasCheckedSetsToIntersect,W=e.hasCheckedSetsToComplement,q=Object(i.useState)(!1),$=Object(o.a)(q,2),J=$[0],K=$[1],Q=Object(i.useState)(null),ee=Object(o.a)(Q,2),te=ee[0],ne=ee[1],re=Object(i.useMemo)((function(){return Ga(t,r)}),[t,r]),ae=Object(i.useMemo)((function(){return Ga(n,r)}),[n,r]),oe=ae?ae.tree.flatMap((function(e){return function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!t)return null;var r=[].concat(Object(G.a)(n),[t.name]);return t.children?[It(r)].concat(Object(G.a)(t.children.flatMap((function(t){return e(t,r)})))):It(r)}(e,[])})):[],ie=(c||[]).map(It),le=(s||[]).map(It),ce=ie.filter((function(e){return!oe.includes(e)})),se=le.filter((function(e){return!oe.includes(e)})),ue=ie.filter((function(e){return oe.includes(e)})),pe=le.filter((function(e){return oe.includes(e)}));function de(e,t,n){return e?e.map((function(e){var o=[].concat(Object(G.a)(n),[e.name]);return l.a.createElement(Oa,Object.assign({key:It(o)},function(e,t,n){var r,a=t.length-1;return{title:e.name,nodeKey:It(t),path:t,size:Gt(e).length,color:null===n||void 0===n||null===(r=n.find((function(e){return O()(e.path,t)})))||void 0===r?void 0:r.color,level:a,isLeaf:(!e.children||0===e.children.length)&&Boolean(e.set),height:Dt(e)}}(e,o,r),{isEditing:O()(te,o),datatype:p,draggable:f&&!t,editable:v&&!t,checkable:h,expandable:y,exportable:C,hasColorEncoding:u,isChecking:!0,checkedLevelPath:a?a.levelZeroPath:null,checkedLevelIndex:a?a.levelIndex:null,onCheckNode:T,onCheckLevel:I,onNodeView:M,onNodeSetColor:A,onNodeSetName:function(e,t){N(e,t),ne(null)},onNodeCheckNewName:P,onNodeSetIsEditing:ne,onNodeRemove:R,onExportLevelZeroNodeJSON:H,onExportLevelZeroNodeTabular:F,onExportSetJSON:B,disableTooltip:J,onDragStart:function(){return K(!0)},onDragEnd:function(){return K(!1)}}),de(e.children,t,o))})):null}return l.a.createElement("div",{className:"sets-manager"},l.a.createElement("div",{className:"sets-manager-tree"},l.a.createElement(Kr,{draggable:!1,checkable:h,checkedKeys:ce,expandedKeys:se,autoExpandParent:!0,onCheck:function(e,t){return T(t.node.props.nodeKey,t.checked)},onExpand:function(e,t){return _(e,t.node.props.nodeKey,t.expanded)}},de(re.tree,!0,[])),l.a.createElement(Kr,{draggable:!0,checkable:h,checkedKeys:ue,expandedKeys:pe,autoExpandParent:!0,onCheck:function(e,t){return T(t.node.props.nodeKey,t.checked)},onExpand:function(e,t){return _(e,t.node.props.nodeKey,t.expanded)},onDrop:function(e){var t=e.node.props.eventKey,n=e.dragNode.props.eventKey,r=e.dropToGap,a=e.dropPosition;k(t,n,a,r)}},de(ae.tree,!1,[])),l.a.createElement(Ra,{datatype:p,onError:w,onImportTree:D,onCreateLevelZeroNode:z,importable:L,editable:v})),l.a.createElement("div",{className:"set-operation-buttons"},l.a.createElement(Ma,{onUnion:U,onIntersection:X,onComplement:Z,operatable:E,hasCheckedSetsToUnion:V,hasCheckedSetsToIntersect:Y,hasCheckedSetsToComplement:W})))}var za=["cells","cell-sets"];var Ha,Fa=n(114),Ba=n.n(Fa);(Ha=function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),a=e[r],o=e[r+1],i=r>0?e[r-1]:2*a-o,l=r<t-1?e[r+2]:2*o-a;return function(e,t,n,r,a){var o=e*e,i=o*e;return((1-3*e+3*o-i)*t+(4-6*o+3*i)*n+(1+3*e+3*o-3*i)*r+i*a)/6}((n-r/t)*t,i,a,o,l)}},function(e){var t,n,r=e.length,a=new Array(r),o=new Array(r),i=new Array(r);for(t=0;t<r;++t)n=[e[t][0],e[t][1],e[t][2]],a[t]=n[0]||0,o[t]=n[1]||0,i[t]=n[2]||0;return a=Ha(a),o=Ha(o),i=Ha(i),function(e){return[a(e),o(e),i(e)]}})([[103,0,31],[178,24,43],[214,96,77],[244,165,130],[253,219,199],[247,247,247],[209,229,240],[146,197,222],[67,147,195],[33,102,172],[5,48,97]]);var Ua=function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}([[13,8,135],[16,7,136],[19,7,137],[22,7,138],[25,6,140],[27,6,141],[29,6,142],[32,6,143],[34,6,144],[36,6,145],[38,5,145],[40,5,146],[42,5,147],[44,5,148],[46,5,149],[47,5,150],[49,5,151],[51,5,151],[53,4,152],[55,4,153],[56,4,154],[58,4,154],[60,4,155],[62,4,156],[63,4,156],[65,4,157],[67,3,158],[68,3,158],[70,3,159],[72,3,159],[73,3,160],[75,3,161],[76,2,161],[78,2,162],[80,2,162],[81,2,163],[83,2,163],[85,2,164],[86,1,164],[88,1,164],[89,1,165],[91,1,165],[92,1,166],[94,1,166],[96,1,166],[97,0,167],[99,0,167],[100,0,167],[102,0,167],[103,0,168],[105,0,168],[106,0,168],[108,0,168],[110,0,168],[111,0,168],[113,0,168],[114,1,168],[116,1,168],[117,1,168],[119,1,168],[120,1,168],[122,2,168],[123,2,168],[125,3,168],[126,3,168],[128,4,168],[129,4,167],[131,5,167],[132,5,167],[134,6,166],[135,7,166],[136,8,166],[138,9,165],[139,10,165],[141,11,165],[142,12,164],[143,13,164],[145,14,163],[146,15,163],[148,16,162],[149,17,161],[150,19,161],[152,20,160],[153,21,159],[154,22,159],[156,23,158],[157,24,157],[158,25,157],[160,26,156],[161,27,155],[162,29,154],[163,30,154],[165,31,153],[166,32,152],[167,33,151],[168,34,150],[170,35,149],[171,36,148],[172,38,148],[173,39,147],[174,40,146],[176,41,145],[177,42,144],[178,43,143],[179,44,142],[180,46,141],[181,47,140],[182,48,139],[183,49,138],[184,50,137],[186,51,136],[187,52,136],[188,53,135],[189,55,134],[190,56,133],[191,57,132],[192,58,131],[193,59,130],[194,60,129],[195,61,128],[196,62,127],[197,64,126],[198,65,125],[199,66,124],[200,67,123],[201,68,122],[202,69,122],[203,70,121],[204,71,120],[204,73,119],[205,74,118],[206,75,117],[207,76,116],[208,77,115],[209,78,114],[210,79,113],[211,81,113],[212,82,112],[213,83,111],[213,84,110],[214,85,109],[215,86,108],[216,87,107],[217,88,106],[218,90,106],[218,91,105],[219,92,104],[220,93,103],[221,94,102],[222,95,101],[222,97,100],[223,98,99],[224,99,99],[225,100,98],[226,101,97],[226,102,96],[227,104,95],[228,105,94],[229,106,93],[229,107,93],[230,108,92],[231,110,91],[231,111,90],[232,112,89],[233,113,88],[233,114,87],[234,116,87],[235,117,86],[235,118,85],[236,119,84],[237,121,83],[237,122,82],[238,123,81],[239,124,81],[239,126,80],[240,127,79],[240,128,78],[241,129,77],[241,131,76],[242,132,75],[243,133,75],[243,135,74],[244,136,73],[244,137,72],[245,139,71],[245,140,70],[246,141,69],[246,143,68],[247,144,68],[247,145,67],[247,147,66],[248,148,65],[248,149,64],[249,151,63],[249,152,62],[249,154,62],[250,155,61],[250,156,60],[250,158,59],[251,159,58],[251,161,57],[251,162,56],[252,163,56],[252,165,55],[252,166,54],[252,168,53],[252,169,52],[253,171,51],[253,172,51],[253,174,50],[253,175,49],[253,177,48],[253,178,47],[253,180,47],[253,181,46],[254,183,45],[254,184,44],[254,186,44],[254,187,43],[254,189,42],[254,190,42],[254,192,41],[253,194,41],[253,195,40],[253,197,39],[253,198,39],[253,200,39],[253,202,38],[253,203,38],[252,205,37],[252,206,37],[252,208,37],[252,210,37],[251,211,36],[251,213,36],[251,215,36],[250,216,36],[250,218,36],[249,220,36],[249,221,37],[248,223,37],[248,225,37],[247,226,37],[247,228,37],[246,230,38],[246,232,38],[245,233,38],[245,235,39],[244,237,39],[243,238,39],[243,240,39],[242,242,39],[241,244,38],[241,245,37],[240,247,36],[240,249,33]]);function Xa(e){var t=e.cellColorEncoding,n=e.expressionData,r=e.cellSets,a=e.cellSetSelection,i=e.cellSetColor,l=e.expressionDataAttrs;if("geneSelection"===t&&n&&l){for(var c=Ua,s=new Map,u=0;u<n.length;u+=1){var p=c(n[u]/255);s.set(l.rows[u],p)}return s}return"cellSetSelection"===t&&a&&r?function(e,t,n){var r=[];return t.forEach((function(t){var a=zt(e,t);if(a){var i,l=Gt(a),c=(null===n||void 0===n||null===(i=n.find((function(e){return O()(e.path,t)})))||void 0===i?void 0:i.color)||Ae;r=[].concat(Object(G.a)(r),Object(G.a)(l.map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return[n,Ot()(r)?c:Yt(c,r)]}))))}})),new Map(r)}(r,a,i):new Map}var Za,Va=n(699),Ya=n(772),Wa=n(612),qa=n(592),$a=n(1445),Ja=n(822),Ka=n.n(Ja),Qa=n(823),eo=n.n(Qa),to=n(824),no=n.n(to),ro=n(354),ao=n.n(ro),oo=n(196),io=n(226),lo=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"handleClick",value:function(e,t){t.onEdit({editType:"clearFeatures"})}}]),n}(io.DrawRectangleMode),co=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"handleClick",value:function(e,t){t.onEdit({editType:"clearFeatures"})}}]),n}(io.DrawPolygonByDraggingMode),so=(Za={},Object(D.a)(Za,oo.SELECTION_TYPE.RECTANGLE,lo),Object(D.a)(Za,oo.SELECTION_TYPE.POLYGON,co),Za),uo={selectionType:oo.SELECTION_TYPE.RECTANGLE,layerIds:[],onSelect:function(){}},po={type:"FeatureCollection",features:[]},fo=["lineWidthScale","lineWidthMinPixels","lineWidthMaxPixels","lineWidthUnits","lineJointRounded","lineMiterLimit","pointRadiusScale","pointRadiusMinPixels","pointRadiusMaxPixels","lineDashJustified","getLineColor","getFillColor","getRadius","getLineWidth","getLineDashArray","getTentativeLineDashArray","getTentativeLineColor","getTentativeFillColor","getTentativeLineWidth","editHandlePointRadiusScale","editHandlePointRadiusMinPixels","editHandlePointRadiusMaxPixels","getEditHandlePointColor","getEditHandlePointRadius","modeHandlers"],mo=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"_selectPolygonObjects",value:function(e){var t=this.props,n=t.onSelect,r=t.getCellCoords,a=t.cellsQuadTree,o=t.flipY?e.map((function(e){return e.map((function(e){return[e[0],-e[1]]}))})):e,i=Object(At.polygon)(o),l=[];a.visit((function(e,t,n,a,o){var c=[[[t,n],[a,n],[a,o],[t,o],[t,n]]],s=Object(At.polygon)(c),u=eo()(s,i),p=Ka()(s,i),d=no()(s,i);return!(u||p||d)||(e.data&&ao()(Object(At.point)(r(e.data[1])),i)&&l.push(e.data),!1)})),n({pickingInfos:l})}},{key:"renderLayers",value:function(){var e=this,t=this.props.onSelect,n=so[this.props.selectionType]||io.ViewMode,r={};return fo.forEach((function(t){void 0!==e.props[t]&&(r[t]=e.props[t])})),[new oo.EditableGeoJsonLayer(this.getSubLayerProps(Object(je.a)({id:"selection-geojson",pickable:!0,mode:n,modeConfig:{dragToDraw:!0},selectedFeatureIndexes:[],data:po,onEdit:function(n){var r=n.updatedData,a=n.editType;if("addFeature"===a){var o=r.features[0].geometry.coordinates;e._selectPolygonObjects(o)}else"clearFeatures"===a&&t({pickingInfos:[]})}},r)))]}}]),n}(qa.a);function ho(e){return"base-".concat(e)}function bo(e,t,n,r,a,o){var i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!e)return[];var l=ho(n),c=5/(t+16);return[new mo({id:"selection",flipY:i,cellsQuadTree:o,getCellCoords:r,coordinateSystem:we.a.CARTESIAN,selectionType:e,onSelect:function(e){var t=e.pickingInfos.map((function(e){return e[0]}));a&&a(t)},layerIds:[l],getTentativeFillColor:function(){return[255,255,255,95]},getTentativeLineColor:function(){return[143,143,143,255]},getTentativeLineDashArray:function(){return[7,4]},lineWidthMinPixels:2,lineWidthMaxPixels:2,getEditHandlePointColor:function(){return[255,255,255,255]},getEditHandlePointRadius:function(){return c},editHandlePointRadiusScale:1,editHandlePointRadiusMinPixels:c,editHandlePointRadiusMaxPixels:2*c})]}function vo(e){var t,n=e.id,r=e.getColor,a=e.data,o=e.isSelected,i=Object(Qr.a)(e,["id","getColor","data","isSelected"]);return{overlay:Object(je.a)({id:(t=n,"selected-".concat(t)),getFillColor:r,getLineColor:r,data:a,getFilterValue:o,extensions:[new $a.a({filterSize:1})],filterRange:[1,1]},i),base:Object(je.a)({id:ho(n),getLineColor:r,getFillColor:r,data:a.slice()},i)}}mo.layerName="SelectionLayer",mo.defaultProps=uo;var go=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"renderLayers",value:function(){var e=vo(this.props);return[new Va.a(e.base),new Va.a(e.overlay)]}}]),n}(qa.a);go.layerName="SelectablePolygonLayer";var yo=n(433),Oo=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"renderLayers",value:function(){var e=vo(this.props);return[new yo.a(e.base),new yo.a(e.overlay)]}}]),n}(qa.a);Oo.layerName="SelectableScatterplotLayer";var jo,Eo=n(423),xo=n(771),Co={dark:[224,224,224],light:[64,64,64]},So="-apple-system, 'Helvetica Neue', Arial, sans-serif",Lo=(jo={},Object(D.a)(jo,Ve.default.TEXTURE_MIN_FILTER,Ve.default.NEAREST),Object(D.a)(jo,Ve.default.TEXTURE_MAG_FILTER,Ve.default.NEAREST),Object(D.a)(jo,Ve.default.TEXTURE_WRAP_S,Ve.default.CLAMP_TO_EDGE),Object(D.a)(jo,Ve.default.TEXTURE_WRAP_T,Ve.default.CLAMP_TO_EDGE),jo),wo=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"_getShaders",value:function(e){var t=this;return this.props.extensions.forEach((function(n){e=Object(Eo.a)(e,n.getShaders.call(t,n))})),e}},{key:"updateState",value:function(e){Object(fe.a)(Object(de.a)(n.prototype),"updateState",this).call(this,e),this.loadTexture(this.props.image)}},{key:"getShaders",value:function(){var e=this.props.colormap;return this._getShaders({vs:"\n#define SHADER_NAME heatmap-bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec3 positions64Low;\n\nvarying vec2 vTexCoord;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:"\n#define SHADER_NAME heatmap-bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvec4 rdbu (float x_354677415) {\n  const float e0 = 0.0;\n  const vec4 v0 = vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);\n  const float e1 = 0.35;\n  const vec4 v1 = vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);\n  const float e2 = 0.5;\n  const vec4 v2 = vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);\n  const float e3 = 0.6;\n  const vec4 v3 = vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);\n  const float e4 = 0.7;\n  const vec4 v4 = vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);\n  const float e5 = 1.0;\n  const vec4 v5 = vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);\n  float a0 = smoothstep(e0,e1,x_354677415);\n  float a1 = smoothstep(e1,e2,x_354677415);\n  float a2 = smoothstep(e2,e3,x_354677415);\n  float a3 = smoothstep(e3,e4,x_354677415);\n  float a4 = smoothstep(e4,e5,x_354677415);\n  return max(mix(v0,v1,a0)*step(e0,x_354677415)*step(x_354677415,e1),\n    max(mix(v1,v2,a1)*step(e1,x_354677415)*step(x_354677415,e2),\n    max(mix(v2,v3,a2)*step(e2,x_354677415)*step(x_354677415,e3),\n    max(mix(v3,v4,a3)*step(e3,x_354677415)*step(x_354677415,e4),mix(v4,v5,a4)*step(e4,x_354677415)*step(x_354677415,e5)\n  ))));\n}\n\nvec4 jet (float x_3419531890) {\n  const float e0 = 0.0;\n  const vec4 v0 = vec4(0,0,0.5137254901960784,1);\n  const float e1 = 0.125;\n  const vec4 v1 = vec4(0,0.23529411764705882,0.6666666666666666,1);\n  const float e2 = 0.375;\n  const vec4 v2 = vec4(0.0196078431372549,1,1,1);\n  const float e3 = 0.625;\n  const vec4 v3 = vec4(1,1,0,1);\n  const float e4 = 0.875;\n  const vec4 v4 = vec4(0.9803921568627451,0,0,1);\n  const float e5 = 1.0;\n  const vec4 v5 = vec4(0.5019607843137255,0,0,1);\n  float a0 = smoothstep(e0,e1,x_3419531890);\n  float a1 = smoothstep(e1,e2,x_3419531890);\n  float a2 = smoothstep(e2,e3,x_3419531890);\n  float a3 = smoothstep(e3,e4,x_3419531890);\n  float a4 = smoothstep(e4,e5,x_3419531890);\n  return max(mix(v0,v1,a0)*step(e0,x_3419531890)*step(x_3419531890,e1),\n    max(mix(v1,v2,a1)*step(e1,x_3419531890)*step(x_3419531890,e2),\n    max(mix(v2,v3,a2)*step(e2,x_3419531890)*step(x_3419531890,e3),\n    max(mix(v3,v4,a3)*step(e3,x_3419531890)*step(x_3419531890,e4),mix(v4,v5,a4)*step(e4,x_3419531890)*step(x_3419531890,e5)\n  ))));\n}\n\nvec4 viridis (float x_98747489) {\n  const float e0 = 0.0;\n  const vec4 v0 = vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);\n  const float e1 = 0.13;\n  const vec4 v1 = vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);\n  const float e2 = 0.25;\n  const vec4 v2 = vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);\n  const float e3 = 0.38;\n  const vec4 v3 = vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);\n  const float e4 = 0.5;\n  const vec4 v4 = vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);\n  const float e5 = 0.63;\n  const vec4 v5 = vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);\n  const float e6 = 0.75;\n  const vec4 v6 = vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);\n  const float e7 = 0.88;\n  const vec4 v7 = vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);\n  const float e8 = 1.0;\n  const vec4 v8 = vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);\n  float a0 = smoothstep(e0,e1,x_98747489);\n  float a1 = smoothstep(e1,e2,x_98747489);\n  float a2 = smoothstep(e2,e3,x_98747489);\n  float a3 = smoothstep(e3,e4,x_98747489);\n  float a4 = smoothstep(e4,e5,x_98747489);\n  float a5 = smoothstep(e5,e6,x_98747489);\n  float a6 = smoothstep(e6,e7,x_98747489);\n  float a7 = smoothstep(e7,e8,x_98747489);\n  return max(mix(v0,v1,a0)*step(e0,x_98747489)*step(x_98747489,e1),\n    max(mix(v1,v2,a1)*step(e1,x_98747489)*step(x_98747489,e2),\n    max(mix(v2,v3,a2)*step(e2,x_98747489)*step(x_98747489,e3),\n    max(mix(v3,v4,a3)*step(e3,x_98747489)*step(x_98747489,e4),\n    max(mix(v4,v5,a4)*step(e4,x_98747489)*step(x_98747489,e5),\n    max(mix(v5,v6,a5)*step(e5,x_98747489)*step(x_98747489,e6),\n    max(mix(v6,v7,a6)*step(e6,x_98747489)*step(x_98747489,e7),mix(v7,v8,a7)*step(e7,x_98747489)*step(x_98747489,e8)\n  )))))));\n}\n\nvec4 inferno (float x_2396186301) {\n  const float e0 = 0.0;\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\n  const float e1 = 0.13;\n  const vec4 v1 = vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);\n  const float e2 = 0.25;\n  const vec4 v2 = vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);\n  const float e3 = 0.38;\n  const vec4 v3 = vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);\n  const float e4 = 0.5;\n  const vec4 v4 = vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);\n  const float e5 = 0.63;\n  const vec4 v5 = vec4(0.8901960784313725,0.34901960784313724,0.2,1);\n  const float e6 = 0.75;\n  const vec4 v6 = vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);\n  const float e7 = 0.88;\n  const vec4 v7 = vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);\n  const float e8 = 1.0;\n  const vec4 v8 = vec4(0.9882352941176471,1,0.6431372549019608,1);\n  float a0 = smoothstep(e0,e1,x_2396186301);\n  float a1 = smoothstep(e1,e2,x_2396186301);\n  float a2 = smoothstep(e2,e3,x_2396186301);\n  float a3 = smoothstep(e3,e4,x_2396186301);\n  float a4 = smoothstep(e4,e5,x_2396186301);\n  float a5 = smoothstep(e5,e6,x_2396186301);\n  float a6 = smoothstep(e6,e7,x_2396186301);\n  float a7 = smoothstep(e7,e8,x_2396186301);\n  return max(mix(v0,v1,a0)*step(e0,x_2396186301)*step(x_2396186301,e1),\n    max(mix(v1,v2,a1)*step(e1,x_2396186301)*step(x_2396186301,e2),\n    max(mix(v2,v3,a2)*step(e2,x_2396186301)*step(x_2396186301,e3),\n    max(mix(v3,v4,a3)*step(e3,x_2396186301)*step(x_2396186301,e4),\n    max(mix(v4,v5,a4)*step(e4,x_2396186301)*step(x_2396186301,e5),\n    max(mix(v5,v6,a5)*step(e5,x_2396186301)*step(x_2396186301,e6),\n    max(mix(v6,v7,a6)*step(e6,x_2396186301)*step(x_2396186301,e7),mix(v7,v8,a7)*step(e7,x_2396186301)*step(x_2396186301,e8)\n  )))))));\n}\n\nvec4 magma (float x_4140671788) {\n  const float e0 = 0.0;\n  const vec4 v0 = vec4(0,0,0.01568627450980392,1);\n  const float e1 = 0.13;\n  const vec4 v1 = vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);\n  const float e2 = 0.25;\n  const vec4 v2 = vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);\n  const float e3 = 0.38;\n  const vec4 v3 = vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);\n  const float e4 = 0.5;\n  const vec4 v4 = vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);\n  const float e5 = 0.63;\n  const vec4 v5 = vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);\n  const float e6 = 0.75;\n  const vec4 v6 = vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);\n  const float e7 = 0.88;\n  const vec4 v7 = vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);\n  const float e8 = 1.0;\n  const vec4 v8 = vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);\n  float a0 = smoothstep(e0,e1,x_4140671788);\n  float a1 = smoothstep(e1,e2,x_4140671788);\n  float a2 = smoothstep(e2,e3,x_4140671788);\n  float a3 = smoothstep(e3,e4,x_4140671788);\n  float a4 = smoothstep(e4,e5,x_4140671788);\n  float a5 = smoothstep(e5,e6,x_4140671788);\n  float a6 = smoothstep(e6,e7,x_4140671788);\n  float a7 = smoothstep(e7,e8,x_4140671788);\n  return max(mix(v0,v1,a0)*step(e0,x_4140671788)*step(x_4140671788,e1),\n    max(mix(v1,v2,a1)*step(e1,x_4140671788)*step(x_4140671788,e2),\n    max(mix(v2,v3,a2)*step(e2,x_4140671788)*step(x_4140671788,e3),\n    max(mix(v3,v4,a3)*step(e3,x_4140671788)*step(x_4140671788,e4),\n    max(mix(v4,v5,a4)*step(e4,x_4140671788)*step(x_4140671788,e5),\n    max(mix(v5,v6,a5)*step(e5,x_4140671788)*step(x_4140671788,e6),\n    max(mix(v6,v7,a6)*step(e6,x_4140671788)*step(x_4140671788,e7),mix(v7,v8,a7)*step(e7,x_4140671788)*step(x_4140671788,e8)\n  )))))));\n}\n\nvec4 plasma (float x_1580529385) {\n  const float e0 = 0.0;\n  const vec4 v0 = vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);\n  const float e1 = 0.13;\n  const vec4 v1 = vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);\n  const float e2 = 0.25;\n  const vec4 v2 = vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);\n  const float e3 = 0.38;\n  const vec4 v3 = vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);\n  const float e4 = 0.5;\n  const vec4 v4 = vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);\n  const float e5 = 0.63;\n  const vec4 v5 = vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);\n  const float e6 = 0.75;\n  const vec4 v6 = vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);\n  const float e7 = 0.88;\n  const vec4 v7 = vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);\n  const float e8 = 1.0;\n  const vec4 v8 = vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);\n  float a0 = smoothstep(e0,e1,x_1580529385);\n  float a1 = smoothstep(e1,e2,x_1580529385);\n  float a2 = smoothstep(e2,e3,x_1580529385);\n  float a3 = smoothstep(e3,e4,x_1580529385);\n  float a4 = smoothstep(e4,e5,x_1580529385);\n  float a5 = smoothstep(e5,e6,x_1580529385);\n  float a6 = smoothstep(e6,e7,x_1580529385);\n  float a7 = smoothstep(e7,e8,x_1580529385);\n  return max(mix(v0,v1,a0)*step(e0,x_1580529385)*step(x_1580529385,e1),\n    max(mix(v1,v2,a1)*step(e1,x_1580529385)*step(x_1580529385,e2),\n    max(mix(v2,v3,a2)*step(e2,x_1580529385)*step(x_1580529385,e3),\n    max(mix(v3,v4,a3)*step(e3,x_1580529385)*step(x_1580529385,e4),\n    max(mix(v4,v5,a4)*step(e4,x_1580529385)*step(x_1580529385,e5),\n    max(mix(v5,v6,a5)*step(e5,x_1580529385)*step(x_1580529385,e6),\n    max(mix(v6,v7,a6)*step(e6,x_1580529385)*step(x_1580529385,e7),mix(v7,v8,a7)*step(e7,x_1580529385)*step(x_1580529385,e8)\n  )))))));\n}\n\n// The texture (GL.LUMINANCE & Uint8Array).\nuniform sampler2D uBitmapTexture;\n\n// What are the dimensions of the texture (width, height)?\nuniform vec2 uTextureSize;\n\n// How many consecutive pixels should be aggregated together along each axis?\nuniform vec2 uAggSize;\n\n// What are the values of the color scale sliders?\nuniform vec2 uColorScaleRange;\n\n// The texture coordinate, varying (interpolated between values set by the vertex shader).\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  // Compute 1 pixel in texture coordinates\n  vec2 onePixel = vec2(1.0, 1.0) / uTextureSize;\n  \n  vec2 viewCoord = vec2(floor(vTexCoord.x * uTextureSize.x), floor(vTexCoord.y * uTextureSize.y));\n\n  // Compute (x % aggSizeX, y % aggSizeY).\n  // These values will be the number of values to the left / above the current position to consider.\n  vec2 modAggSize = vec2(-1.0 * mod(viewCoord.x, uAggSize.x), -1.0 * mod(viewCoord.y, uAggSize.y));\n\n  // Take the sum of values along each axis.\n  float intensitySum = 0.0;\n  vec2 offsetPixels = vec2(0.0, 0.0);\n\n  for(int i = 0; i < 16; i++) {\n    // Check to break outer loop early.\n    // Uniforms cannot be used as conditions in GLSL for loops.\n    if(float(i) >= uAggSize.y) {\n      // Done in the y direction.\n      break;\n    }\n\n    offsetPixels = vec2(offsetPixels.x, (modAggSize.y + float(i)) * onePixel.y);\n\n    for(int j = 0; j < 16; j++) {\n      // Check to break inner loop early.\n      // Uniforms cannot be used as conditions in GLSL for loops.\n      if(float(j) >= uAggSize.x) {\n        // Done in the x direction.\n        break;\n      }\n\n      offsetPixels = vec2((modAggSize.x + float(j)) * onePixel.x, offsetPixels.y);\n      intensitySum += texture2D(uBitmapTexture, vTexCoord + offsetPixels).r;\n    }\n  }\n  \n  // Compute the mean value.\n  float intensityMean = intensitySum / (uAggSize.x * uAggSize.y);\n  \n  // Re-scale using the color scale slider values.\n  float scaledIntensityMean = (intensityMean - uColorScaleRange[0]) / max(0.005, (uColorScaleRange[1] - uColorScaleRange[0]));\n\n  gl_FragColor = __colormap(clamp(scaledIntensityMean, 0.0, 1.0));\n\n  geometry.uv = vTexCoord;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n".replace("__colormap",e),modules:[Ye.a,We.a]})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.state,r=n.bitmapTexture,a=n.model,o=this.props,i=o.aggSizeX,l=o.aggSizeY,c=o.colorScaleLo,s=o.colorScaleHi;r&&a&&a.setUniforms(Object.assign({},t,{uBitmapTexture:r,uTextureSize:[2048,2048],uAggSize:[i,l],uColorScaleRange:[c,s]})).draw()}},{key:"loadTexture",value:function(e){var t=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),e instanceof qe.a?this.setState({bitmapTexture:e}):e&&this.setState({bitmapTexture:new qe.a(t,{data:e,mipmaps:!1,parameters:Lo,format:Ve.default.LUMINANCE,dataFormat:Ve.default.LUMINANCE,type:Ve.default.UNSIGNED_BYTE,width:2048,height:2048})})}}]),n}(xo.a);wo.layerName="HeatmapBitmapLayer",wo.defaultProps={image:{type:"object",value:null,async:!0},colormap:{type:"string",value:"plasma",compare:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},aggSizeX:{type:"number",value:8,compare:!0},aggSizeY:{type:"number",value:8,compare:!0},colorScaleLo:{type:"number",value:0,compare:!0},colorScaleHi:{type:"number",value:1,compare:!0}};var To=Object(je.a)({},xo.a.defaultProps,{image:{type:"object",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}}),_o=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"renderLayers",value:function(){var e=this.props.image;return new xo.a(this.props,{id:"".concat(this.props.id,"-wrapped"),image:e,textureParameters:Lo})}}]),n}(qa.a);_o.layerName="PixelatedBitmapLayer",_o.defaultProps=To;var ko=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"_renderAxisTopLayers",value:function(){var e=this.props,t=e.axisTopLabelData,n=e.matrixLeft,r=e.width,a=e.matrixWidth,o=e.viewWidth,i=e.theme,l=e.targetX,c=e.targetY,s=e.axisTopTitle,u=e.cellWidth>=9,p=c+(e.axisOffsetTop-3)/2/e.scaleFactor;return[new Ya.a({id:"axisTopLabels",coordinateSystem:we.a.CARTESIAN,data:t,getText:function(e){return e[1]},getPosition:function(e){return[n+(e[0]+.5)/r*a,p]},getTextAnchor:"start",getColor:function(){return Co[i]},getSize:u?9:0,getAngle:75,fontFamily:So,updateTriggers:{getPosition:[p,n,a,o],getSize:[u],getColor:[i]}}),new Ya.a({id:"axisTopTitle",coordinateSystem:we.a.CARTESIAN,data:[{title:s}],getText:function(e){return e.title},getPosition:[l,c],getTextAnchor:"middle",getColor:function(){return Co[i]},getSize:u?0:15,getAngle:0,fontFamily:So,updateTriggers:{getSize:[u],getColor:[i]}})]}},{key:"_renderAxisLeftLayers",value:function(){var e=this.props,t=e.axisLeftLabelData,n=e.matrixTop,r=e.height,a=e.matrixHeight,o=e.viewHeight,i=e.theme,l=e.axisLeftTitle,c=e.targetX,s=e.targetY,u=e.cellHeight>=9,p=c+(e.axisOffsetLeft-3)/2/e.scaleFactor;return[new Ya.a({id:"axisLeftLabels",coordinateSystem:we.a.CARTESIAN,data:t,getText:function(e){return e[1]},getPosition:function(e){return[p,n+(e[0]+.5)/r*a]},getTextAnchor:"end",getColor:function(){return Co[i]},getSize:u?9:0,getAngle:0,fontFamily:So,updateTriggers:{getPosition:[p,n,a,o],getSize:[u],getColor:[i]}}),new Ya.a({id:"axisLeftTitle",coordinateSystem:we.a.CARTESIAN,data:[{title:l}],getText:function(e){return e.title},getPosition:[c,s],getTextAnchor:"middle",getColor:function(){return Co[i]},getSize:u?0:15,getAngle:90,fontFamily:So,updateTriggers:{getSize:[u],getColor:[i]}})]}},{key:"renderLayers",value:function(){return[this._renderAxisTopLayers(),this._renderAxisLeftLayers()]}}]),n}(qa.a);ko.layerName="HeatmapCompositeTextLayer";var Io=n(1436);function Ao(e,t){return e&&e.length&&t(e[0][1])?Object(Io.a)().x((function(e){return t(e[1])[0]})).y((function(e){return t(e[1])[1]})).addAll(e):null}var No=n(1441),Po=n(701),Ro=n(700);function Mo(){return(Mo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Go(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Do=i.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),zo=i.createElement("path",{d:"M21 3L3 10.53v.98l6.84 2.65L12.48 21h.98L21 3z"});function Ho(e){var t=e.svgRef,n=e.title,r=e.titleId,a=Go(e,["svgRef","title","titleId"]);return i.createElement("svg",Mo({width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":r},a),n?i.createElement("title",{id:r},n):null,Do,zo)}var Fo=i.forwardRef((function(e,t){return i.createElement(Ho,Mo({svgRef:t},e))}));n.p;function Bo(){return(Bo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Uo(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Xo=i.createElement("path",{d:"       M19 19h2v2h-2v-2zm0-2h2v-2h-2v2z       M3 13h2v-2H3v2zm0 4h2v-2H3v2z       m0-8h2V7H3v2zm0-4h2V3H3v2z       m4 0h2V3H7v2zm8 16h2v-2h-2v2z       m-4 0h2v-2h-2v2z       m4 0h2v-2h-2v2z       m-8 0h2v-2H7v2z       m-4 0h2v-2H3v2z       M11 5h2v-2h-2v2z       M15 5h2v-2h-2v2z       M19 5h2v-2h-2v2z       M19 9h2v-2h-2v2z       M19 13h2v-2h-2v2z     "});function Zo(e){var t=e.svgRef,n=e.title,r=e.titleId,a=Uo(e,["svgRef","title","titleId"]);return i.createElement("svg",Bo({width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":r},a),n?i.createElement("title",{id:r},n):null,Xo)}var Vo=i.forwardRef((function(e,t){return i.createElement(Zo,Bo({svgRef:t},e))}));n.p;function Yo(){return(Yo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Wo(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function qo(e){var t=e.svgRef,n=e.title,r=e.titleId,a=Wo(e,["svgRef","title","titleId"]);return i.createElement("svg",Yo({width:24,height:24,viewBox:"0 0 24 24",ref:t,"aria-labelledby":r},a),n?i.createElement("title",{id:r},n):null,i.createElement("g",{transform:"translate(0,3)"},i.createElement("path",{style:{strokeWidth:.343565},d:"M 23.942314,4.6958443 C 23.446206,1.8868581 19.727461,0 14.687364,0 13.437819,0 12.150138,0.11543779 10.859708,0.34287772 4.1629423,1.5250844 -0.58168816,5.2884937 0.05768601,8.911385 c 0.25355086,1.439193 1.35605049,2.63583 3.04638949,3.461072 -0.2569865,0.387198 -0.4074679,0.826617 -0.4074679,1.29524 0,1.337498 1.1863293,2.457176 2.7639791,2.728248 l -1.3615475,2.333149 c -0.1576963,0.271073 -0.066308,0.61876 0.2047647,0.776457 0.090014,0.05291 0.1886171,0.07799 0.2858459,0.07799 0.1951448,0 0.3851362,-0.100665 0.4912977,-0.281723 l 1.6803757,-2.88148 C 8.41868,16.20561 9.6895264,15.063601 9.6998333,13.683844 c 6.872e-4,-0.0055 0.00137,-0.01065 0.00137,-0.01615 0,-0.02336 -0.00344,-0.04569 -0.00481,-0.06837 1.1292977,-0.0213 2.2847067,-0.130211 3.4435507,-0.334975 6.69711,-1.181863 11.44174,-4.9456164 10.802366,-8.5685077 z M 3.83312,13.667353 c 0,-0.30749 0.1281497,-0.59849 0.3470005,-0.848261 0.1219655,0.04295 0.2456489,0.08383 0.3717372,0.123339 l 1.2234344,2.352045 C 4.6865351,15.149835 3.83312,14.46408 3.83312,13.667353 Z M 7.0141869,15.216144 6.0223152,13.309702 5.4008064,12.114097 c 0.121622,-0.03161 0.2477103,-0.05634 0.3772342,-0.07387 0.1367388,-0.0189 0.2772568,-0.02886 0.420867,-0.02886 0.5067581,0 0.980534,0.11956 1.3701366,0.317454 0.5696305,0.289968 0.9554538,0.750345 0.9904974,1.262944 0.00137,0.02542 0.0055,0.05016 0.0055,0.07593 0,0.698124 -0.6562089,1.310356 -1.5508518,1.548447 z m 5.9185921,-3.126441 c -1.217251,0.214728 -2.429691,0.323982 -3.6060571,0.324669 -0.5765018,-0.911821 -1.7614569,-1.53917 -3.1278143,-1.53917 -0.4717146,0 -0.921441,0.07593 -1.332001,0.211292 -0.3061162,0.100665 -0.5878394,0.237403 -0.8427645,0.39991 C 2.4598914,10.828133 1.4360682,9.8579062 1.2319907,8.7035283 0.72660678,5.8381974 5.2307418,2.5475333 11.067221,1.5175259 c 1.222061,-0.2161023 2.439998,-0.3246688 3.620143,-0.3246688 4.371863,0 7.694479,1.5250844 8.080645,3.7101568 0.505041,2.8653309 -3.998751,6.1566821 -9.83523,7.1866891 z",id:"path10"})))}var $o=i.forwardRef((function(e,t){return i.createElement(qo,Yo({svgRef:t},e))}));n.p;function Jo(e){var t=e.alt,n=e.onClick,r=e.isActive,a=e.children,o="btn btn-outline-secondary mr-2 icon",i="".concat(o," active");return l.a.createElement("button",{className:r?i:o,onClick:n,type:"button",title:t},a)}function Ko(e){var t=e.setActiveTool,n=e.activeTool,r=e.visibleTools,a=void 0===r?{pan:!0,selectRectangle:!0,selectLasso:!0}:r;return l.a.createElement("div",{className:"tool"},a.pan&&l.a.createElement(Jo,{alt:"pointer tool",onClick:function(){return t(null)},isActive:null===n},l.a.createElement(Fo,null)),a.selectRectangle?l.a.createElement(Jo,{alt:"select rectangle",onClick:function(){return t(oo.SELECTION_TYPE.RECTANGLE)},isActive:n===oo.SELECTION_TYPE.RECTANGLE},l.a.createElement(Vo,null)):null,a.selectLasso?l.a.createElement(Jo,{alt:"select lasso",onClick:function(){return t(oo.SELECTION_TYPE.POLYGON)},isActive:n===oo.SELECTION_TYPE.POLYGON},l.a.createElement($o,null)):null)}var Qo=function(){return"crosshair"},ei=function(e){return e.isDragging?"grabbing":"default"},ti=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).state={gl:null,tool:null},r.viewport=null,r.onViewStateChange=r.onViewStateChange.bind(Object(se.a)(r)),r.onInitializeViewInfo=r.onInitializeViewInfo.bind(Object(se.a)(r)),r.onWebGLInitialized=r.onWebGLInitialized.bind(Object(se.a)(r)),r.onToolChange=r.onToolChange.bind(Object(se.a)(r)),r.onHover=r.onHover.bind(Object(se.a)(r)),r}return Object(N.a)(n,[{key:"onViewStateChange",value:function(e){var t=e.viewState,n=this.props,r=n.setViewState,a=n.viewState,o=n.layers,i=n.spatialAxisFixed,l=null===o||void 0===o?void 0:o.some((function(e){return e.use3d}));r(Object(je.a)({},t,{target:i&&l?a.target:t.target}))}},{key:"onInitializeViewInfo",value:function(e){var t=e.viewport;this.viewport=t}},{key:"onWebGLInitialized",value:function(e){this.setState({gl:e})}},{key:"onToolChange",value:function(e){var t=this.props.onToolChange;this.setState({tool:e}),t&&t(e)}},{key:"getLayers",value:function(){return[]}},{key:"onHover",value:function(e){var t=e.coordinate,n=e.layer,r=e.sourceLayer,a=this.props,o=a.setCellHighlight,i=a.cellHighlight,l=a.setComponentHover,c=(a.layers||[]).some((function(e){return"bitmask"===e.type}));if(!o)return null;if(!r||!t)return i&&c&&o(null),null;var s=r.props,u=s.channelData,p=s.bounds;if(!u)return i&&c&&o(null),null;var d=u.data,f=u.width;if(!d)return i&&c&&o(null),null;if(r.id.includes("bitmask")){var m=n.props.loader[0].tileSize,h=r.props.tileId.z,b=Math.max(1,Math.pow(2,Math.round(-h+Math.log2(512/m)))),v=[Math.floor((t[0]-p[0])/b),Math.floor((t[1]-p[3])/b)],g=v[1]*f+v[0],y=d.map((function(e){return e[g]})).find((function(e){return e>0}));y!==Number(i)&&(l&&l(),o(y?String(y):null))}}},{key:"viewInfoDidUpdate",value:function(e){var t=this.props,n=t.updateViewInfo,r=t.cells,a=t.uuid,i=this.viewport;n&&i&&n({uuid:a,project:function(t){var n=r[t];try{var a=e(n),l=Object(o.a)(a,2),c=l[0],s=l[1];return i.project([c,s])}catch(u){return[null,null]}}})}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.deckRef,n=e.viewState,r=e.uuid,a=e.layers,o=this.state,i=o.gl,c=o.tool,s=this.getLayers(),u=(a||[]).some((function(e){return e.use3d})),p=null!==this.cellsLayer||this.cellsEntries.length&&this.cellsEntries[0][1].xy,d=null!==this.cellsLayer||a.findIndex((function(e){return"bitmask"===e.type||"raster"===e.type}))>=0,f=this.cellsEntries.length<1e5&&!u;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ko,{activeTool:c,setActiveTool:this.onToolChange,visibleTools:{pan:d,selectRectangle:p,selectLasso:p}}),l.a.createElement(No.a,{id:"deckgl-overlay-".concat(r),ref:t,views:[u?new Po.a({id:"orbit",controller:!0,orbitAxis:"Y"}):new Ro.a({id:"ortho"})],layers:i&&n.target.slice(0,2).every((function(e){return"number"===typeof e}))?s:[],glOptions:Me,onWebGLInitialized:this.onWebGLInitialized,onViewStateChange:this.onViewStateChange,viewState:n,useDevicePixels:f,controller:!c||{dragPan:!1},getCursor:c?Qo:ei,onHover:this.onHover},this.onInitializeViewInfo))}}]),n}(i.PureComponent);function ni(e){return function(){return e}}function ri(e){return e+1e-6*(Math.random()-.5)}var ai=function(e){return function(t){var n=t[1].mappings;if(!(e in n)){var r=Object.keys(n).map((function(e){return'"'.concat(e,'"')})).join(", ");throw new Error('Expected to find "'.concat(e,'", but available mappings are: ').concat(r))}var a=n[e];return[a[0],-a[1],0]}},oi=function(e){return function(t){return t.mappings[e]}},ii=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).cellsEntries=[],r.cellsQuadTree=null,r.cellsLayer=null,r.cellSetsForceSimulation=function(){var e,t,n,r=1,a=1,o=ni([0,0]);function i(e){return e.x+e.vx+n[e.index][0]/2}function l(e){return e.y+e.vy+n[e.index][1]/2}function c(e){if(e.data)e.size=n[e.data.index];else{e.size=[0,0];for(var t=0;t<4;t++)e[t]&&e[t].size&&(e.size[0]=Math.max(e.size[0],e[t].size[0]),e.size[1]=Math.max(e.size[1],e[t].size[1]))}}function s(){var o,s,u,p,d,f=Object(Io.a)(e,i,l).visitAfter(c);function m(e,n,a,c,f){var m=e.data,h=(s[0]+e.size[0])/2,b=(s[1]+e.size[1])/2;if(m&&m.index>o.index){var v=ri(p-i(m)),g=ri(d-l(m)),y=Math.abs(v)-h,O=Math.abs(g)-b;if(y<0&&O<0){var j=Math.sqrt(v*v+g*g),E=t[m.index]/(u+t[m.index]);Math.abs(y)<Math.abs(O)?(o.vx-=(v*=y/j*r)*E,m.vx+=v*(1-E)):(o.vy-=(g*=O/j*r)*E,m.vy+=g*(1-E))}return n>p+h||c<p-h||a>d+b||f<d-b}return!1}function h(){for(var r=0;r<e.length;r++)o=e[r],s=n[r],u=t[r],p=i(o),d=l(o),f.visit(m)}for(var b=0;b<a;b++)h()}return s.initialize=function(r){n=(e=r).map(o),t=n.map((function(e){return e[0]+e[1]}))},s.iterations=function(){return arguments.length?(a=+(arguments.length<=0?void 0:arguments[0]),s):a},s.strength=function(){return arguments.length?(r=+(arguments.length<=0?void 0:arguments[0]),s):r},s.size=function(){return arguments.length?(o="function"===typeof(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:ni(arguments.length<=0?void 0:arguments[0]),s):o},s}(),r.cellSetsLabelPrevZoom=null,r.cellSetsLayers=[],r.onUpdateCellsData(),r.onUpdateCellsLayer(),r.onUpdateCellSetsLayers(),r}return Object(N.a)(n,[{key:"createCellsLayer",value:function(){var e=this.cellsEntries,t=this.props,n=t.theme,r=t.mapping,a=t.getCellPosition,o=void 0===a?ai(r):a,i=t.cellRadiusScale,l=void 0===i?.2:i,c=t.cellOpacity,s=void 0===c?1:c,u=t.cellFilter,p=t.cellSelection,d=t.setCellHighlight,f=t.setComponentHover,m=t.getCellIsSelected,h=void 0===m?function(e){return function(t){return!e||e.includes(t[0])}}(e.length===p.length?null:p):m,b=t.cellColors,v=t.getCellColor,g=void 0===v?function(e){return function(t){return e&&e.get(t[0])||Ae}}(b):v,y=t.onCellClick,O=u?e.filter((function(e){return u.includes(e[0])})):e;return new Oo(Object(je.a)({id:"scatterplot",backgroundColor:"dark"===n?[0,0,0]:[241,241,241],isSelected:h,opacity:s,radiusScale:l,radiusMinPixels:1,radiusMaxPixels:10,getPosition:o,getColor:g,getLineWidth:0,onClick:function(e){y&&y(e)}},Ie(O,void 0,d,f)))}},{key:"createCellSetsLayers",value:function(){var e=this.props,t=e.theme,n=e.cellSetPolygons,r=e.viewState,a=e.cellSetPolygonsVisible,o=e.cellSetLabelsVisible,i=e.cellSetLabelSize,l=[];if(a&&l.push(new Va.a({id:"cell-sets-polygon-layer",data:n,stroked:!0,filled:!1,wireframe:!0,lineWidthMaxPixels:1,getPolygon:function(e){return e.hull},getLineColor:function(e){return e.color},getLineWidth:1})),o){var c=r.zoom,s=n.map((function(e){return{x:e.centroid[0],y:e.centroid[1],label:e.name}})),u=this.cellSetsForceSimulation.size((function(e){return[1*i/Math.pow(2,c)*4*e.label.length,1*i/Math.pow(2,c)*1.5]}));Object(Wa.a)().nodes(s).force("collision",u).tick(100),l.push(new Ya.a({id:"cell-sets-text-layer",data:s,getPosition:function(e){return[e.x,e.y]},getText:function(e){return e.label},getColor:"dark"===t?[255,255,255]:[0,0,0],getSize:i,getAngle:0,getTextAnchor:"middle",getAlignmentBaseline:"center",fontFamily:"-apple-system, 'Helvetica Neue', Arial, sans-serif",fontWeight:"normal"}))}return l}},{key:"createSelectionLayers",value:function(){var e=this.props,t=e.viewState,n=e.mapping,r=e.getCellCoords,a=void 0===r?oi(n):r,o=e.setCellSelection,i=this.state.tool,l=this.cellsQuadTree;return bo(i,t.zoom,"scatterplot",a,o,l,!0)}},{key:"getLayers",value:function(){var e=this.cellsLayer,t=this.cellSetsLayers;return[e].concat(Object(G.a)(t),Object(G.a)(this.createSelectionLayers()))}},{key:"onUpdateCellsData",value:function(){var e=this.props,t=e.cells,n=void 0===t?{}:t,r=e.mapping,a=e.getCellCoords,o=void 0===a?oi(r):a,i=Object.entries(n);this.cellsEntries=i,this.cellsQuadTree=Ao(i,o)}},{key:"onUpdateCellsLayer",value:function(){this.cellsLayer=this.createCellsLayer()}},{key:"onUpdateCellSetsLayers",value:function(e){if(e){var t=this.props,n=t.viewState,r=t.cellSetLabelsVisible,a=n.zoom,o=this.cellSetsLabelPrevZoom;r&&(null===o||Math.abs(o-a)>.25)&&(this.cellSetsLayers=this.createCellSetsLayers(),this.cellSetsLabelPrevZoom=a)}else this.cellSetsLayers=this.createCellSetsLayers()}},{key:"viewInfoDidUpdate",value:function(){var e=this.props,t=e.mapping,r=e.getCellPosition,a=void 0===r?ai(t):r;Object(fe.a)(Object(de.a)(n.prototype),"viewInfoDidUpdate",this).call(this,(function(e){return a([null,e])}))}},{key:"componentDidUpdate",value:function(e){var t=this;this.viewInfoDidUpdate();var n=function(n){return e[n]!==t.props[n]};["cells"].some(n)&&(this.onUpdateCellsData(),this.forceUpdate()),["cells","cellFilter","cellSelection","cellColors","cellRadiusScale"].some(n)&&(this.onUpdateCellsLayer(),this.forceUpdate()),["cellSetPolygons","cellSetPolygonsVisible","cellSetLabelsVisible","cellSetLabelSize"].some(n)&&(this.onUpdateCellSetsLayers(!1),this.forceUpdate()),n("viewState")&&(this.onUpdateCellSetsLayers(!0),this.forceUpdate())}}]),n}(ti),li=Object(i.forwardRef)((function(e,t){return l.a.createElement(ii,Object.assign({},e,{deckRef:t}))}));function ci(e){var t=e.x,n=e.y,r=e.parentWidth,a=e.parentHeight,o=e.children,c=Object(i.useRef)(null),s=r<500;return Object(i.useEffect)((function(){var e=c.current,o=s?-5:10,i=t>r/2?-(100+o):o,l=n>a/2?-(100+o):o,u=s?.75:1;e.style.transform="translateX(".concat(i,"%) translateY(").concat(l,"%) scale(").concat(u,")"),e.style.whiteSpace=s?"normal":"nowrap"})),l.a.createElement("div",{ref:c,className:"cell-tooltip bg-primary",style:{left:"".concat(t,"px"),top:"".concat(n,"px")}},o)}function si(e){var t=e.parentUuid,n=e.sourceUuid,r=e.x,a=e.y,o=e.parentWidth,i=e.parentHeight,c=e.children;if(r<0||r>o||a<0||a>i)return null;var s=t===n;return l.a.createElement(l.a.Fragment,null,s?l.a.createElement(ci,{x:r,y:a,parentWidth:o,parentHeight:i},c):l.a.createElement(l.a.Fragment,null,null!==r?l.a.createElement("div",{className:"cell-emphasis-crosshair",style:{left:"".concat(r-.5,"px"),top:0,width:"".concat(1,"px"),height:"".concat(i,"px")}}):null,null!==a?l.a.createElement("div",{className:"cell-emphasis-crosshair",style:{left:0,top:"".concat(a-.5,"px"),width:"".concat(o,"px"),height:"".concat(1,"px")}}):null))}function ui(e){var t=e.info;return l.a.createElement("table",null,l.a.createElement("tbody",null,Object.entries(t).map((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1];return l.a.createElement("tr",{key:n},l.a.createElement("th",null,n),l.a.createElement("td",null,r))}))))}function pi(e){var t=e.parentUuid,n=e.cellHighlight,r=e.width,a=e.height,i=e.getCellInfo,c=Tn(),s=An(t),u=n&&i?[i(n)].concat(Object(G.a)(s&&s.project?s.project(n):[null,null])):[null,null,null],p=Object(o.a)(u,3),d=p[0],f=p[1],m=p[2];return d?l.a.createElement(si,{x:f,y:m,parentUuid:t,sourceUuid:c,parentWidth:r,parentHeight:a},l.a.createElement(ui,{info:d})):null}var di=n(1442),fi=n(1450),mi=n(1420),hi=n(1419),bi=Object(E.a)((function(e){return{box:{boxSizing:"border-box"},checkbox:{padding:"3px",color:e.palette.primaryForeground,"&:checked":{color:e.palette.primaryForeground},"& input":{height:"100%"}},slider:{color:e.palette.primaryForeground,minWidth:"60px",padding:"10px 0 6px 0"},sliderValueLabel:{"& span":{"& span":{color:e.palette.primaryBackground}}},tableContainer:{overflow:"hidden"},labelCell:{padding:"2px 8px 2px 16px"},inputCell:{padding:"2px 16px 2px 8px",overflow:"visible"},select:{"& select":{fontSize:".875rem"}}}})),vi=n(1435),gi=n(1417),yi=n(1418),Oi=n(1416);function ji(e){var t=e.children,n=bi();return l.a.createElement(vi.a,{className:n.box},l.a.createElement(Oi.a,{className:n.tableContainer},l.a.createElement(gi.a,{className:n.table,size:"small"},l.a.createElement(yi.a,null,t))))}var Ei=n(1434);function xi(e){var t=e.observationsLabel,n=e.cellColorEncoding,r=e.setCellColorEncoding,a=bi(),o=F(t);return l.a.createElement(hi.a,null,l.a.createElement(mi.a,{className:a.labelCell,htmlFor:"cell-color-encoding-select"},o," Color Encoding"),l.a.createElement(mi.a,{className:a.inputCell},l.a.createElement(Ei.a,{native:!0,className:a.select,value:n,onChange:function(e){r(e.target.value)},inputProps:{id:"cell-color-encoding-select"}},l.a.createElement("option",{value:"cellSetSelection"},"Cell Sets"),l.a.createElement("option",{value:"geneSelection"},"Gene Expression"))))}function Ci(e){var t=e.observationsLabel,n=e.cellRadius,r=e.setCellRadius,a=e.cellSetLabelsVisible,o=e.setCellSetLabelsVisible,i=e.cellSetLabelSize,c=e.setCellSetLabelSize,s=e.cellSetPolygonsVisible,u=e.setCellSetPolygonsVisible,p=e.cellColorEncoding,d=e.setCellColorEncoding,f=F(t),m=bi();return l.a.createElement(ji,null,l.a.createElement(hi.a,null,l.a.createElement(mi.a,{className:m.labelCell},f," Set Labels Visible"),l.a.createElement(mi.a,{className:m.inputCell},l.a.createElement(di.a,{className:m.checkbox,checked:a,onChange:function(e){o(e.target.checked)},name:"scatterplot-option-cell-set-labels",color:"default"}))),l.a.createElement(hi.a,null,l.a.createElement(mi.a,{className:m.labelCell},f," Set Label Size"),l.a.createElement(mi.a,{className:m.inputCell},l.a.createElement(fi.a,{disabled:!a,classes:{root:m.slider,valueLabel:m.sliderValueLabel},value:i,onChange:function(e,t){c(t)},"aria-labelledby":"cell-set-label-size-slider",valueLabelDisplay:"auto",step:1,min:8,max:36}))),l.a.createElement(hi.a,null,l.a.createElement(mi.a,{className:m.labelCell},f," Set Polygons Visible"),l.a.createElement(mi.a,{className:m.inputCell},l.a.createElement(di.a,{className:m.checkbox,checked:s,onChange:function(e){u(e.target.checked)},name:"scatterplot-option-cell-set-polygons",color:"default"}))),l.a.createElement(hi.a,null,l.a.createElement(mi.a,{className:m.labelCell},f," Radius"),l.a.createElement(mi.a,{className:m.inputCell},l.a.createElement(fi.a,{classes:{root:m.slider,valueLabel:m.sliderValueLabel},value:n,onChange:function(e,t){r(t)},"aria-labelledby":"cell-radius-slider",valueLabelDisplay:"auto",step:.25,min:.25,max:8}))),l.a.createElement(xi,{observationsLabel:t,cellColorEncoding:p,setCellColorEncoding:d}))}var Si=["cells","expression-matrix","cell-sets"];var Li=n(7),wi=function(e){return e.xy},Ti=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).cellsEntries=[],r.moleculesEntries=[],r.cellsQuadTree=null,r.cellsLayer=null,r.moleculesLayer=null,r.neighborhoodsLayer=null,r.imageLayers=[],r.layerLoaderSelections={},r.randomColorData={data:new Uint8Array(12582912).map((function(e,t){return t<4?0:Math.round(255*Math.random())})),height:2048,width:2048},r.color=Object(je.a)({},r.randomColorData),r.onUpdateCellsData(),r.onUpdateCellsLayer(),r.onUpdateMoleculesData(),r.onUpdateMoleculesLayer(),r.onUpdateNeighborhoodsData(),r.onUpdateNeighborhoodsLayer(),r.onUpdateImages(),r}return Object(N.a)(n,[{key:"createCellsLayer",value:function(e){var t=e.radius,n=e.stroked,r=e.visible,a=e.opacity,o=this.cellsEntries,i=this.props,l=i.cellFilter,c=i.cellSelection,s=i.setCellHighlight,u=i.setComponentHover,p=i.getCellIsSelected,d=void 0===p?function(e){return function(t){return!e||e.includes(t[0])}}(o.length===c.length?null:c):p,f=i.cellColors,m=i.getCellColor,h=void 0===m?function(e){return function(t){return e&&e.get(t[0])||Ae}}(f):m,b=i.getCellPolygon,v=void 0===b?function(e){return function(t){var n,r,a,o,i=t[1];return(null===(n=i.poly)||void 0===n?void 0:n.length)?i.poly:(r=i.xy[0],a=i.xy[1],[[r,a+(o=e)],[r+o,a],[r,a-o],[r-o,a]])}}(t):b,g=i.onCellClick,y=i.lineWidthScale,O=void 0===y?10:y,j=i.lineWidthMaxPixels,E=void 0===j?2:j,x=l?o.filter((function(e){return l.includes(e[0])})):o;return new go(Object(je.a)({id:"cells-layer",backgroundColor:[0,0,0],isSelected:d,getPolygon:v,updateTriggers:{getFillColor:[a],getLineWidth:[n]},getFillColor:function(e){var t=h(e);return t[3]=255*a,t},getLineColor:function(e){var t=h(e);return t[3]=255,t},onClick:function(e){g&&g(e)},visible:r,getLineWidth:n?1:0,lineWidthScale:O,lineWidthMaxPixels:E},Ie(x,void 0,s,u)))}},{key:"createMoleculesLayer",value:function(e){var t=this.props,n=t.setMoleculeHighlight,r=t.getMoleculeColor,a=void 0===r?function(e){return Ne[e[2]%Ne.length]}:r,o=t.getMoleculePosition,i=void 0===o?function(e){return[e[0],e[1],0]}:o,l=this.moleculesEntries;return new yo.a({id:"molecules-layer",coordinateSystem:we.a.CARTESIAN,data:l,pickable:!0,autoHighlight:!0,radiusMaxPixels:3,opacity:e.opacity,visible:e.visible,getRadius:e.radius,getPosition:i,getLineColor:a,getFillColor:a,onHover:function(e){n&&(e.object?n(e.object[3]):n(null))}})}},{key:"createNeighborhoodsLayer",value:function(e){var t=this.props.getNeighborhoodPolygon,n=void 0===t?function(e){return e[1].poly}:t,r=this.neighborhoodsEntries;return new Va.a({id:"neighborhoods-layer",getPolygon:n,coordinateSystem:we.a.CARTESIAN,data:r,pickable:!0,autoHighlight:!0,stroked:!0,filled:!1,getElevation:0,getLineWidth:10,visible:e.visible})}},{key:"createSelectionLayers",value:function(){var e=this.props,t=e.viewState,n=e.getCellCoords,r=void 0===n?wi:n,a=e.setCellSelection,o=this.state.tool,i=this.cellsQuadTree;return bo(o,t.zoom,"cells-layer",r,a,i)}},{key:"createScaleBarLayer",value:function(){var e=this.props,t=e.viewState,n=e.width,r=e.height,a=e.imageLayerLoaders,o=void 0===a?{}:a,i=(e.layers||[]).some((function(e){return e.use3d})),l=Object.values(o);if(!t||!n||!r||l.length<1)return null;var c=l[0];if(!c)return null;var s=U(c);if(!s.meta)return null;var u=s.meta.physicalSizes;if(u&&!i){var p=u.x,d=p.unit,f=p.size;return d&&f?new Ee.f({id:"scalebar-layer",loader:c,unit:d,size:f,viewState:Object(je.a)({},t,{width:n,height:r})}):null}return null}},{key:"createImageLayer",value:function(e,t,n){var r,a=Object(je.a)({},e,{channels:e.channels.filter((function(e){return e.selection&&e.color&&e.slider}))}),i=a.channels.map((function(e){return e.selection})),l=this.layerLoaderSelections[a.index];O()(l,i)?r=l:(r=i,this.layerLoaderSelections[a.index]=i);var c={colormap:a.colormap,opacity:a.opacity,transparentColor:a.transparentColor,colors:a.channels.map((function(e){return e.color})),sliders:a.channels.map((function(e){return e.slider})),resolution:a.resolution,renderingMode:a.renderingMode,xSlice:a.xSlice,ySlice:a.ySlice,zSlice:a.zSlice,callback:a.callback,visibilities:a.channels.map((function(e){return!(!a.visible&&"boolean"===typeof a.visible)&&e.visible}))};if(!t||!c)return null;var s,u=t.metadata.transform,p=t.data;if(u){var d=u.scale,f=u.translate;s=(new Se.Matrix4).translate([f.x,f.y,0]).scale(d)}else a.modelMatrix&&(s=new Se.Matrix4(a.modelMatrix));if("bitmask"===e.type)return new Ee.d({id:"bitmask-layer-".concat(a.index,"-").concat(n),channelIsOn:c.visibilities,opacity:c.opacity,modelMatrix:s,hoveredCell:Number(this.props.cellHighlight),renderSubLayers:ft,loader:p,loaderSelection:r,cellColorData:this.color.data,cellColorHeight:this.color.height,cellColorWidth:this.color.width,excludeBackground:!0,onViewportLoad:c.callback});var m=function(e,t){var n=Array.isArray(e)&&e.length>1||!Array.isArray(e)?e:e[0];return t?[Ee.g,Array.isArray(n)?n:[n]]:[Array.isArray(e)&&e.length>1?Ee.d:Ee.b,n]}(p,a.use3d),h=Object(o.a)(m,2);return new(0,h[0])({loader:h[1],id:"".concat(a.use3d?"volume":"image","-layer-").concat(a.index,"-").concat(n),colorValues:c.colors,sliderValues:c.sliders,loaderSelection:r,channelIsOn:c.visibilities,opacity:c.opacity,colormap:c.colormap,modelMatrix:s,transparentColor:c.transparentColor,resolution:c.resolution,renderingMode:c.renderingMode,pickable:!1,xSlice:c.xSlice,ySlice:c.ySlice,zSlice:c.zSlice,onViewportLoad:c.callback})}},{key:"createImageLayers",value:function(){var e=this,t=this.props,n=t.layers,r=t.imageLayerLoaders,a=void 0===r?{}:r,o=t.rasterLayersCallbacks,i=void 0===o?[]:o,l=(n||[]).some((function(e){return e.use3d})),c=(n||[]).findIndex((function(e){return e.use3d}));return(n||[]).filter((function(e){return"raster"===e.type||"bitmask"===e.type})).filter((function(e){return!l||e.use3d===l})).map((function(t,n){return e.createImageLayer(Object(je.a)({},t,{callback:i[l?c:n]}),a[t.index],n)}))}},{key:"getLayers",value:function(){var e=this.imageLayers,t=this.cellsLayer,n=this.neighborhoodsLayer,r=this.moleculesLayer;return[].concat(Object(G.a)(e),[t,n,r,this.createScaleBarLayer()],Object(G.a)(this.createSelectionLayers()))}},{key:"onUpdateCellsData",value:function(){var e=this.props,t=e.cells,n=void 0===t?{}:t,r=e.getCellCoords,a=void 0===r?wi:r,o=Object.entries(n);this.cellsEntries=o,this.cellsQuadTree=Ao(o,a)}},{key:"onUpdateCellsLayer",value:function(){var e=(this.props.layers||[]).find((function(e){return"cells"===e.type}));this.cellsLayer=e?this.createCellsLayer(e):null}},{key:"onUpdateCellColors",value:function(){var e=this.randomColorData;if("number"===typeof this.props.cellColors.size){var t=this.props.cellColors.keys();e.data=new Uint8Array(e.height*e.width*3).fill(128),e.data[0]=0,e.data[1]=0,e.data[2]=0;var n,r=Object(Li.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a>0){var o=this.props.cellColors.get(a);o&&e.data.set(o.slice(0,3),3*Number(a))}}}catch(i){r.e(i)}finally{r.f()}}this.color=e}},{key:"onUpdateMoleculesData",value:function(){var e=this.props.molecules,t=void 0===e?{}:e,n=Object.entries(t).flatMap((function(e,t){var n=Object(o.a)(e,2),r=n[0];return n[1].map((function(e){var n=Object(o.a)(e,2);return[n[0],n[1],t,r]}))}));this.moleculesEntries=n}},{key:"onUpdateMoleculesLayer",value:function(){var e=(this.props.layers||[]).find((function(e){return"molecules"===e.type}));this.moleculesLayer=e?this.createMoleculesLayer(e):null}},{key:"onUpdateNeighborhoodsData",value:function(){var e=this.props.neighborhoods,t=void 0===e?{}:e,n=Object.entries(t);this.neighborhoodsEntries=n}},{key:"onUpdateNeighborhoodsLayer",value:function(){var e=(this.props.layers||[]).find((function(e){return"neighborhoods"===e.type}));this.neighborhoodsLayer=e?this.createNeighborhoodsLayer(e):null}},{key:"onUpdateImages",value:function(){this.imageLayers=this.createImageLayers()}},{key:"viewInfoDidUpdate",value:function(){var e=this.props.getCellCoords,t=void 0===e?wi:e;Object(fe.a)(Object(de.a)(n.prototype),"viewInfoDidUpdate",this).call(this,t)}},{key:"componentDidUpdate",value:function(e){var t=this;this.viewInfoDidUpdate();var n=function(n){return e[n]!==t.props[n]};["cells"].some(n)&&(this.onUpdateCellsData(),this.forceUpdate()),["layers","cells","cellFilter","cellSelection","cellColors"].some(n)&&(this.onUpdateCellsLayer(),this.forceUpdate()),["cellColors"].some(n)&&(this.onUpdateCellColors(),this.forceUpdate()),["molecules"].some(n)&&(this.onUpdateMoleculesData(),this.forceUpdate()),["layers","molecules"].some(n)&&(this.onUpdateMoleculesLayer(),this.forceUpdate()),["neighborhoods"].some(n)&&(this.onUpdateNeighborhoodsData(),this.forceUpdate()),["layers","neighborhoods"].some(n)&&(this.onUpdateNeighborhoodsLayer(),this.forceUpdate()),["layers","imageLayerLoaders","cellColors","cellHighlight","rasterLayersCallbacks"].some(n)&&(this.onUpdateImages(),this.forceUpdate())}}]),n}(ti),_i=Object(i.forwardRef)((function(e,t){return l.a.createElement(Ti,Object.assign({},e,{deckRef:t}))})),ki=n(1447),Ii=Object(E.a)((function(){return Object(ki.a)({cameraLabel:{padding:"0px 0px 0px 16px"},box:{padding:"0px"},button:{padding:"0px 0px 0px 8px"}})})),Ai=function(e){var t=e.setSpatialAxisFixed,n=e.spatialAxisFixed,r=e.use3d,a=Ii();return l.a.createElement(hi.a,null,l.a.createElement(mi.a,{className:a.cameraLabel},"Fix Camera Axis"),l.a.createElement(mi.a,{className:a.box},l.a.createElement(di.a,{onClick:function(){return t(!n)},disabled:!r,checked:Boolean(n)})))};function Ni(e){var t=e.observationsLabel,n=e.cellColorEncoding,r=e.setCellColorEncoding,a=e.setSpatialAxisFixed,o=e.spatialAxisFixed,i=e.use3d;return l.a.createElement(ji,null,l.a.createElement(xi,{observationsLabel:t,cellColorEncoding:n,setCellColorEncoding:r}),l.a.createElement(Ai,{setSpatialAxisFixed:a,spatialAxisFixed:o,use3d:i}))}function Pi(e){var t=e.parentUuid,n=e.cellHighlight,r=e.width,a=e.height,i=e.getCellInfo,c=Tn(),s=An(t),u=n&&i?[i(n)].concat(Object(G.a)(s&&s.project?s.project(n):[null,null])):[null,null,null],p=Object(o.a)(u,3),d=p[0],f=p[1],m=p[2];return d?l.a.createElement(si,{x:f,y:m,parentUuid:t,sourceUuid:c,parentWidth:r,parentHeight:a},l.a.createElement(ui,{info:d})):null}var Ri=["cells","molecules","raster","cell-sets","expression-matrix"];var Mi=n(1421),Gi=Object(E.a)((function(){return{box:{opacity:.5,height:"80px",bottom:0,right:0,backgroundColor:"transparent",position:"absolute",padding:"10px 0",transition:"opacity 0.1s","&:hover":{opacity:1}}}}));function Di(e){var t=e.colorScaleLo,n=e.colorScaleHi,r=e.onColorScaleChange,a=Gi();return l.a.createElement(vi.a,{component:"div",m:1,className:a.box},l.a.createElement(fi.a,{orientation:"vertical",value:[t,n],onChange:r,"aria-labelledby":"colorscale-slider",min:0,max:1,step:.005}))}function zi(e){var t=e.layer,n=e.viewport;return"axisLeft"===n.id?t.id.startsWith("axisLeft"):"axisTop"===n.id?t.id.startsWith("axisTop"):"heatmap"===n.id?t.id.startsWith("heatmap"):"colorsLeft"===n.id?t.id.startsWith("colorsLeft"):"colorsTop"===n.id&&t.id.startsWith("colorsTop")}var Hi=n(831),Fi=n.n(Hi),Bi="undefined"!==typeof navigator?navigator.hardwareConcurrency||4:null,Ui=function(e){Object(P.a)(n,e);var t=Object(R.a)(n);function n(){return Object(A.a)(this,n),t.call(this,Fi.a)}return Object(N.a)(n,[{key:"process",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r=this;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitForWorker();case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,a){n.onmessage=function(t){r.finishTask(n),e(t.data)},n.onerror=function(e){r.finishTask(n),a(e)},n.postMessage(["getTile",t],[t.data])})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(function(){function e(t){Object(A.a)(this,e),this.workers=[],this.idleWorkers=[],this.waitQueue=[],this.decoder=null;for(var n=0;n<Bi;++n){var r=new t;this.workers.push(r),this.idleWorkers.push(r)}}return Object(N.a)(e,[{key:"process",value:function(){var e=Object(ce.a)(le.a.mark((function e(){return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error('Pool needs to implement "process" method');case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"waitForWorker",value:function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n,r;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.idleWorkers.pop())){e.next=3;break}return e.abrupt("return",t);case 3:return n={},r=new Promise((function(e){n.resolve=e})),this.waitQueue.push(n),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"finishTask",value:function(){var e=Object(ce.a)(le.a.mark((function e(t){var n;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.waitQueue.pop())?n.resolve(t):this.idleWorkers.push(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){for(var e=0;e<this.workers.length;++e)this.workers[e].terminate()}}]),e}()),Xi=Object(i.forwardRef)((function(e,t){var n,r=e.uuid,a=e.theme,c=e.viewState,s=e.setViewState,u=e.setHeatmapControls,p=e.heatmapControls,d=void 0===p?[0,1]:p,f=e.width,m=e.height,h=e.expressionMatrix,b=e.cellColors,v=e.clearPleaseWait,g=e.setComponentHover,y=e.setCellHighlight,j=void 0===y?(n="Heatmap",function(e){return console.warn("".concat(n," updateCellsHover: ").concat(e.cellId))}):y,E=e.setGeneHighlight,x=void 0===E?function(e){return function(t){return console.warn("".concat(e," updateGenesHover: ").concat(t.geneId))}}("Heatmap"):E,C=e.updateViewInfo,S=void 0===C?function(e){return function(t){return console.warn("".concat(e," updateViewInfo: ").concat(t))}}("Heatmap"):C,L=e.setIsRendering,w=void 0===L?function(){}:L,T=e.transpose,_=void 0!==T&&T,k=e.variablesTitle,I=void 0===k?"Genes":k,A=e.observationsTitle,N=void 0===A?"Cells":A,P=Object(je.a)({},c,{target:_?[c.target[1],c.target[0]]:c.target,minZoom:0}),R=_?I:N,M=_?N:I,D=Object(i.useMemo)((function(){return new Ui}),[]);Object(i.useEffect)((function(){v&&h&&v("expression-matrix")}),[v,h]);var z=Object(i.useRef)(),H=Object(i.useRef)(),F=Object(i.useState)([]),B=Object(o.a)(F,2),U=B[0],X=B[1],Z=Object(i.useState)([]),V=Object(o.a)(Z,2),Y=V[0],W=V[1],q=Object(i.useState)(d[0]),J=Object(o.a)(q,2),K=J[0],Q=J[1],ee=Object(i.useState)(d[1]),te=Object(o.a)(ee,2),ne=te[0],re=te[1],ae=Object(i.useCallback)((function(e,t){Q(t[0]),re(t[1]),u(t)}),[u]),oe=Object(i.useReducer)((function(e){return e+1}),0),ie=Object(o.a)(oe,2),se=ie[0],ue=ie[1],pe=Object(i.useState)([]),de=Object(o.a)(pe,2),fe=de[0],me=de[1];Object(i.useEffect)((function(){h&&h.matrix&&(H.current=function(e){var t=new ArrayBuffer(e.buffer.byteLength),n=new Uint8Array(t);return n.set(e),n}(h.matrix))}),[H,h]),Object(i.useEffect)((function(){if(h){var e=b&&0!==b.size?Array.from(b.keys()):h.rows,t=_?Y:U;O()(t,e)||(_?W(e):X(e))}}),[h,b,Y,U,_]),Object(i.useEffect)((function(){h&&(_?X(h.cols):W(h.cols))}),[h,_]);var he=Object(i.useMemo)((function(){return h?[Object(Mi.a)(h.rows.map((function(e){return e.length}))),Object(Mi.a)(h.cols.map((function(e){return e.length})))]:[0,0]}),[h]),be=Object(o.a)(he,2),ve=be[0],ye=be[1],Oe=Y.length,Ee=U.length,xe=function(e,t,n){return[Ba()(9*(e?t:n),10,90),Ba()(9*(e?n:t),10,90)]}(_,ye,ve),Ce=Object(o.a)(xe,2),Se=Ce[0],Le=Ce[1],we=Le+20,Te=Se+20,_e=f-Te,ke=m-we,Ie=-_e/2,Ae=_e/2,Ne=-ke/2,Pe=ke/2,Re=Math.ceil(Oe/2048),Ge=Math.ceil(Ee/2048),De=_e/(1-(2048-Oe%2048)/(2048*Re))/Re,ze=ke/(1-(2048-Ee%2048)/(2048*Ge))/Ge,He=Math.pow(2,P.zoom),Fe=ke*He/Ee,Be=_e*He/Oe,Ue=Ba()(Math.pow(2,Math.ceil(Math.log2(1/Be))),1,16),Xe=Ba()(Math.pow(2,Math.ceil(Math.log2(1/Fe))),1,16),Ze=Object(o.a)(P.target,2),Ve=Ze[0],Ye=Ze[1];Object(i.useEffect)((function(){S({uuid:r,project:function(e,t){return function(e,t,n){var r=n.offsetLeft,a=n.offsetTop,o=n.targetX,i=n.targetY,l=n.scaleFactor,c=n.matrixWidth,s=n.matrixHeight,u=n.numRows,p=n.numCols,d=null,f=null;if(null!==t){var m=-s*l/2,h=i*l-s/2,b=i*l+s/2,v=m+(t+.5)/u*(s*l/2-m);h<=v&&v<=b&&(d=a+(v-h)/(b-h)*s)}if(null!==e){var g=-c*l/2,y=o*l-c/2,O=o*l+c/2,j=g+(e+.5)/p*(c*l/2-g);y<=j&&j<=O&&(f=r+(j-y)/(O-y)*c)}return[f,d]}(_?Y.indexOf(e):Y.indexOf(t),_?U.indexOf(t):U.indexOf(e),{offsetLeft:Te,offsetTop:we,targetX:P.target[0],targetY:P.target[1],scaleFactor:He,matrixWidth:_e,matrixHeight:ke,numRows:Ee,numCols:Oe})}})}),[r,S,_,Y,U,Te,we,P,He,_e,ke,Ee,Oe]);var We=Object(i.useCallback)((function(e){var t=e.viewState,n=t.zoom,r=Math.pow(2,n),a=0===n?0:-(Ae-Ae/r),o=-1*a,i=0===n?0:-(Pe-Pe/r),l=-1*i,c=[Ba()(t.target[0],a,o),Ba()(t.target[1],i,l)];s({zoom:n,target:_?[c[1],c[0]]:c})}),[Ae,Pe,_,s]);Object(i.useEffect)((function(){h&&Y&&U&&Re&&Ge&&me((function(e){return[].concat(Object(G.a)(e),[$()()])}))}),[H,h,Y,U,Re,Ge]),Object(i.useEffect)((function(){if(!(fe.length<1)){var e=fe[fe.length-1];if(H.current&&H.current.buffer.byteLength){var t=h.rows,n=h.cols,r=h.matrix,a=ge()(Ge).map((function(a){return ge()(Re).map(function(){var o=Object(ce.a)(le.a.mark((function o(i){return le.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",D.process({curr:e,tileI:a,tileJ:i,tileSize:2048,cellOrdering:_?Y:U,rows:t,cols:n,transpose:_,data:r.buffer.slice()}));case 1:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}())}));(function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(a.flat());case 2:t=e.sent,z.current=t.map((function(e){return e.tile})),ue(),H.current=new Uint8Array(t[0].buffer),n=t[0].curr,me((function(e){var t=e.indexOf(n);return e.slice(t+1,e.length)}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}}}),[U,Y,fe,h,_,Re,Ge,D]),Object(i.useEffect)((function(){w(fe.length>0)}),[fe,w]);var qe=Object(i.useMemo)((function(){if(!z.current||fe.length)return[];return z.current.map((function(e,t){return function(e,t,n){return new wo({id:"heatmapLayer-".concat(se,"-").concat(e,"-").concat(t),image:n,bounds:[Ie+t*De,Ne+e*ze,Ie+(t+1)*De,Ne+(e+1)*ze],aggSizeX:Ue,aggSizeY:Xe,colorScaleLo:K,colorScaleHi:ne,updateTriggers:{image:[U,Y],bounds:[ze,De]}})}(Math.floor(t/Re),t%Re,e)}))}),[fe,se,Ie,De,Ne,ze,Ue,Xe,K,ne,U,Y,Re]),$e=Object(i.useMemo)((function(){return Y.map((function(e,t){return[t,e]}))}),[Y]),Je=Object(i.useMemo)((function(){return U.map((function(e,t){return[t,e]}))}),[U]),Ke=[new ko({targetX:Ve,targetY:Ye,scaleFactor:He,axisLeftLabelData:Je,matrixTop:Ne,height:Ee,matrixHeight:ke,cellHeight:Fe,cellWidth:Be,axisTopLabelData:$e,matrixLeft:Ie,width:Oe,matrixWidth:_e,viewHeight:m,viewWidth:f,theme:a,axisLeftTitle:R,axisTopTitle:M,axisOffsetLeft:Se,axisOffsetTop:Le})],Qe=Object(i.useMemo)((function(){if(!b)return null;var e,t,n,r,a=_?Y:U,i=_?2048:1,l=_?1:2048;return ge()(_?Re:Ge).map((function(c){var s=new Uint8ClampedArray(8192);return ge()(2048).forEach((function(i){if((r=2048*c+i)<a.length&&(e=a[r],n=b.get(e),t=4*(_?i:2048-i-1),n)){var l=n,u=Object(o.a)(l,3),p=u[0],d=u[1],f=u[2];s[t+0]=p,s[t+1]=d,s[t+2]=f,s[t+3]=255}})),new ImageData(s,i,l)}))}),[b,_,Y,U,Re,Ge]),et=Object(i.useMemo)((function(){return Qe?Qe.map((function(e,t){return new _o({id:"".concat(_?"colorsTopLayer":"colorsLeftLayer","-").concat(t,"-").concat($()()),image:e,bounds:_?[Ie+t*De,-ke/2,Ie+(t+1)*De,ke/2]:[-_e/2,Ne+t*ze,_e/2,Ne+(t+1)*ze]})})):[]}),[Qe,Ne,Ie,ke,_e,De,ze,_]),tt=qe.concat(Ke).concat(et);return l.a.createElement(l.a.Fragment,null,l.a.createElement(No.a,{id:"deckgl-overlay-".concat(r),ref:t,views:[new Ro.a({id:"heatmap",controller:!0,x:Te,y:we,width:_e,height:ke}),new Ro.a({id:"axisLeft",controller:!1,x:_?20:0,y:we,width:Se,height:ke}),new Ro.a({id:"axisTop",controller:!1,x:Te,y:_?0:20,width:_e,height:Le}),new Ro.a({id:"colorsLeft",controller:!1,x:Se,y:we,width:17,height:ke}),new Ro.a({id:"colorsTop",controller:!1,x:Te,y:Le,width:_e,height:17})],layers:tt,layerFilter:zi,getCursor:function(e){return e.isDragging?"grabbing":"default"},glOptions:Me,onViewStateChange:We,viewState:P,onHover:function(e,t){if(h){var n=t.offsetCenter,r=function(e,t,n){var r=n.offsetLeft,a=n.offsetTop,o=n.targetX,i=n.targetY,l=n.scaleFactor,c=n.matrixWidth,s=n.matrixHeight,u=n.numRows,p=n.numCols,d=e-r,f=t-a;if(d<0||f<0)return[null,null];var m=(o*l+c*l/2-c/2)/(c*l)+d/(c*l),h=(i*l+s*l/2-s/2)/(s*l)+f/(s*l),b=Math.floor(h*u);return[Math.floor(m*p),b]}(n.x,n.y,{offsetLeft:Te,offsetTop:we,targetX:Ve,targetY:Ye,scaleFactor:He,matrixWidth:_e,matrixHeight:ke,numRows:Ee,numCols:Oe}),a=Object(o.a)(r,2),i=a[0],l=a[1];null===i&&(_?j(null):x(null)),null===l&&(_?x(null):j(null));var c=h.rows.indexOf(_?Y[i]:U[l]),s=h.cols.indexOf(_?U[l]:Y[i]),u=h.rows[c],p=h.cols[s];g&&g(),j(u||null),x(p||null)}}}),l.a.createElement(Di,{colorScaleLo:K,colorScaleHi:ne,onColorScaleChange:ae}))}));function Zi(e){var t=e.parentUuid,n=e.width,r=e.height,a=e.transpose,i=e.getCellInfo,c=e.getGeneInfo,s=e.cellHighlight,u=e.geneHighlight,p=Tn(),d=An(t),f=s&&i?[i(s),d&&d.project?d.project(s,null)[a?0:1]:null]:[null,null],m=Object(o.a)(f,2),h=m[0],b=m[1],v=u&&c?[c(u),d&&d.project?d.project(null,u)[a?1:0]:null]:[null,null],g=Object(o.a)(v,2),y=g[0],O=g[1],j=a?b:O,E=a?O:b;return h||y?l.a.createElement(si,{x:j,y:E,parentUuid:t,parentWidth:n,parentHeight:r,sourceUuid:p},l.a.createElement(ui,{info:Object(je.a)({},y,{},h)})):null}var Vi=["cells","cell-sets","expression-matrix"];var Yi=n(1422),Wi=n(833),qi=n.n(Wi),$i=n(832),Ji=n.n($i),Ki=Object(E.a)((function(e){return{container:{width:"70px",height:"40px",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},button:{padding:"3px",width:"16px"},icon:{width:"17px",height:"17px",stroke:e.palette.action.selected,"stroke-width":"1px"}}})),Qi=function(e){var t=e.handleChange,n=Ki();return l.a.createElement("div",{className:n.container,"aria-label":"color-swatch"},Pe.map((function(e){return l.a.createElement(ur.a,{className:n.button,key:e,onClick:function(){return t(e)}},l.a.createElement(Ji.a,{fontSize:"small",style:{color:"rgb(".concat(e,")")},className:n.icon}))})))},el=Object(E.a)((function(){return{menuButton:{backgroundColor:"transparent"},colors:{"&:hover":{backgroundColor:"transparent"},paddingLeft:"2px",paddingRight:"2px"}}}));var tl=function(e){var t=e.handlePropertyChange,n=e.handleChannelRemove,r=e.handleIQRUpdate,a=Object(i.useReducer)((function(e){return!e}),!1),c=Object(o.a)(a,2),s=c[0],u=c[1],p=el();return l.a.createElement(_r,{open:s,toggle:u,buttonIcon:l.a.createElement(qi.a,{fontSize:"small"}),buttonClassName:p.menuButton},l.a.createElement(sr.a,{dense:!0,disableGutters:!0,onClick:function(){u(),n()}},l.a.createElement(Tr,null,"Remove")),l.a.createElement(sr.a,{dense:!0,disableGutters:!0,onClick:r},l.a.createElement(Tr,null,"Use IQR")),l.a.createElement(sr.a,{dense:!0,disableGutters:!0,className:p.colors},l.a.createElement(Qi,{handleChange:function(e){t("color",e)}})))};var nl=function(){var e={},t=["Int8","Int16","Int32"];return Object.keys(Ee.a).forEach((function(n){var r=Ee.a[n].max,a=t.includes(n)?-(r+1):0;e[n]=[a,r]})),e}();function rl(e){var t=e.handleChange,n=e.disabled,r=e.channelOptions,a=e.selectionIndex;return l.a.createElement(Ei.a,{native:!0,value:a,onChange:function(e){return t(Number(e.target.value))}},r.map((function(e,t){return l.a.createElement("option",{disabled:n,key:e,value:t},e)})))}function al(e){var t=e.color,n=e.checked,r=e.toggle,a=e.disabled;return l.a.createElement(di.a,{onChange:r,checked:n,disabled:a,style:{color:t,"&$checked":{color:t}}})}function ol(e){var t=5;Number.isInteger(e)||--t,e<1&&--t;var n=Intl.NumberFormat("en-US",{maximumSignificantDigits:t,useGrouping:!1}).format(e);return n.length<=5?n:e.toExponential(0)}function il(e){var t=e.color,n=e.slider,r=void 0===n?[0,0]:n,a=e.handleChange,c=e.domain,s=void 0===c?[0,0]:c,u=e.dtype,p=e.disabled,d=Object(o.a)(s,2),f=d[0],m=d[1],h=Object(i.useCallback)(zn()(a,3,{trailing:!0}),[a]),b=m-f<500&&"Float32"===u?(m-f)/500:1;return l.a.createElement(fi.a,{value:r,valueLabelFormat:ol,onChange:function(e,t){return h(t)},valueLabelDisplay:"auto",getAriaLabel:function(){return"".concat(t,"-").concat(r)},min:f,max:m,step:b,orientation:"horizontal",style:{color:t,marginTop:"7px"},disabled:p})}var ll=function(e){var t=e.visibility,n=void 0!==t&&t,r=e.slider,a=e.color,c=e.channels,s=e.channelId,u=e.domainType,p=e.dimName,d=e.theme,f=e.loader,m=e.colormapOn,h=e.channelOptions,b=e.handlePropertyChange,v=e.handleChannelRemove,g=e.handleIQRUpdate,y=e.selectionIndex,j=e.isLoading,E=e.use3d,x=U(f).dtype,C=Object(i.useState)(null),S=Object(o.a)(C,2),L=S[0],w=S[1],T=Object(i.useState)(null),_=Object(o.a)(T,2),k=_[0],I=_[1],A=Object(i.useState)(null),N=Object(o.a)(A,2),P=N[0],R=N[1],M=Object(i.useState)([Object(je.a)({},c[s].selection)]),G=Object(o.a)(M,2),z=G[0],H=G[1],F=function(e,t,n){var r=e||"light"===n&&t.every((function(e){return 255===e}))?[220,220,220]:t;return"rgb(".concat(r,")")}(m,a,d);return Object(i.useEffect)((function(){var e=!0;if(x&&f&&c){var t=[Object(je.a)({},c[s].selection)],n=u!==k,r=P!==E,a=!O()(t,z);if(n||a||r)if("Full"===u){var i=[nl[x]],l=Object(o.a)(i,1)[0];e&&(w(l),I(u),a&&H(t),r&&R(E))}else at({loader:f.data,selections:t,use3d:E}).then((function(n){var i=n.domains,l=Object(o.a)(i,1)[0];e&&(w(l),I(u),a&&H(t),r&&R(E))}))}return function(){e=!1}}),[k,c,s,f,x,u,z,E,P]),l.a.createElement(Yi.a,{container:!0,direction:"column",m:1,justify:"center"},l.a.createElement(Yi.a,{container:!0,direction:"row",justify:"space-between"},l.a.createElement(Yi.a,{item:!0,xs:10},l.a.createElement(rl,{handleChange:function(e){return b("selection",(t=e,Object(D.a)({},p,t)));var t},selectionIndex:y,channelOptions:h,disabled:j})),l.a.createElement(Yi.a,{item:!0,xs:1,style:{marginTop:"4px"}},l.a.createElement(tl,{handlePropertyChange:b,handleChannelRemove:v,handleIQRUpdate:g,disabled:j}))),l.a.createElement(Yi.a,{container:!0,direction:"row",justify:"space-between"},l.a.createElement(Yi.a,{item:!0,xs:2},l.a.createElement(al,{color:F,checked:n,toggle:function(){return b("visible",!n)},disabled:j})),l.a.createElement(Yi.a,{item:!0,xs:9},l.a.createElement(il,{color:F,slider:r,domain:L||nl[x],dtype:x,handleChange:function(e){return b("slider",e)},disabled:j}))))},cl=n(834),sl=n.n(cl);var ul=function(e){var t=e.visibility,n=void 0!==t&&t,r=e.dimName,a=e.channelOptions,o=e.handlePropertyChange,i=e.handleChannelRemove,c=e.selectionIndex,s=e.disableOptions,u=void 0!==s&&s;return l.a.createElement(Yi.a,{container:!0,direction:"row",justify:"space-between"},l.a.createElement(Yi.a,{item:!0,xs:2},l.a.createElement(al,{color:[220,220,220],checked:n,toggle:function(){return o("visible",!n)}})),l.a.createElement(Yi.a,{item:!0,xs:9},l.a.createElement(rl,{handleChange:function(e){return o("selection",(t=e,Object(D.a)({},r,t)));var t},selectionIndex:c,disableOptions:u,channelOptions:a})),l.a.createElement(Yi.a,{item:!0,xs:1},l.a.createElement(ur.a,{onClick:i,style:{padding:"6px 6px 6px 0px"}},l.a.createElement(sl.a,null))))},pl=n(1324),dl=n(35),fl=n(1424),ml=n(1423),hl=n(1452),bl=(Object(dl.a)((function(e){return{paper:{backgroundColor:e.palette.background.paper},span:{width:"70px",textAlign:"center",paddingLeft:"2px",paddingRight:"2px"},colors:{"&:hover":{backgroundColor:"transparent"},paddingLeft:"2px",paddingRight:"2px"},popper:{zIndex:4}}})),{width:"100%",flexDirection:"column"}),vl=Object(E.a)((function(){return{root:Object(je.a)({},bl,{padding:"0px 8px"})}})),gl=Object(dl.a)((function(){return{root:Object(je.a)({},bl,{padding:"8px 8px 24px 8px"})}}))(ml.a),yl=Object(dl.a)((function(e){return{root:{padding:"0px 8px"},content:{margin:"4px 0px",minWidth:"0px"},expanded:{marginBottom:e.spacing(-3),top:e.spacing(-1)},expandIcon:{"&$expanded":{top:e.spacing(-1.3)}}}}))(fl.a),Ol=Object(dl.a)((function(){return{root:{fontSize:"14px"}}}))(hl.a),jl=Object(dl.a)((function(){return{item:{width:"100%",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}}}))(Yi.a),El=Object(dl.a)((function(){return{root:{marginTop:"7px"},markActive:{backgroundColor:"rgba(128, 128, 128, 0.7)"}}}))(fi.a);function xl(e){var t=e.label,n=e.layer,r=e.layerType,a=e.handleLayerChange,o=n.opacity,i=n.visible;var c=vl();return l.a.createElement(Yi.a,{item:!0,style:{marginTop:"10px"}},l.a.createElement(Er.a,{className:c.root},l.a.createElement(pl.a,{style:{padding:"15px 8px 0px 8px",marginBottom:"-5px"}},t),l.a.createElement(Yi.a,{container:!0,direction:"row",justify:"space-between"},l.a.createElement(Yi.a,{item:!0,xs:2},l.a.createElement(di.a,{color:"primary",checked:i,onChange:function(e,t){return function(e){a(Object(je.a)({},n,{visible:e}))}(t)}})),l.a.createElement(Yi.a,{item:!0,xs:9,style:{paddingRight:"8px"}},l.a.createElement(fi.a,{value:o,min:0,max:1,step:.001,onChange:function(e,t){return function(e){if("cells"===r){var t=e<.7;a(Object(je.a)({},n,{opacity:e,stroked:t}))}else a(Object(je.a)({},n,{opacity:e}))}(t)},style:{marginTop:"7px"},orientation:"horizontal"})))))}var Cl=n(1426),Sl=n(476),Ll=n.n(Sl),wl=n(1438),Tl=n(1427),_l=n(1443),kl=n(837),Il=n.n(kl),Al=n(835),Nl=n.n(Al),Pl=n(836),Rl=n.n(Pl),Ml=["Full","Min/Max"];var Gl=function(e,t){var n=e[t],r=n.shape,a=n.labels,o=r[a.indexOf("y")],i=r[a.indexOf("x")],l=r[a.indexOf("z")],c=Math.floor(l/Math.pow(2,t));return{height:o,width:i,depthDownsampled:c,totalBytes:4*o*i*c}};function Dl(e){var t=e.loader,n=e.handleMultiPropertyChange,r=e.resolution,a=e.disable3d,i=e.setRasterLayerCallback,c=e.setAreAllChannelsLoading,s=e.setViewState,u=e.spatialHeight,p=e.spatialWidth,d=e.channels,f=e.use3d,m=e.modelMatrix,h=d.map((function(e){return e.selection})),b=t.data,v=function(){var e=Object(ce.a)(le.a.mark((function e(t){var r,a,l,v,g,y,O,j,E,x,C,S,L,w;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="number"===typeof t,c(!0),i((function(){c(!1),i(null)})),!r){e.next=18;break}if(a=ot(b),l=Object(o.a)(a,3),v=l[0],g=l[1],y=l[2],O={resolution:t,xSlice:v,ySlice:g,zSlice:y,use3d:r},f){e.next=13;break}return e.next=9,at({loader:b,selections:h,use3d:r});case 9:j=e.sent,E=j.sliders,O.channels=Object(G.a)(d),O.channels.forEach((function(e,t){e.slider=E[t]}));case 13:n(O),x=Object(Ee.k)(b,{height:u,width:p},1.5,!0,new Se.Matrix4(m)),s(Object(je.a)({},x,{rotationX:0,rotationOrbit:0})),e.next=27;break;case 18:return e.next=20,at({loader:b,selections:h,use3d:r});case 20:C=e.sent,S=C.sliders,(L=Object(G.a)(d)).forEach((function(e,t){e.slider=S[t]})),n({resolution:t,use3d:r,spatialAxisFixed:!1,channels:L}),w=Object(Ee.k)(b,{height:u,width:p},.5,!1,new Se.Matrix4(m)),s(Object(je.a)({},w,{rotationX:null,rotationOrbit:null,orbitAxis:null}));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=Array.isArray(b)?b[0]:b,y=g.labels,O=g.shape[y.indexOf("z")]>1;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ei.a,{native:!0,value:r,onChange:function(e){return v("2D"===e.target.value?e.target.value:Number(e.target.value))}},l.a.createElement("option",{key:"2D",value:"2D"},"2D Visualization"),Array.from({length:b.length}).fill(0).map((function(e,t){if(b&&function(e,t){var n,r,a;return Gl(e,t).totalBytes<((null===(n=window.performance)||void 0===n?void 0:n.memory)&&(null===(r=window.performance)||void 0===r||null===(a=r.memory)||void 0===a?void 0:a.jsHeapSizeLimit)/2||Math.pow(2,31)-1)}(b,t)){var n=Gl(b,t),r=n.height,o=n.width,i=n.depthDownsampled,c=n.totalBytes;return l.a.createElement("option",{key:"(".concat(r,", ").concat(o,", ").concat(i,")"),value:t,disabled:a||!O},"3D: ".concat(t,"x Downsampled, ~").concat(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var n=1024,r=t<0?0:t,a=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(n));return"".concat(parseFloat((e/Math.pow(n,o)).toFixed(r))," ").concat(a[o])}(c)," per channel, (").concat(r,", ").concat(o,", ").concat(i,")"))}return null}))))}function zl(e){var t=e.value,n=e.inputId,r=e.handleChange;return l.a.createElement(Ei.a,{native:!0,onChange:function(e){return r(""===e.target.value?null:e.target.value)},value:t,inputProps:{name:"colormap",id:n},style:{width:"100%"}},l.a.createElement("option",{"aria-label":"None",value:""},"None"),Re.map((function(e){return l.a.createElement("option",{key:e,value:e},e)})))}function Hl(e){var t=e.value,n=e.handleChange;return l.a.createElement(di.a,{style:{float:"left",padding:0},color:"default",onChange:function(){n(t?null:[0,0,0])},checked:Boolean(t)})}function Fl(e){var t=e.value,n=e.handleChange;return l.a.createElement(fi.a,{value:t,onChange:function(e,t){return n(t)},valueLabelDisplay:"auto",getAriaLabel:function(){return"opacity slider"},min:0,max:1,step:.01,orientation:"horizontal",style:{marginTop:"7px"}})}function Bl(e){var t=e.value,n=e.inputId,r=e.handleChange;return l.a.createElement(Ei.a,{native:!0,onChange:function(e){return r(e.target.value)},value:t,inputProps:{name:"domain-selector",id:n},style:{width:"100%"}},Ml.map((function(e){return l.a.createElement("option",{key:e,value:e},e)})))}function Ul(e){var t=e.field,n=e.value,r=e.handleChange,a=e.possibleValues;return l.a.createElement(El,{value:n,onChange:function(e,n){r({selection:Object(D.a)({},t,n),event:e})},onChangeCommitted:function(e,n){r({selection:Object(D.a)({},t,n),event:e})},valueLabelDisplay:"auto",getAriaLabel:function(){return"".concat(t," slider")},marks:a.map((function(e){return{value:e}})),min:Number(a[0]),max:Number(a.slice(-1)),orientation:"horizontal",step:null})}function Xl(e){var t=e.name,n=e.inputId,r=e.children;return l.a.createElement(Yi.a,{container:!0,direction:"row",alignItems:"center",justify:"center"},l.a.createElement(Yi.a,{item:!0,xs:6},l.a.createElement(hl.a,{htmlFor:n},t,":")),l.a.createElement(Yi.a,{item:!0,xs:6},r))}var Zl=function(e){var t=e.colormap,n=e.opacity,r=e.handleColormapChange,a=e.handleOpacityChange,o=e.handleTransparentColorChange,i=e.globalControlLabels,c=e.globalLabelValues,s=e.handleGlobalChannelsSelectionChange,u=e.handleSliderChange,p=e.handleDomainChange,d=e.transparentColor,f=e.channels,m=e.domainType,h=e.isRgb,b=e.shouldShowTransparentColor,v=e.shouldShowDomain,g=e.shouldShowColormap,y=e.use3d,O=e.loader,j=e.handleMultiPropertyChange,E=e.resolution,x=e.disable3d,C=e.setRasterLayerCallback,S=e.setAreAllChannelsLoading,L=e.setViewState,w=e.spatialHeight,T=e.spatialWidth,_=e.modelMatrix,k=Array.isArray(O.data)?O.data[0]:O.data,I=k.labels,A=k.shape,N=I.length>0&&f.length>0,P=A[I.indexOf("z")]>1;return l.a.createElement(Yi.a,{container:!0,direction:"column",style:{width:"100%"}},P&&!x&&l.a.createElement(Dl,{loader:O,handleSliderChange:u,handleDomainChange:p,channels:f,handleMultiPropertyChange:j,resolution:E,disable3d:x,setRasterLayerCallback:C,setAreAllChannelsLoading:S,setViewState:L,spatialHeight:w,spatialWidth:T,use3d:y,modelMatrix:_}),N&&!y&&i.map((function(e){return A[I.indexOf(e)]>1&&l.a.createElement(Xl,{name:e,inputId:"".concat(e,"-slider"),key:e},l.a.createElement(Ul,{field:e,value:c[e],handleChange:s,possibleValues:ge()(A[I.indexOf(e)])}))})),h?null:l.a.createElement(l.a.Fragment,null,g&&l.a.createElement(Yi.a,{item:!0},l.a.createElement(Xl,{name:"Colormap",inputId:"colormap-select"},l.a.createElement(zl,{value:t||"",inputId:"colormap-select",handleChange:r}))),v&&l.a.createElement(Yi.a,{item:!0},l.a.createElement(Xl,{name:"Domain",inputId:"domain-selector"},l.a.createElement(Bl,{value:m||"Min/Max",handleChange:function(e){p(e)}})))),!y&&l.a.createElement(Yi.a,{item:!0},l.a.createElement(Xl,{name:"Opacity",inputId:"opacity-slider"},l.a.createElement(Fl,{value:n,handleChange:a}))),b&&!y&&l.a.createElement(Yi.a,{item:!0},l.a.createElement(Xl,{name:"Zero Transparent",inputId:"transparent-color-selector"},l.a.createElement(Hl,{value:d,handleChange:o}))))},Vl=n(1425),Yl=Object(E.a)((function(e){return Object(ki.a)({enabled:{},disabled:{color:e.palette.text.disabled,"& .MuiSlider-thumb":{color:"rgb(100, 100, 100, 1.0)"},"&  .MuiSlider-track":{color:"rgb(100, 100, 100, 1.0)"}}})})),Wl=function(e){var t=e.xSlice,n=e.ySlice,r=e.zSlice,a=e.handleSlicerSetting,i=e.loader,c=e.use3d,s=ot(i.data),u=Object(o.a)(s,3),p=[[t,function(e){return a("x",e)},"x",u[0]],[n,function(e){return a("y",e)},"y",u[1]],[r,function(e){return a("z",e)},"z",u[2]]],d=Yl(),f=p.map((function(e){var t=Object(o.a)(e,4),n=t[0],r=t[1],a=t[2],i=Object(o.a)(t[3],2),s=i[0],u=i[1];return l.a.createElement(Yi.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"center",key:a},l.a.createElement(Yi.a,{item:!0,xs:1},l.a.createElement(pl.a,{className:c?d.enabled:d.disabled,style:{marginBottom:0}},a,":")),l.a.createElement(Yi.a,{item:!0,xs:11},l.a.createElement(fi.a,{disabled:!c,className:c?d.enabled:d.disabled,value:n,onChange:function(e,t){return r(t)},valueLabelDisplay:"auto",valueLabelFormat:function(e){return function(e){var t=5;Number.isInteger(e)||--t,e<1&&--t;var n=Intl.NumberFormat("en-US",{maximumSignificantDigits:t,useGrouping:!1}).format(e);return n.length<=5?n:e.toExponential(0)}(e)},getAriaLabel:function(){return"".concat(a," slider")},min:s,max:u,step:.005,orientation:"horizontal"})))}));return l.a.createElement(l.a.Fragment,null,l.a.createElement(pl.a,{className:c?d.enabled:d.disabled,style:{marginTop:16,marginBottom:0}},"Clipping Planes:"," ")," ",f)},ql=Object.values(Ee.e);function $l(e){var t=e.handleRenderingModeChange,n=e.renderingMode,r=e.use3d,a=r?ql:[].concat(Object(G.a)(ql),[""]);return l.a.createElement(Vl.a,{fullWidth:!0},l.a.createElement(hl.a,{htmlFor:"rendering-mode-select"},"Rendering Mode"),l.a.createElement(Ei.a,{native:!0,onChange:function(e){return t(e.target.value)},value:r?n:"",inputProps:{name:"rendering-mode",id:"rendering-mode-select"},disabled:!r},a.map((function(e){return l.a.createElement("option",{key:e,value:e},e)}))))}var Jl=function(e){var t=e.setViewState,n=e.use3d,r=e.spatialHeight,a=e.spatialWidth,o=e.loader,i=e.modelMatrix;return l.a.createElement(Yi.a,{item:!0,xs:"auto",key:"recenter"},l.a.createElement(Cl.a,{onClick:function(){var e=Object(Ee.k)(o.data,{height:r,width:a},1.5,n,new Se.Matrix4(i));t(Object(je.a)({},e,{rotationX:0,rotationOrbit:0}))},disabled:!n,style:{padding:0,marginBottom:6}},"Re-Center"))},Kl=function(e){var t=e.handleSlicerSetting,n=e.handleRenderingModeChange,r=e.renderingMode,a=e.xSlice,o=e.ySlice,i=e.zSlice,c=e.use3d,s=e.loader,u=e.setViewState,p=e.spatialHeight,d=e.spatialWidth,f=e.modelMatrix;return l.a.createElement(l.a.Fragment,null,l.a.createElement($l,{handleRenderingModeChange:n,renderingMode:r,use3d:c}),l.a.createElement(Wl,{xSlice:a,ySlice:o,zSlice:i,handleSlicerSetting:t,use3d:c,loader:s}),l.a.createElement(Jl,{setViewState:u,use3d:c,spatialHeight:p,spatialWidth:d,loader:s,modelMatrix:f}))};function Ql(e){var t=e.children,n=e.value,r=e.index,a=Object(Qr.a)(e,["children","value","index"]);return l.a.createElement("div",Object.assign({role:"tabpanel",hidden:n!==r,id:"simple-tabpanel-".concat(r),"aria-labelledby":"simple-tab-".concat(r)},a),n===r&&t)}function ec(e,t,n,r){return tc.apply(this,arguments)}function tc(){return(tc=Object(ce.a)(le.a.mark((function e(t,n,r,a){var o,i,l,c;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,at({loader:t.data,selections:n,use3d:a});case 2:return i=e.sent,l=i.sliders,"Min/Max"===r&&(o=i.domains),"Full"===r&&(c=U(t),o=n.map((function(){return nl[c.dtype]}))),e.abrupt("return",{domains:o,sliders:l});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var nc={borderStyle:"dashed",marginTop:"10px",fontWeight:400};function rc(e){var t,n=e.layer,r=e.name,a=e.loader,c=e.theme,s=e.handleLayerRemove,u=e.handleLayerChange,p=e.shouldShowTransparentColor,d=e.shouldShowDomain,f=e.shouldShowColormap,m=e.ChannelController,h=e.setViewState,b=e.disable3d,v=e.setRasterLayerCallback,g=e.setAreLayerChannelsLoading,y=e.areLayerChannelsLoading,O=e.disabled,j=e.spatialHeight,E=e.spatialWidth,x=n.colormap,C=n.opacity,S=n.channels,L=n.transparentColor,w=n.renderingMode,T=n.xSlice,_=n.ySlice,k=n.zSlice,I=n.resolution,A=n.use3d,N=n.modelMatrix,P=(null===(t=S[0])||void 0===t?void 0:t.selection)||{},R=a.data,M=a.channels,z=Object(i.useState)(0),H=Object(o.a)(z,2),F=H[0],B=H[1],U=Array.isArray(R)?R[R.length-1]:R,Z=U.labels,V=U.shape,Y=Object(i.useState)(n.domainType),W=Object(o.a)(Y,2),q=W[0],$=W[1],J=Object(i.useState)(!0),K=Object(o.a)(J,2),Q=K[0],ee=K[1],te=Object(i.useState)(Fe.filter((function(e){return"number"===typeof P[e]})).reduce((function(e,t){return Object(je.a)({},e,Object(D.a)({},t,P[t]))}),{})),ne=Object(o.a)(te,2),re=ne[0],ae=ne[1];function oe(e){u(Object(je.a)({},n,{opacity:e}))}function ie(e){u(Object(je.a)({},n,{channels:e}))}function se(e,t){u(Object(je.a)({},n,{channels:e,domainType:t}))}function ue(e,t){var r=Object(G.a)(S);r[t]=e,u(Object(je.a)({},n,{channels:r}))}function pe(e){var t=[].concat(Object(G.a)(S),[e]);u(Object(je.a)({},n,{channels:t}))}var de=function(e){var t=S.map((function(){return e}));g(t)},fe=function(){var e=Object(ce.a)(le.a.mark((function e(){var t,n,r,o,i,l,c,s,u,p;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},Z.forEach((function(e){t[e]=Fe.includes(e)&&re[e]||0})),e.next=4,ec(a,[t],q,A);case 4:n=e.sent,r=n.domains,o=n.sliders,i=r[0],l=i,c=[255,255,255],!0,s=S.length,(u=Object(G.a)(y))[s]=!0,g(u),p={selection:t,slider:l,visible:!0,color:c},v((function(){ue(Object(je.a)({},p,{slider:o[0]}),s);var e=Object(G.a)(u);e[s]=!1,g(e),v(null)})),pe(p);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,i,l;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(t),n=S.map((function(e){return e.selection})),r=S.map((function(e){return e.slider})),e.next=5,ec(a,n,t,A);case 5:i=e.sent,l=i.domains,r=r.map((function(e,t){var n=Object(o.a)(e,2),r=n[0],a=n[1];return[Math.max(r,l[t][0]),Math.min(a,l[t][1])]})),se(S.map((function(e,t){return Object(je.a)({},e,{slider:r[t]})})),t);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,o;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.selection,r=t.event,o=S.map((function(e){return Object(je.a)({},e.selection,{},n)})),("mouseup"===r.type||"keydown"===r.type)&&(de(!0),ec(a,o,q,A).then((function(e){var t=e.sliders,r=S.map((function(e){return Object(je.a)({},e,{selection:Object(je.a)({},e.selection,{},n)})}));v((function(){v(null),de(!1),ie(Object(G.a)(r).map((function(e,n){return Object(je.a)({},e,{slider:t[n]})})))})),ie(r)}))),ae((function(e){return Object(je.a)({},e,{},n)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=[];if(Z.length>0){var ve=Z.find((function(e){return"channel"===e||"c"===e}))||Z[0];be=S.map((function(e,t){var r=function(e){var n=Object(G.a)(y);n[t]=e,g(n)},i=function(){var n=Object(ce.a)(le.a.mark((function n(){var r,o,i,l,c,s;return le.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=a.data,o=Array.isArray(r)?r[r.length-1]:r,n.next=4,o.getRaster({selection:S[t].selection});case 4:i=n.sent,l=Object(Ee.j)(i.data),c=l.q1,s=l.q3,ue(Object(je.a)({},e,{slider:[c,s]}),t);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return l.a.createElement(m,{key:"channel-controller-".concat(t),dimName:ve,visibility:e.visible,selectionIndex:e.selection[ve],slider:e.slider,color:e.color,channels:S,channelId:t,domainType:q,loader:a,globalLabelValues:re,theme:c,channelOptions:M,colormapOn:Boolean(x),handlePropertyChange:function(n,i){var l=Object(D.a)({},n,i);"selection"===n?(r(!0),l.selection=Object(je.a)({},re,{},l.selection),ue(Object(je.a)({},e,{},l),t),v(Object(ce.a)(le.a.mark((function c(){var s,u,p,d;return le.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return s=[Object(je.a)({},S[t][n],{},i)],c.next=3,ec(a,s,q,A);case 3:u=c.sent,p=u.sliders,d=Object(o.a)(p,1),l.slider=d[0],ue(Object(je.a)({},e,{},l),t),v(null),r(!1);case 10:case"end":return c.stop()}}),c)}))))):ue(Object(je.a)({},e,{},l),t)},handleChannelRemove:function(){!function(e){var t=Object(G.a)(S);t.splice(e,1),u(Object(je.a)({},n,{channels:t}))}(t)},handleIQRUpdate:i,setRasterLayerCallback:v,isLoading:y[t],use3d:A})}))}var ge=vl(),ye=n.visible,Oe=ye?Nl.a:Rl.a,xe=!b&&V[Z.indexOf("z")]>1,Ce=l.a.createElement(l.a.Fragment,null,l.a.createElement(Zl,{channels:S,opacity:C,colormap:x,transparentColor:L,domainType:q,globalControlLabels:Z.filter((function(e){return Fe.includes(e)})),globalLabelValues:re,handleOpacityChange:oe,handleColormapChange:function(e){u(Object(je.a)({},n,{colormap:e}))},handleGlobalChannelsSelectionChange:he,handleTransparentColorChange:function(e){u(Object(je.a)({},n,{transparentColor:e}))},isRgb:X(a),handleDomainChange:me,shouldShowTransparentColor:p,shouldShowDomain:d,shouldShowColormap:f,use3d:A,loader:a,handleMultiPropertyChange:function(e){u(Object(je.a)({},n,{},e))},resolution:I,disable3d:b,setRasterLayerCallback:v,setAreAllChannelsLoading:de,setViewState:h,spatialHeight:j,spatialWidth:E,modelMatrix:N}),X(a)?null:be,!X(a)&&l.a.createElement(Cl.a,{disabled:S.length===Ee.c,onClick:fe,fullWidth:!0,variant:"outlined",style:nc,startIcon:l.a.createElement(Ll.a,null),size:"small"},"Add Channel"));return l.a.createElement(_l.a,{className:ge.root,onChange:function(e,t){var n,r,a;return!O&&ee(t&&"presentation"===(null===e||void 0===e||null===(n=e.target)||void 0===n||null===(r=n.attributes)||void 0===r||null===(a=r.role)||void 0===a?void 0:a.value))},TransitionProps:{enter:!1},expanded:!O&&Q},l.a.createElement(yl,{expandIcon:l.a.createElement(Il.a,null),"aria-controls":"layer-".concat(r,"-controls")},l.a.createElement(Yi.a,{container:!0,direction:"column",m:1,justify:"center"},l.a.createElement(jl,{item:!0},l.a.createElement(Cl.a,{onClick:function(e){var t;O||(e.stopPropagation(),t=!ye,u(Object(je.a)({},n,{visible:t})))},style:{marginRight:8,marginBottom:2,padding:0,minWidth:0}},l.a.createElement(Oe,null)),r),!O&&!Q&&!A&&l.a.createElement(Yi.a,{container:!0,direction:"row",alignItems:"center",justify:"center"},l.a.createElement(Yi.a,{item:!0,xs:6},l.a.createElement(Ol,{htmlFor:"layer-".concat(r,"-opacity-closed")},"Opacity:")),l.a.createElement(Yi.a,{item:!0,xs:6},l.a.createElement(fi.a,{id:"layer-".concat(r,"-opacity-closed"),value:C,onChange:function(e,t){return oe(t)},valueLabelDisplay:"auto",getAriaLabel:function(){return"opacity slider"},min:0,max:1,step:.01,orientation:"horizontal"}))))),l.a.createElement(gl,null,xe?l.a.createElement(l.a.Fragment,null,l.a.createElement(wl.a,{value:F,onChange:function(e,t){B(t)},"aria-label":"simple tabs example",style:{height:"24px",minHeight:"24px"}},l.a.createElement(Tl.a,{label:"Channels",style:{fontSize:".75rem",bottom:12,width:"50%",minWidth:"50%"},disableRipple:!0}),l.a.createElement(Tl.a,{label:"Volume",style:{fontSize:".75rem",bottom:12,width:"50%",minWidth:"50%"}})),l.a.createElement(Ql,{value:F,index:0},Ce),l.a.createElement(Ql,{value:F,index:1,style:{marginTop:4}},l.a.createElement(Kl,{loader:a,handleSlicerSetting:function(e,t){u(Object(je.a)({},n,Object(D.a)({},"".concat(e,"Slice"),t)))},handleRenderingModeChange:function(e){u(Object(je.a)({},n,{renderingMode:e}))},renderingMode:w,xSlice:T,ySlice:_,zSlice:k,use3d:A,setViewState:h,spatialHeight:j,spatialWidth:E,modelMatrix:N}))):Ce,l.a.createElement(Cl.a,{onClick:s,fullWidth:!0,variant:"outlined",style:nc,size:"small"},"Remove Image Layer")))}var ac=Object(E.a)((function(){return{addButton:{marginTop:"10px",marginBottom:"10px",fontWeight:400}}}));function oc(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ll.a,null),"Add Image Layer")}var ic=function(e){var t=e.imageOptions,n=e.handleImageAdd,r=Object(i.useReducer)((function(e){return!e}),!1),a=Object(o.a)(r,2),c=a[0],s=a[1],u=ac();return t?l.a.createElement(_r,{open:c,toggle:s,buttonIcon:l.a.createElement(oc,null),buttonClassName:u.addButton},t.map((function(e,t){return l.a.createElement(sr.a,{dense:!0,key:e.name,onClick:function(){return function(e){s(),n(e)}(t)}},l.a.createElement("span",null,e.name))}))):null},lc=["raster"],cc=l.a.memo(Object(i.forwardRef)((function(e,t){var n=e.title,r=e.removeGridComponent,a=e.theme,o=e.isReady,i=e.moleculesLayer,c=e.dataset,s=e.setMoleculesLayer,u=e.cellsLayer,p=e.canShowCellVecmask,d=e.setCellsLayer,f=e.rasterLayers,m=e.imageLayerLoaders,h=e.imageLayerMeta,b=e.rasterLayersCallbacks,v=e.setRasterLayersCallbacks,g=e.areLoadingRasterChannnels,y=e.setAreLoadingRasterChannnels,O=e.handleRasterLayerChange,j=e.handleRasterLayerRemove,E=e.disable3d,x=e.layerIs3DIndex,C=e.setZoom,S=e.setTargetX,L=e.setTargetY,w=e.setTargetZ,T=e.setRotationX,_=e.setRotationOrbit,k=e.componentHeight,I=e.componentWidth,A=e.spatialLayout,N=e.handleImageAdd;return l.a.createElement(Mr,{title:n,isScroll:!0,removeGridComponent:r,theme:a,isReady:o},l.a.createElement("div",{className:"layer-controller-container",ref:t},i&&l.a.createElement(xl,{key:"".concat(c,"-molecules"),label:"Molecules",layerType:"molecules",layer:i,handleLayerChange:s}),u&&p&&l.a.createElement(xl,{key:"".concat(c,"-cells"),label:"Cell Segmentations",layerType:"cells",layer:u,handleLayerChange:d}),f&&f.map((function(e,t){var n=e.index,r=m[n],o=h[n],i="raster"===e.type,s=i?ll:ul,u=(g||[])[t]||[];return r&&o?l.a.createElement(Yi.a,{key:"".concat(c,"-raster-").concat(n,"-").concat(t),item:!0,style:{marginTop:"10px"}},l.a.createElement(rc,{name:o.name,layer:e,loader:r,theme:a,handleLayerChange:function(e){return O(e,t)},handleLayerRemove:function(){return j(t)},ChannelController:s,shouldShowTransparentColor:i,shouldShowDomain:i,shouldShowColormap:i,disable3d:(E||[]).indexOf(o.name)>=0||"number"===typeof x&&-1!==x&&x!==t,disabled:"number"===typeof x&&-1!==x&&x!==t,rasterLayersCallbacks:b,setRasterLayerCallback:function(e){var n=Object(G.a)(b||[]);n[t]=e,v(n)},setViewState:function(e){var t=e.zoom,n=e.target,r=e.rotationX,a=e.rotationOrbit;C(t),S(n[0]),L(n[1]),w(n[2]),T(r),_(a)},setAreLayerChannelsLoading:function(e){var n=Object(G.a)(g||[]);n[t]=e,y(n)},areLayerChannelsLoading:u,spatialHeight:k*A.h/12,spatialWidth:I*A.w/12})):null})),l.a.createElement(Yi.a,{item:!0},l.a.createElement(ic,{imageOptions:h,handleImageAdd:N}))))})));var sc=function(e){var t=e.coordinationScopes,n=e.removeGridComponent,r=e.theme,a=e.title,c=void 0===a?"Spatial Layers":a,s=e.disable3d,u=wn(),p=Cn(Jn.layerController,t),d=Object(o.a)(p,2),f=d[0],m=f.dataset,h=f.spatialRasterLayers,b=f.spatialCellsLayer,v=f.spatialMoleculesLayer,g=d[1],y=g.setSpatialRasterLayers,O=g.setSpatialCellsLayer,j=g.setSpatialMoleculesLayer,E=g.setSpatialTargetX,x=g.setSpatialTargetY,C=g.setSpatialTargetZ,S=g.setSpatialRotationX,L=g.setSpatialRotationOrbit,w=g.setSpatialZoom,T=Ln(Jn.layerController,t),_=Object(o.a)(T,2),k=_[0],I=k.rasterLayersCallbacks,A=k.areLoadingRasterChannnels,N=_[1],P=N.setRasterLayersCallbacks,R=N.setAreLoadingRasterChannnels,M=function(e,t,n){return gn((function(r){return r.viewConfig.layout.filter((function(t){return t.component===e})).filter((function(e){return t.every((function(t){return e.coordinationScopes[t]===n[t]}))}))}))}("spatial",["spatialRasterLayers"],t),D=Object(o.a)(M,1)[0],z=Object(i.useRef)(),H=function(e){var t=Object(i.useState)(),n=Object(o.a)(t,2),r=n[0],a=n[1],l=Object(i.useState)(),c=Object(o.a)(l,2),s=c[0],u=c[1];return Object(i.useEffect)((function(){function t(){if(e.current){var t=e.current.closest(".vitessce-container"),n=t.clientHeight,r=t.clientWidth;u(r),a(n)}}var n=zn()(t,100,{trailing:!0});return window.addEventListener("resize",n),t(),function(){window.removeEventListener("resize",n)}}),[e]),[s,r]}(z),F=Object(o.a)(H,2),B=F[0],U=F[1],X=function(){var e=Object(i.useState)(Hn()),t=Object(o.a)(e,2),n=t[0],r=t[1];return Object(i.useEffect)((function(){var e=zn()((function(){r(Hn())}),100,{trailing:!0});return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),Z=X.height,V=X.width,Y=Un(lc),W=Object(o.a)(Y,3),q=W[0],$=W[1],J=W[2];Object(i.useEffect)((function(){J()}),[u,m]);var K=ir(u,m,$,(function(){}),!1,{setSpatialRasterLayers:y},{spatialRasterLayers:h}),Q=Object(o.a)(K,3),ee=(Q[0],Q[1]),te=Q[2];er(u,m,$,(function(){}),!1,{setSpatialCellsLayer:O},{spatialCellsLayer:b}),or(u,m,$,(function(){}),!1,{setSpatialMoleculesLayer:j},{spatialMoleculesLayer:v});var ne=Object(i.useCallback)(function(){var e=Object(ce.a)(le.a.mark((function e(t){var n,r,a,o,i,l,c,s,u;return le.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=ee[t],e.next=3,ct(l,(h[t]||{}).use3d);case 3:c=e.sent,s=Object(je.a)({index:t,modelMatrix:null===(n=te[t])||void 0===n||null===(r=n.metadata)||void 0===r||null===(a=r.transform)||void 0===a?void 0:a.matrix},Be,{channels:c,type:(null===(o=te[t])||void 0===o||null===(i=o.metadata)||void 0===i?void 0:i.isBitmask)?"bitmask":"raster"}),u=[].concat(Object(G.a)(h),[s]),y(u);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[ee,te,h,y]),re=Object(i.useCallback)((function(e,t){var n=Object(G.a)(h);n[t]=e,y(n)}),[h,y]),ae=Object(i.useCallback)((function(e){var t=Object(G.a)(h);t.splice(e,1),y(t)}),[h,y]),oe=(te.length?te:[{metadata:{isBitmask:!0}}]).every((function(e){var t;return!(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.isBitmask)})),ie=(null===h||void 0===h?void 0:h.findIndex)&&h.findIndex((function(e){return e.use3d}));return l.a.createElement(cc,{ref:z,title:c,removeGridComponent:n,theme:r,isReady:q,moleculesLayer:v,dataset:m,setMoleculesLayer:j,cellsLayer:b,canShowCellVecmask:oe,setCellsLayer:O,rasterLayers:h,imageLayerLoaders:ee,imageLayerMeta:te,rasterLayersCallbacks:I,setRasterLayersCallbacks:P,areLoadingRasterChannnels:A,setAreLoadingRasterChannnels:R,handleRasterLayerChange:re,handleRasterLayerRemove:ae,disable3d:s,layerIs3DIndex:ie,setZoom:w,setTargetX:E,setTargetY:x,setTargetZ:C,setRotationX:S,setRotationOrbit:L,componentHeight:U||Z,componentWidth:B||V,spatialLayout:D,handleImageAdd:ne})},uc=n(838),pc=n(839),dc=n(607),fc=j.dependencies["window-pixi"],mc=j.dependencies.higlass,hc="https://unpkg.com/window-pixi@".concat(fc,"/dist/pixi.").concat("min.js"),bc="https://unpkg.com/higlass@".concat(mc,"/dist/hglib.").concat("min.js");uc.a.initialize(),Object(pc.a)({dataFetcher:dc.a,config:dc.a.config},{pluginType:"dataFetcher"});var vc=l.a.lazy((function(){return window.React||(window.React=l.a),window.ReactDOM||(window.ReactDOM=a.a),new Promise((function(e){var t=function(t){var n;console.warn(t),e(He((n={title:"Could not load HiGlass",message:"The HiGlass scripts could not be dynamically imported."},function(){var e=n.title,t=n.message;return l.a.createElement("div",{className:s},l.a.createElement("h1",null,e),l.a.createElement("div",null,t))})))};__import__(hc).then((function(){__import__(bc).then((function(){e(He(window.hglib.HiGlassComponent))})).catch(t)})).catch(t)}))}));function gc(e){var t=e.coordinationScopes,n=e.theme,r=e.hgViewConfig,a=e.hgOptions,c=e.genomeSize,s=e.height,u=Cn(Jn.higlass,t),p=Object(o.a)(u,2),d=p[0],f=d.genomicZoomX,m=d.genomicZoomY,h=d.genomicTargetX,b=d.genomicTargetY,v=p[1],g=v.setGenomicZoomX,y=v.setGenomicZoomY,O=v.setGenomicTargetX,j=v.setGenomicTargetY,E=Fn(),x=Object(o.a)(E,3),C=x[0],S=(x[1],x[2]),L=Object(i.useState)(),w=Object(o.a)(L,2),T=w[0],_=w[1],k=Object(i.useRef)(),I=Object(i.useMemo)((function(){return Object(je.a)({},a,{theme:n})}),[a,n]),A=Object(i.useMemo)((function(){var e=h,t=c/Math.pow(2,f),n=C/800,a=[e-t*n/2,e+t*n/2],o=b,i=c/Math.pow(2,m),l=s/800,u=[o-i*l/2,o+i*l/2];return{editable:!1,zoomFixed:!1,trackSourceServers:["//higlass.io/api/v1"],exportViewUrl:"//higlass.io/api/v1/viewconfs",views:[Object(je.a)({uid:"main"},r,{initialXDomain:a,initialYDomain:u})],zoomLocks:{locksByViewUid:{},locksDict:{}},locationLocks:{locksByViewUid:{},locksDict:{}},valueScaleLocks:{locksByViewUid:{},locksDict:{}}}}),[h,c,f,C,b,m,s,r]);return Object(i.useEffect)((function(){var e=function(){k.current=!0},t=function(){k.current=!1},n=S.current;return n.addEventListener("mouseenter",e),n.addEventListener("mouseleave",t),function(){n.removeEventListener("mouseenter",e),n.removeEventListener("mouseenter",t)}}),[S]),Object(i.useEffect)((function(){return T?(T.api.on("viewConfig",(function(e){if(k.current){var t=JSON.parse(e),n=t.views[0].initialXDomain,r=t.views[0].initialYDomain,a=Math.log2(c/((n[1]-n[0])*(800/C))),o=Math.log2(c/((r[1]-r[0])*(800/s))),i=n[0]+(n[1]-n[0])/2,l=r[0]+(r[1]-r[0])/2;g(a),y(o),O(i),j(l)}})),function(){return T.api.off("viewConfig")}):function(){}}),[T,c,C,s,g,y,O,j]),l.a.createElement("div",{className:"higlass-wrapper-parent"},l.a.createElement("div",{className:"higlass-wrapper",ref:S,style:{height:"".concat(s,"px")}},l.a.createElement(i.Suspense,{fallback:l.a.createElement("div",null,"Loading...")},l.a.createElement(vc,{ref:_,zoomFixed:!1,viewConfig:A,options:I}))))}gc.defaultProps={hgOptions:{bounded:!0,pixelPreciseMarginPadding:!0,containerPaddingX:0,containerPaddingY:0,sizeMode:"default"},genomeSize:31e8};var yc=[];var Oc=n(479),jc=n(1430),Ec="table";function xc(e){return"https://vega.github.io/schema/vega/v5.json"===e.$schema}function Cc(e){var t=e.spec,n=e.data,r=e.signalListeners,a=Object(je.a)({},t,{data:xc(t)?[{name:Ec}].concat(Object(G.a)(t.data)):{name:Ec}}),o=Object(i.useMemo)((function(){return l.a.createElement(jc.a,{spec:a,data:Object(D.a)({},Ec,n),signalListeners:r,tooltip:(new Oc.a).call,renderer:"canvas",scaleFactor:3})}),[a,n,r]);return a&&n&&n.length>0?l.a.createElement(i.Suspense,{fallback:l.a.createElement("div",null,"Loading...")},o):null}var Sc={dark:{background:null,title:{color:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},light:{background:null}};function Lc(e){var t=e.data,n=e.theme,r=e.width,a=e.height,o=e.marginRight,i=void 0===o?90:o,c=e.marginBottom,s=void 0===c?120:c,u=e.keyLength,p=void 0===u?36:u,d=t.map((function(e){return Object(je.a)({},e,{keyName:e.key+e.name,colorString:Lt(e.color)})})),f={domain:d.map((function(e){return e.key})),range:d.map((function(e){return e.colorString}))},m=d.map((function(e){return e.keyName})),h={mark:{type:"bar"},encoding:{x:{field:"keyName",type:"nominal",axis:{labelExpr:"substring(datum.label, ".concat(p,")")},title:"Cell Set",sort:m},y:{field:"size",type:"quantitative",title:"Cell Set Size"},color:{field:"key",type:"nominal",scale:f,legend:null},tooltip:{field:"size",type:"quantitative"}},width:Ba()(r-i,10,1/0),height:Ba()(a-s,10,1/0),config:Sc[n]};return l.a.createElement(Cc,{data:d,spec:h})}var wc=["cell-sets"];var Tc=n(1428),_c=["genomic-profiles"],kc={hg38:{chromosomes:"NyITQvZsS_mOFNlz5C2LJg",genes:"P0PLbQMwTYGy-5uPIQid7A"},hg19:{chromosomes:"N12wVGG9SPiTkk03yUayUw",genes:"OHJakQICQD6gTD7skx4EWA"},mm9:{chromosomes:"WAVhNHYxQVueq6KulwgWiQ",genes:"GUm5aBiLRCyz2PsBea7Yzg"},mm10:{chromosomes:"EtrWT0VtScixmsmwFSd7zg",genes:"QDutvmyiSrec5nX4pA5WGQ"}};function Ic(e){var t=e.geneSelection,n=e.data,r=e.theme,a=e.width,o=e.height,i=e.marginRight,c=void 0===i?90:i,s=e.marginBottom,u=void 0===s?50:s,p={mark:{type:"bar"},encoding:{x:{field:"value",type:"quantitative",bin:{maxbins:50},title:t&&t.length>=1?"Normalized Expression Value":"Total Normalized Transcript Count"},y:{type:"quantitative",aggregate:"count",title:"Number of Cells"},color:{value:"gray"}},width:Ba()(a-c,10,1/0),height:Ba()(o-u,10,1/0),config:Sc[r]};return l.a.createElement(Cc,{data:n,spec:p})}var Ac=["expression-matrix"];function Nc(e,t,n,r,a,l,c,s){var u=Object(i.useMemo)((function(){return ze(n,r)}),[n,r]),p=Object(i.useMemo)((function(){if(u&&l&&a&&a.length>=1&&e){for(var n=function(e,t,n){for(var r=[],a=function(a){var i=t[a],l=zt(e,i);if(l){var c,s=Gt(l),u=(null===n||void 0===n||null===(c=n.find((function(e){return O()(e.path,i)})))||void 0===c?void 0:c.color)||Ae;r=r.concat(s.map((function(e){return{obsId:Object(o.a)(e,1)[0],name:l.name,color:u}})))}},i=0;i<t.length;i+=1)a(i);return r}(u,l,c),r=a[0],i=-1/0,p={},d=0;d<t.rows.length;d+=1)p[t.rows[d]]=d;return[n.map((function(t){var n=p[t.obsId],a=100*e[0][n]/255,o=s?Math.log(1+a):a;return i=Math.max(o,i),{value:o,gene:r,set:t.name}})),i]}return[null,null]}),[e,t,a,u,l,c,s]),d=Object(o.a)(p,2),f=d[0],m=d[1];return[f,Object(i.useMemo)((function(){return u&&l&&c?Wt(u,l,c):[]}),[u,l,c]),m]}function Pc(e){var t=e.toggleGeneExpressionTransform,n=e.useGeneExpressionTransform,r=bi();return l.a.createElement(ji,null,l.a.createElement(hi.a,null,l.a.createElement(mi.a,{className:r.labelCell},"Log Transform"),l.a.createElement(mi.a,{className:r.inputCell},l.a.createElement(di.a,{className:r.checkbox,checked:Boolean(n),onChange:function(){t()},name:"scatterplot-option-cell-set-labels",color:"default"}))))}function Rc(e){var t=e.domainMax,n=void 0===t?100:t,r=e.colors,a=e.data,o=e.theme,i=e.width,c=e.height,s=e.marginRight,u=void 0===s?90:s,p=e.marginBottom,d=e.useGeneExpressionTransform,f=a.reduce((function(e,t){return e=void 0===e||t.set.length>e?t.set.length:e}),0),m=p||30+30*Math.sqrt(f/2),h={domain:r.map((function(e){return e.name})),range:r.map((function(e){return Lt(e.color)}))},b=Ba()(i-u,10,1/0),v=Ba()(c-m,10,1/0),g=b/r.length,y="dark"===o?"white":"black",O={$schema:"https://vega.github.io/schema/vega/v5.json",description:"A violin plot showing distributions of expression levels for selected cell sets.",width:b,height:v,config:Object(je.a)({},Sc[o],{axisBand:{bandPosition:1,tickExtra:!0,tickOffset:0}}),signals:[{name:"bandWidth",value:g},{name:"width",value:b},{name:"height",value:v},{name:"trim",value:!0}],data:[{name:"density",source:Ec,transform:[{type:"kde",field:"value",groupby:["set"],bandwidth:0,extent:[0,n]}]},{name:"stats",source:Ec,transform:[{type:"aggregate",groupby:["set"],fields:["value","value","value"],ops:["q1","median","q3"],as:["q1","median","q3"]}]}],scales:[{name:"layout",type:"band",range:"width",domain:{data:Ec,field:"set"}},{name:"yscale",type:"linear",range:"height",domain:[0,n]},{name:"wscale",type:"linear",range:[0,{signal:"bandWidth"}],domain:{data:"density",field:"density"}},{name:"wscaleReversed",type:"linear",reverse:!0,range:[0,{signal:"bandWidth"}],domain:{data:"density",field:"density"}},Object(je.a)({name:"color",type:"ordinal"},h)],axes:[{orient:"left",scale:"yscale",zindex:1,title:d?["Log-Transformed","Normalized Expression Values"]:"Normalized Expression Values"},{orient:"bottom",scale:"layout",tickCount:5,zindex:1,title:"Cell Set",labelAngle:-45,labelAlign:"right"}],marks:[{type:"group",from:{facet:{data:"density",name:"violin",groupby:"set"}},encode:{enter:{xc:{scale:"layout",field:"set",band:.5},width:{signal:"bandWidth"},height:{signal:"height"}}},data:[{name:"summary",source:"stats",transform:[{type:"filter",expr:"datum.set === parent.set"}]}],marks:[{type:"area",orient:"vertical",from:{data:"violin"},encode:{enter:{fill:{scale:"color",field:{parent:"set"}}},update:{width:{scale:"wscale",field:"density"},xc:{signal:"bandWidth / 2"},y2:{scale:"yscale",field:"value"},y:{scale:"yscale",value:0}}}},{type:"area",orient:"vertical",from:{data:"violin"},encode:{enter:{fill:{scale:"color",field:{parent:"set"}}},update:{width:{scale:"wscaleReversed",field:"density"},xc:{signal:"bandWidth"},y2:{scale:"yscale",field:"value"},y:{scale:"yscale",value:0}}}},{type:"rect",from:{data:"summary"},encode:{enter:{fill:{value:y},width:{value:2}},update:{y:{scale:"yscale",field:"q1"},y2:{scale:"yscale",field:"q3"},xc:{signal:"bandWidth / 2"}}}},{type:"rect",from:{data:"summary"},encode:{enter:{fill:{value:y},height:{value:2},width:{value:8}},update:{y:{scale:"yscale",field:"median"},xc:{signal:"bandWidth / 2"}}}}]}]};return l.a.createElement(Cc,{data:a,spec:O})}var Mc=["cell-sets","expression-matrix"];var Gc={description:function(e){var t=e.coordinationScopes,n=e.description,r=e.removeGridComponent,a=e.theme,c=e.title,s=void 0===c?"Data Set":c,u=wn(),p=Cn(Jn.description,t),d=Object(o.a)(p,1)[0],f=d.dataset,m=d.spatialRasterLayers,h=Un(Dr),b=Object(o.a)(h,3),v=b[0],g=b[1],y=b[2];Object(i.useEffect)((function(){y()}),[u,f]);var O=function(e,t){var n=Object(i.useState)(),r=Object(o.a)(n,2),a=r[0],l=r[1];return Object(i.useEffect)((function(){e[t]&&(e[t].description?l(e[t].description):l(null))}),[e,t]),[a]}(u,f),j=Object(o.a)(O,1)[0],E=ir(u,f,g,(function(){}),!1),x=Object(o.a)(E,3),C=x[0],S=x[1],L=x[2],w=Object(i.useMemo)((function(){var e=new Map;return m&&m.length>0&&C&&L&&S&&m.forEach((function(t){if(L[t.index]){var n=S[t.index].metadata.format;e.set("".concat(t.index),{name:C.meta[t.index].name,metadata:n&&n()})}})),e}),[C,m,L,S]);return l.a.createElement(Mr,{title:s,removeGridComponent:r,isScroll:!0,theme:a,isReady:v},l.a.createElement(Gr,{description:n||j,metadata:w}))},status:function(e){var t=e.coordinationScopes,n=e.removeGridComponent,r=e.theme,a=e.title,i=void 0===a?"Status":a,c=Cn(Jn.status,t),s=Object(o.a)(c,1)[0],u=s.cellHighlight,p=s.geneHighlight,d=s.moleculeHighlight,f=kn(),m=[].concat(Object(G.a)(u?["Hovered cell ".concat(u)]:[]),Object(G.a)(p?["Hovered gene ".concat(p)]:[]),Object(G.a)(d?["Hovered gene ".concat(d)]:[])).join("; ");return l.a.createElement(Mr,{title:i,theme:r,removeGridComponent:n,isScroll:!0,isReady:!0},l.a.createElement(zr,{warn:f,info:m}))},genes:function(e){var t=e.coordinationScopes,n=e.removeGridComponent,r=e.variablesLabelOverride,a=void 0===r?"gene":r,c=e.variablesPluralLabelOverride,s=void 0===c?"".concat(a,"s"):c,u=e.theme,p=e.title,d=void 0===p?"Expression Levels":p,f=wn(),m=Cn(Jn.genes,t),h=Object(o.a)(m,2),b=h[0],v=b.dataset,g=b.geneSelection,y=b.geneFilter,O=b.cellColorEncoding,j=h[1],E=j.setGeneSelection,x=j.setGeneFilter,C=j.setGeneHighlight,S=j.setCellColorEncoding,L=Xn(),w=Object(o.a)(L,3),T=w[0],_=w[1],k=w[2],I=Un(Yr),A=Object(o.a)(I,3),N=A[0],P=A[1],R=A[2];Object(i.useEffect)((function(){k(),R()}),[f,v]);var M=ar(f,v,P,_,!0),G=Object(o.a)(M,1)[0],D=G?G.cols:[],z=D.length;return l.a.createElement(Mr,{title:d,info:"".concat(z," ").concat(H(a,s,z)),theme:u,isScroll:!0,removeGridComponent:n,isReady:N,urls:T},l.a.createElement(Vr,{hasColorEncoding:"geneSelection"===O,geneList:D,geneSelection:g,geneFilter:y,setGeneSelection:function(e){E(e),S("geneSelection")},setGeneFilter:x,setGeneHighlight:C}))},cellSets:function(e){var t=e.coordinationScopes,n=e.removeGridComponent,r=e.theme,a=e.title,c=void 0===a?"Cell Sets":a,s=wn(),u=In(),p=Cn(Jn.cellSets,t),d=Object(o.a)(p,2),f=d[0],m=f.dataset,h=f.cellSetSelection,b=f.cellSetColor,v=f.additionalCellSets,g=f.cellColorEncoding,y=d[1],E=y.setCellSetSelection,x=y.setCellColorEncoding,C=y.setCellSetColor,S=y.setAdditionalCellSets,L=Xn(),w=Object(o.a)(L,3),T=w[0],_=w[1],k=w[2],I=Un(za),A=Object(o.a)(I,3),N=A[0],P=A[1],R=A[2],M=Object(i.useState)([]),D=Object(o.a)(M,2),z=D[0],H=D[1];Object(i.useEffect)((function(){k(),R(),H([])}),[s,m]);var F=er(s,m,P,_,!0),B=Object(o.a)(F,1)[0],U=tr(s,m,P,_,!0,{setCellSetSelection:E,setCellSetColor:C},{cellSetSelection:h,cellSetColor:b}),X=Object(o.a)(U,1)[0];Object(i.useEffect)((function(){if(v){var e;try{e=Qt(v,"cell")}catch(t){return void u(t.message)}S(e)}}),[v,S,u]);var Z=Object(i.useMemo)((function(){return B?Object.keys(B):[]}),[B]);function V(){x("cellSetSelection")}var Y=Object(i.useMemo)((function(){return ze(X,v)}),[X,v]),W=Object(i.useMemo)((function(){return h&&h.length>0&&Y&&Y.tree.length>0?function(e,t){var n=null;return e&&e.tree.forEach((function(e){var r=[e.name],a=Dt(e);ge()(a).forEach((function(a){var o=a+1,i=Ut(e,o,[],!0);O()(i,t)&&(n={levelZeroPath:r,levelIndex:o})}))})),n}(Y,h):null}),[h,Y]);return l.a.createElement(Mr,{title:c,isScroll:!0,removeGridComponent:n,urls:T,theme:r,isReady:N},l.a.createElement(Da,{setColor:b,sets:X,additionalSets:v,levelSelection:W,setSelection:h,setExpansion:z,hasColorEncoding:"cellSetSelection"===g,draggable:!0,datatype:"cell",onError:u,onCheckNode:function(e,t){var n=Array.isArray(e)?e:e.split("___");e&&(E(t?[].concat(Object(G.a)(h),[n]):h.filter((function(e){return!O()(e,n)}))),V())},onExpandNode:function(e,t,n){H(n?function(e){return[].concat(Object(G.a)(e),[t.split("___")])}:function(e){return e.filter((function(e){return!O()(e,t.split("___"))}))})},onDropNode:function(e,t,n,r){var a=e.split("___"),o=zt(v,a);if(o.children||r){var i=0===a.length-1,l=t.split("___"),c=zt(v,l);if(!i||!r||c.children){var s,u,p;i?p=v.tree.findIndex((function(e){return e.name===o.name})):(u=a.slice(0,-1),p=(s=zt(v,u)).children.findIndex((function(e){return e.name===o.name})));var d=c.name;if(!(!i&&r?s.children.find((function(e){return e!==c&&e.name===d})):r?v.tree.find((function(e){return e!==c&&e.name===d})):o.children.find((function(e){return e!==c&&e.name===d})))){var f=Object(je.a)({},v,{tree:v.tree.map((function(e){return qt(e,[],l)})).filter(Boolean)});p=i?f.tree.findIndex((function(e){return e.name===o.name})):s.children.findIndex((function(e){return e.name===o.name}));var m=[];if(r&&i)if(-1===n)f.tree.unshift(c),S(f),m=[c.name],E([m]);else{var h=p+(n>p?1:0),g=Array.from(f.tree);g.splice(h,0,c),f.tree=g,S(f),m=[c.name],E([m])}else{var y,j,x=[];if(r){if(!i)if(j=function(e){return O()(e,u)},-1===n)y=function(e){return t=e,n=c,Object(je.a)({},t,{children:[n].concat(Object(G.a)(t.children))});var t,n};else{var L=p+(n>p?1:0);y=function(e){return function(e,t,n){var r=Array.from(e.children);return r.splice(n,0,t),Object(je.a)({},e,{children:r})}(e,c,L)}}}else y=function(e){return Ft(e,c)},j=function(e){return O()(e,a)};f.tree=f.tree.map((function(e){return Ht(e,(function(e,t){return j(t)}),(function(e){return y(e)}),x)})),S(f),m=[].concat(Object(G.a)(x[0]),[c.name]),E([m])}var w=b.filter((function(e){return _t(l,e.path)})).map((function(e){return Object(je.a)({},e,{path:O()(e.path,l)?m:m.concat(e.path.slice(l.length))})})),T=b.filter((function(e){return!_t(l,e.path)}));T.push.apply(T,Object(G.a)(w)),C(T)}}}},onCheckLevel:function(e,t){var n=Y.tree.find((function(t){return t.name===e}));if(n){var r=Ut(n,t,[],!0);E(r),V()}},onNodeSetColor:function(e,t){var n=null===b||void 0===b?void 0:b.find((function(t){return O()(t.path,e)}));C([].concat(n?Object(G.a)(b.filter((function(t){return!O()(t.path,e)}))):Object(G.a)(b||[]),[{path:e,color:t}]))},onNodeSetName:function(e,t){var n=Object(G.a)(e);n.pop(),n.push(t);var r=Object(je.a)({},v,{tree:v.tree.map((function(n){return function n(r,a){return O()([].concat(Object(G.a)(a),[r.name]),e)?Object(je.a)({},r,{name:t}):r.children?Object(je.a)({},r,{children:r.children.map((function(e){return n(e,[].concat(Object(G.a)(a),[r.name]))}))}):r}(n,[])}))}),a=b.map((function(t){return{path:kt(e,t.path,n),color:t.color}})),o=h.map((function(t){return kt(e,t,n)})),i=z.map((function(t){return kt(e,t,n)}));S(r),C(a),E(o),H(i)},onNodeCheckNewName:function(e,t){var n=Object(G.a)(e);return n.pop(),n.push(t),!O()(e,n)&&zt(v,n)},onNodeRemove:function(e){var t=Object(je.a)({},v,{tree:v.tree.map((function(t){return qt(t,[],e)})).filter(Boolean)}),n=b.filter((function(t){return!_t(e,t.path)})),r=h.filter((function(t){return!_t(e,t)})),a=z.filter((function(t){return!_t(e,t)}));S(t),C(n),E(r),H(a)},onNodeView:function(e){var t=[];!function e(n,r){z.find((function(e){return O()(r,e)}))&&n.children?n.children.forEach((function(t){e(t,[].concat(Object(G.a)(r),[t.name]))})):t.push(r)}(zt(Y,e),e),E(t),V()},onImportTree:function(e){if(!$t(Y,e)){S(Object(je.a)({},v||Vt("cell"),{tree:[].concat(Object(G.a)(v?v.tree:[]),Object(G.a)(e.tree))}));var t=Jt(e,b);C([].concat(Object(G.a)(b),Object(G.a)(t)))}},onCreateLevelZeroNode:function(){var e=Ge(null===v||void 0===v?void 0:v.tree,"My hierarchy ");S(Object(je.a)({},v||Vt("cell"),{tree:[].concat(Object(G.a)(v?v.tree:[]),[{name:e,children:[]}])}))},onExportLevelZeroNodeJSON:function(e){var t=Zt(Y,e,"cell",b),n=t.treeToExport,r=t.nodeName;rn(nn(n),"".concat(r,"_").concat(j.name,"-").concat("cell","-hierarchy.").concat("json"))},onExportLevelZeroNodeTabular:function(e){var t=Zt(Y,e,"cell",b),n=t.treeToExport,r=t.nodeName;rn(function(e){var t=[];e.tree.forEach((function(e){e.children.forEach((function(n){n.set&&n.set.forEach((function(r){var a=Object(o.a)(r,2),i=a[0],l=a[1];t.push({groupName:e.name,setName:n.name,setColor:Lt(n.color),obsId:i,predictionScore:Ot()(l)?"NA":l})}))}))}));var n=Object(Et.parse)(t,{fields:["groupName","setName","setColor","obsId","predictionScore"],delimiter:","});return"data:".concat("text/csv",";charset=utf-8,").concat(encodeURIComponent(n))}(n),"".concat(r,"_").concat(j.name,"-").concat("cell","-hierarchy.").concat("csv"))},onExportSetJSON:function(e){var t=function(e,t){var n=zt(e,t);return{setToExport:Gt(n),nodeName:n.name}}(Y,e),n=t.setToExport,r=t.nodeName;rn(nn(n),"".concat(r,"_").concat(j.name,"-").concat("cell","-set.").concat("json"))},onUnion:function(){De(Bt(Y,h),v,b,E,S,C,x,"Union ")},onIntersection:function(){De(function(e,t){var n=t.map((function(t){return zt(e,t)})).map((function(e){return Gt(e).map((function(e){return Object(o.a)(e,1)[0]}))}));return n.reduce((function(e,t){return t.filter((function(t){return e.includes(t)}))}),n[0]||[])}(Y,h),v,b,E,S,C,x,"Intersection ")},onComplement:function(){De(function(e,t,n){var r=Bt(e,t);return n.filter((function(e){return!r.includes(e)}))}(Y,h,Z),v,b,E,S,C,x,"Complement ")},hasCheckedSetsToUnion:(null===h||void 0===h?void 0:h.length)>1,hasCheckedSetsToIntersect:(null===h||void 0===h?void 0:h.length)>1,hasCheckedSetsToComplement:(null===h||void 0===h?void 0:h.length)>0}))},scatterplot:function(e){var t=e.uuid,n=e.coordinationScopes,r=e.removeGridComponent,a=e.theme,c=e.disableTooltip,s=void 0!==c&&c,u=e.observationsLabelOverride,p=void 0===u?"cell":u,d=e.observationsPluralLabelOverride,f=void 0===d?"".concat(p,"s"):d,m=e.title,h=wn(),b=_n(),v=Nn(t),g=Cn(Jn.scatterplot,n),y=Object(o.a)(g,2),j=y[0],E=j.dataset,x=j.embeddingZoom,C=j.embeddingTargetX,S=j.embeddingTargetY,L=j.embeddingTargetZ,w=j.embeddingType,T=j.cellFilter,_=j.cellHighlight,k=j.geneSelection,I=j.cellSetSelection,A=j.cellSetColor,N=j.cellColorEncoding,P=j.additionalCellSets,R=j.embeddingCellSetPolygonsVisible,M=j.embeddingCellSetLabelsVisible,z=j.embeddingCellSetLabelSize,B=j.embeddingCellRadius,U=y[1],X=U.setEmbeddingZoom,Z=U.setEmbeddingTargetX,V=U.setEmbeddingTargetY,Y=U.setEmbeddingTargetZ,W=U.setCellFilter,q=U.setCellSetSelection,$=U.setCellHighlight,J=U.setCellSetColor,K=U.setCellColorEncoding,Q=U.setAdditionalCellSets,ee=U.setEmbeddingCellSetPolygonsVisible,te=U.setEmbeddingCellSetLabelsVisible,ne=U.setEmbeddingCellSetLabelSize,re=U.setEmbeddingCellRadius,ae=Xn(),oe=Object(o.a)(ae,3),ie=oe[0],le=oe[1],ce=oe[2],se=Bn(),ue=Object(o.a)(se,3),pe=ue[0],de=ue[1],fe=ue[2],me=Un(Si),he=Object(o.a)(me,3),ve=he[0],ge=he[1],ye=he[2],Oe=m||"Scatterplot (".concat(w,")");Object(i.useEffect)((function(){ce(),ye()}),[h,E]);var Ee=er(h,E,ge,le,!0),xe=Object(o.a)(Ee,2),Ce=xe[0],Se=xe[1],Le=tr(h,E,ge,le,!1,{setCellSetSelection:q,setCellSetColor:J},{cellSetSelection:I,cellSetColor:A}),we=Object(o.a)(Le,1)[0],Te=rr(h,E,ge,!1,k),_e=Object(o.a)(Te,1)[0],ke=ar(h,E,ge,le,!1),Ie=Object(o.a)(ke,1)[0],Ae=Object(i.useState)(.2),Ne=Object(o.a)(Ae,2),Pe=Ne[0],Re=Ne[1],Me=Object(i.useMemo)((function(){return ze(we,P)}),[we,P]),Ge=Object(i.useCallback)((function(e){De(e,P,A,q,Q,J,K)}),[P,A,K,Q,J,q]),He=Object(i.useMemo)((function(){return Xa({cellColorEncoding:N,expressionData:_e&&_e[0],geneSelection:k,cellSets:Me,cellSetSelection:I,cellSetColor:A,expressionDataAttrs:Ie})}),[N,k,Me,I,A,_e,Ie]),Fe=Object(i.useState)([]),Be=Object(o.a)(Fe,2),Ue=Be[0],Xe=Be[1],Ze=Object(i.useMemo)((function(){var e,t;if((M||R)&&(t=I,-1===Ue.findIndex((function(e){return O()(e[0],t)})))&&(null===Me||void 0===Me||null===(e=Me.tree)||void 0===e?void 0:e.length)&&Object.values(Ce).length&&(null===A||void 0===A?void 0:A.length)){var n=Kt({cells:Ce,mapping:w,cellSets:Me,cellSetSelection:I,cellSetColor:A});return Xe((function(e){return[].concat(Object(G.a)(e),[[I,n]])})),n}return function(e,t){var n;return null===(n=e.find((function(e){return O()(e[0],t)})))||void 0===n?void 0:n[1]}(Ue,I)||[]}),[R,Ue,M,Ce,w,Me,I,A]),Ve=Object(i.useMemo)((function(){return Array.from(He.keys())}),[He]);Object(i.useEffect)((function(){var e=Ce&&Object.values(Ce);if(null===e||void 0===e?void 0:e.length){var t=Object.values(Ce).map((function(e){return e.mappings[w]})),n=Object(be.a)(t,(function(e){return e[0]})),r=Object(be.a)(t,(function(e){return e[1]})),a=n[1]-n[0],o=r[1]-r[0],i=Math.sqrt(Math.pow(a,2)+Math.pow(o,2)),l=Ba()(i/300,0,.2);if(l&&Re(l),"number"!==typeof C||"number"!==typeof S){var c=n[0]+a/2,s=r[0]+o/2,u=Math.log2(Math.min(pe/a,de/o));Z(c),V(-s),X(u)}}}),[Ce,w]);var Ye=Object(i.useCallback)((function(e){var t=Ce[e];return Object(je.a)(Object(D.a)({},"".concat(F(p)," ID"),e),t?t.factors:{})}),[Ce,p]);return l.a.createElement(Mr,{title:Oe,info:"".concat(Se," ").concat(H(p,f,Se)),removeGridComponent:r,urls:ie,theme:a,isReady:ve,options:l.a.createElement(Ci,{observationsLabel:p,cellRadius:B,setCellRadius:re,cellSetLabelsVisible:M,setCellSetLabelsVisible:te,cellSetLabelSize:z,setCellSetLabelSize:ne,cellSetPolygonsVisible:R,setCellSetPolygonsVisible:ee,cellColorEncoding:N,setCellColorEncoding:K})},l.a.createElement(li,{ref:fe,uuid:t,theme:a,viewState:{zoom:x,target:[C,S,L]},setViewState:function(e){var t=e.zoom,n=e.target;X(t),Z(n[0]),V(n[1]),Y(n[2])},cells:Ce,mapping:w,cellFilter:T,cellSelection:Ve,cellHighlight:_,cellColors:He,cellSetPolygons:Ze,cellSetLabelSize:z,cellSetLabelsVisible:M,cellSetPolygonsVisible:R,setCellFilter:W,setCellSelection:Ge,setCellHighlight:$,cellRadiusScale:Pe*B,setComponentHover:function(){b(t)},updateViewInfo:v}),!s&&l.a.createElement(pi,{parentUuid:t,cellHighlight:_,width:pe,height:de,getCellInfo:Ye}))},spatial:function(e){var t=e.uuid,n=e.coordinationScopes,r=e.removeGridComponent,a=e.observationsLabelOverride,c=void 0===a?"cell":a,s=e.observationsPluralLabelOverride,u=void 0===s?"".concat(c,"s"):s,p=e.subobservationsLabelOverride,d=void 0===p?"molecule":p,f=e.subobservationsPluralLabelOverride,m=void 0===f?"".concat(d,"s"):f,h=e.theme,b=e.disableTooltip,v=void 0!==b&&b,g=e.title,y=void 0===g?"Spatial":g,O=wn(),j=_n(),E=Nn(t),x=Cn(Jn.spatial,n),C=Object(o.a)(x,2),S=C[0],L=S.dataset,w=S.spatialZoom,T=S.spatialTargetX,_=S.spatialTargetY,k=S.spatialTargetZ,I=S.spatialRotationX,A=S.spatialRotationY,N=S.spatialRotationZ,P=S.spatialRotationOrbit,R=S.spatialOrbitAxis,M=S.spatialRasterLayers,z=S.spatialCellsLayer,B=S.spatialMoleculesLayer,U=S.spatialNeighborhoodsLayer,X=S.cellFilter,Z=S.cellHighlight,V=S.geneSelection,Y=S.cellSetSelection,W=S.cellSetColor,q=S.cellColorEncoding,$=S.additionalCellSets,J=S.spatialAxisFixed,K=C[1],Q=K.setSpatialZoom,ee=K.setSpatialTargetX,ne=K.setSpatialTargetY,re=K.setSpatialTargetZ,ae=K.setSpatialRotationX,oe=K.setSpatialRotationOrbit,ie=K.setSpatialOrbitAxis,le=K.setSpatialRasterLayers,ce=K.setSpatialCellsLayer,se=K.setSpatialMoleculesLayer,ue=K.setSpatialNeighborhoodsLayer,pe=K.setCellFilter,de=K.setCellSetSelection,fe=K.setCellHighlight,me=K.setCellSetColor,he=K.setCellColorEncoding,ve=K.setAdditionalCellSets,ge=K.setMoleculeHighlight,ye=K.setSpatialAxisFixed,Oe=Ln(Jn.layerController,n),xe=Object(o.a)(Oe,1)[0].rasterLayersCallbacks,Se=null===M||void 0===M?void 0:M.some((function(e){return e.use3d})),Le=Xn(),we=Object(o.a)(Le,3),Te=we[0],_e=we[1],ke=we[2],Ie=Un(Ri),Ae=Object(o.a)(Ie,3),Ne=Ae[0],Pe=Ae[1],Re=Ae[2],Me=Bn(),Ge=Object(o.a)(Me,3),He=Ge[0],Fe=Ge[1],Be=Ge[2];Object(i.useEffect)((function(){ke(),Re()}),[O,L]);var Ue=er(O,L,Pe,_e,!1,{setSpatialCellsLayer:ce},{spatialCellsLayer:z}),Xe=Object(o.a)(Ue,2),Ve=Xe[0],Ye=Xe[1],We=or(O,L,Pe,_e,!1,{setSpatialMoleculesLayer:se},{spatialMoleculesLayer:B}),qe=Object(o.a)(We,3),$e=qe[0],Je=qe[1],Ke=qe[2],Qe=function(e,t,n,r,a,l,c){var s=Object(i.useState)(),u=Object(o.a)(s,2),p=u[0],d=u[1],f=In();return Object(i.useEffect)((function(){e[t]&&(e[t].loaders.neighborhoods?e[t].loaders.neighborhoods.load().catch((function(e){return Kn(e,f)})).then((function(e){if(e){var t=e.data,a=e.url,o=e.coordinationValues;d(t),r(a,"Neighborhoods"),Qn(Object(je.a)({spatialNeighborhoodsLayer:Ze},o),l,c),n("neighborhoods")}})):(d({}),a?Kn(new te(t,"neighborhoods",null,null),f):n("neighborhoods")))}),[e,t]),[p]}(O,L,Pe,_e,!1,{setSpatialNeighborhoodsLayer:ue},{spatialNeighborhoodsLayer:U}),et=Object(o.a)(Qe,1)[0],tt=tr(O,L,Pe,_e,!1,{setCellSetSelection:de,setCellSetColor:me},{cellSetSelection:Y,cellSetColor:W}),nt=Object(o.a)(tt,1)[0],rt=rr(O,L,Pe,!1,V),at=Object(o.a)(rt,1)[0],ot=ar(O,L,Pe,_e,!1),it=Object(o.a)(ot,1)[0],lt=ir(O,L,Pe,_e,!1,{setSpatialRasterLayers:le},{spatialRasterLayers:M}),ct=Object(o.a)(lt,3),st=(ct[0],ct[1]),ut=ct[2],pt=Object(i.useMemo)((function(){var e=!ut.some((function(e){var t;return null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.isBitmask}));return[].concat(Object(G.a)(B?[Object(je.a)({},B,{type:"molecules"})]:[]),Object(G.a)(z&&e?[Object(je.a)({},z,{type:"cells"})]:[]),Object(G.a)(U?[Object(je.a)({},U,{type:"neighborhoods"})]:[]),Object(G.a)(M?M.map((function(e){return Object(je.a)({},e,{type:e.type||"raster"})})):[]))}),[z,B,U,M,ut]);Object(i.useEffect)((function(){if("number"!==typeof T||"number"!==typeof _){var e=function(e){var t=e.width,n=e.height,r=e.cells,a=e.imageLayerLoaders,o=e.useRaster,i=e.use3d,l=-1/0,c=-1/0,s=-1/0,u=-1/0,p=i?1.5:.1,d=Object.values(r);if(a.length>0&&o)for(var f=0;f<a.length;f+=1){var m={height:n,width:t},h=Object(Ee.k)(a[f].data,m,p,i),b=h.target,v=h.zoom;b[0]>l&&(l=b[0],u=v),b[1]>c&&(c=b[1],u=v),b[2]>s?(s=b[2],u=v):s=null}else{if(!(d.length>0&&d[0].xy)||o)return{initialTargetX:null,initialTargetY:null,initialTargetZ:null,initialZoom:null};var g=d.map((function(e){return e.xy})),y=Object(be.a)(g,(function(e){return e[0]})),O=Object(be.a)(g,(function(e){return e[1]})),j=y[1]-y[0],E=O[1]-O[0],x=function(e){return[Math.min.apply(Math,Object(G.a)(e.map((function(e){return e[0]})))),Math.max.apply(Math,Object(G.a)(e.map((function(e){return e[1]}))))]};0===j&&(j=(y=x(d.map((function(e){return Object(be.a)(e.poly,(function(e){return e[0]}))}))))[1]-y[0]);0===E&&(E=(O=x(d.map((function(e){return Object(be.a)(e.poly,(function(e){return e[1]}))}))))[1]-O[0]);l=y[0]+j/2,c=O[0]+E/2,s=null,u=Math.log2(Math.min(t/j,n/E))-p}return{initialTargetX:l,initialTargetY:c,initialZoom:u,initialTargetZ:s}}({width:He,height:Fe,cells:Ve,imageLayerLoaders:st,useRaster:Boolean(O[L].loaders.raster),use3d:Se}),t=e.initialTargetX,n=e.initialTargetY,r=e.initialTargetZ,a=e.initialZoom;ee(t),ne(n),re(r),Q(a)}}),[st,Ve,T,_,ee,ne,Q,Se]);var dt=Object(i.useMemo)((function(){return ze(nt,$)}),[nt,$]),ft=Object(i.useCallback)((function(e){De(e,$,W,de,ve,me,he)}),[$,W,he,ve,me,de]),mt=Object(i.useMemo)((function(){return Xa({cellColorEncoding:q,expressionData:at&&at[0],geneSelection:V,cellSets:dt,cellSetSelection:Y,cellSetColor:W,expressionDataAttrs:it})}),[q,V,dt,W,Y,at,it]),ht=Object(i.useMemo)((function(){return Array.from(mt.keys())}),[mt]),bt=function(e){var t=e.observationsCount,n=e.observationsLabel,r=e.observationsPluralLabel,a=e.subobservationsCount,o=e.subobservationsLabel,i=e.subobservationsPluralLabel,l=e.locationsCount,c=[];if(a>0){var s="".concat(a," ").concat(H(o,i,a));l>0&&(s+=" at ".concat(Ce()(l)," locations")),c.push(s)}return t>0&&c.push("".concat(t," ").concat(H(n,r,t))),c.join(", ")}({observationsCount:Ye,observationsLabel:c,observationsPluralLabel:u,subobservationsCount:Je,subobservationsLabel:d,subobservationsPluralLabel:m,locationsCount:Ke});return l.a.createElement(Mr,{title:y,info:bt,isSpatial:!0,urls:Te,theme:h,removeGridComponent:r,isReady:Ne,options:l.a.createElement(Ni,{observationsLabel:c,cellColorEncoding:q,setCellColorEncoding:he,setSpatialAxisFixed:ye,spatialAxisFixed:J,use3d:Se})},l.a.createElement(_i,{ref:Be,uuid:t,width:He,height:Fe,viewState:{zoom:w,target:[T,_,k],rotationX:I,rotationY:A,rotationZ:N,rotationOrbit:P,orbitAxis:R},setViewState:function(e){var t=e.zoom,n=e.target,r=e.rotationX,a=e.rotationOrbit,o=e.orbitAxis;Q(t),ee(n[0]),ne(n[1]),re(n[2]),ae(r),oe(a),ie(o)},layers:pt,cells:Ve,cellFilter:X,cellSelection:ht,cellHighlight:Z,cellColors:mt,molecules:$e,neighborhoods:et,imageLayerLoaders:st,setCellFilter:pe,setCellSelection:ft,setCellHighlight:fe,setMoleculeHighlight:ge,setComponentHover:function(){j(t)},updateViewInfo:E,rasterLayersCallbacks:xe,spatialAxisFixed:J}),!v&&l.a.createElement(Pi,{parentUuid:t,cellHighlight:Z,width:He,height:Fe,getCellInfo:function(e){var t=Ve[e];return t?Object(je.a)(Object(D.a)({},"".concat(F(c)," ID"),e),t.factors):null}}))},heatmap:function(e){var t=e.uuid,n=e.coordinationScopes,r=e.removeGridComponent,a=e.theme,c=e.transpose,s=e.observationsLabelOverride,u=void 0===s?"cell":s,p=e.observationsPluralLabelOverride,d=void 0===p?"".concat(u,"s"):p,f=e.variablesLabelOverride,m=void 0===f?"gene":f,h=e.variablesPluralLabelOverride,b=void 0===h?"".concat(m,"s"):h,v=e.disableTooltip,g=void 0!==v&&v,y=e.title,O=void 0===y?"Heatmap":y,j=wn(),E=_n(),x=Nn(t),C=Cn(Jn.heatmap,n),S=Object(o.a)(C,2),L=S[0],w=L.dataset,T=L.heatmapZoomX,_=L.heatmapTargetX,k=L.heatmapTargetY,I=L.geneSelection,A=L.cellHighlight,N=L.geneHighlight,P=L.cellSetSelection,R=L.cellSetColor,M=L.cellColorEncoding,G=L.additionalCellSets,z=L.geneExpressionColormapRange,B=S[1],U=B.setHeatmapZoomX,X=B.setHeatmapZoomY,Z=B.setHeatmapTargetX,V=B.setHeatmapTargetY,Y=B.setCellHighlight,W=B.setGeneHighlight,q=B.setCellSetSelection,$=B.setCellSetColor,J=B.setGeneExpressionColormapRange,K=F(d),Q=F(b),ee=Object(i.useState)(!1),te=Object(o.a)(ee,2),ne=te[0],re=te[1],ae=Un(Vi),oe=Object(o.a)(ae,3),ie=oe[0],le=oe[1],ce=oe[2],se=Xn(),ue=Object(o.a)(se,3),pe=ue[0],de=ue[1],fe=ue[2],me=Bn(),he=Object(o.a)(me,3),be=he[0],ve=he[1],ge=he[2];Object(i.useEffect)((function(){fe(),ce()}),[j,w]);var ye=er(j,w,le,de,!0),Oe=Object(o.a)(ye,1)[0],Ee=nr(j,w,le,de,!0),xe=Object(o.a)(Ee,1)[0],Ce=rr(j,w,le,!1,I),Se=Object(o.a)(Ce,1)[0],Le=tr(j,w,le,de,!1,{setCellSetSelection:q,setCellSetColor:$},{cellSetSelection:P,cellSetColor:R}),we=Object(o.a)(Le,1)[0],Te=Object(i.useMemo)((function(){return ze(we,G)}),[we,G]),_e=Object(i.useMemo)((function(){return Xa({cellColorEncoding:M,expressionData:Se&&Se[0],geneSelection:I,cellSets:Te,cellSetSelection:P,cellSetColor:R,expressionDataAttrs:xe})}),[M,Te,I,R,P,Se,xe]),ke=Object(i.useCallback)((function(e){if(e){var t=Oe[e];return Object(je.a)(Object(D.a)({},"".concat(F(u)," ID"),e),t?t.factors:{})}return null}),[Oe,u]),Ie=Object(i.useCallback)((function(e){return e?Object(D.a)({},"".concat(F(m)," ID"),e):null}),[m]),Ae=xe&&xe.rows?xe.rows.length:0,Ne=xe&&xe.cols?xe.cols.length:0,Pe=_e.size;return l.a.createElement(Mr,{title:O,info:"".concat(Ae," ").concat(H(u,d,Ae)," \xd7 ").concat(Ne," ").concat(H(m,b,Ne),",\n             with ").concat(Pe," ").concat(H(u,d,Pe)," selected"),urls:pe,theme:a,removeGridComponent:r,isReady:ie&&!ne},l.a.createElement(Xi,{ref:ge,transpose:c,viewState:{zoom:T,target:[_,k]},setViewState:function(e){var t=e.zoom,n=e.target;U(t),X(t),Z(n[0]),V(n[1])},heatmapControls:z,setHeatmapControls:J,height:ve,width:be,theme:a,uuid:t,expressionMatrix:xe,cellColors:_e,setIsRendering:re,setCellHighlight:Y,setGeneHighlight:W,setComponentHover:function(){E(t)},updateViewInfo:x,observationsTitle:K,variablesTitle:Q}),!g&&l.a.createElement(Zi,{parentUuid:t,width:be,height:ve,transpose:c,getCellInfo:ke,getGeneInfo:Ie,cellHighlight:A,geneHighlight:N}))},layerController:sc,cellSetSizes:function(e){var t=e.coordinationScopes,n=e.removeGridComponent,r=e.theme,a=e.title,c=void 0===a?"Cell Set Sizes":a,s=wn(),u=Cn(Jn.cellSetSizes,t),p=Object(o.a)(u,2),d=p[0],f=d.dataset,m=d.cellSetSelection,h=d.cellSetColor,b=d.additionalCellSets,v=p[1],g=v.setCellSetSelection,y=v.setCellSetColor,O=Fn(),j=Object(o.a)(O,3),E=j[0],x=j[1],C=j[2],S=Xn(),L=Object(o.a)(S,3),w=L[0],T=L[1],_=L[2],k=Un(wc),I=Object(o.a)(k,3),A=I[0],N=I[1],P=I[2];Object(i.useEffect)((function(){_(),P()}),[s,f]);var R=tr(s,f,N,T,!0,{setCellSetSelection:g,setCellSetColor:y},{cellSetSelection:m,cellSetColor:h}),M=Object(o.a)(R,1)[0],G=Object(i.useMemo)((function(){return ze(M,b)}),[M,b]),D=Object(i.useMemo)((function(){return G&&m&&h?Wt(G,m,h):[]}),[G,m,h]);return l.a.createElement(Mr,{title:c,removeGridComponent:n,urls:w,theme:r,isReady:A},l.a.createElement("div",{ref:C,className:"vega-container"},l.a.createElement(Lc,{data:D,theme:r,width:E,height:x})))},expressionHistogram:function(e){var t=e.coordinationScopes,n=e.removeGridComponent,r=e.theme,a=wn(),c=Cn(Jn.expressionHistogram,t),s=Object(o.a)(c,1)[0],u=s.dataset,p=s.geneSelection,d=Fn(),f=Object(o.a)(d,3),m=f[0],h=f[1],b=f[2],v=Xn(),g=Object(o.a)(v,3),y=g[0],O=g[1],j=g[2],E=Un(Ac),x=Object(o.a)(E,3),C=x[0],S=x[1],L=x[2];Object(i.useEffect)((function(){j(),L()}),[a,u]);var w=nr(a,u,S,O,!0),T=Object(o.a)(w,1)[0],_=rr(a,u,S,!1,p),k=Object(o.a)(_,1)[0],I=p&&p.length>=1?p[0]:null,A=Object(i.useMemo)((function(){if(I&&T&&k)return Array.from(k[0]).map((function(e,t){return{value:100*k[0][t]/255,gene:I}}));if(T){var e=T.cols.length;return T.rows.map((function(t,n){var r=T.matrix.subarray(n*e,(n+1)*e);return{value:100*Object(Tc.a)(r)/255,gene:null}}))}return null}),[T,I,k]);return l.a.createElement(Mr,{title:"Expression Histogram".concat(I?" (".concat(I,")"):""),removeGridComponent:n,urls:y,theme:r,isReady:C},l.a.createElement("div",{ref:b,className:"vega-container"},l.a.createElement(Ic,{geneSelection:p,data:A,theme:r,width:m,height:h})))},genomicProfiles:function(e){var t=e.coordinationScopes,n=e.theme,r=e.removeGridComponent,a=e.profileTrackUidKey,c=void 0===a?"path":a,s=e.profileTrackNameKey,u=void 0===s?null:s,p=e.higlassServer,d=void 0===p?"https://higlass.io/api/v1":p,f=e.assembly,m=void 0===f?"hg38":f,h=e.title,b=void 0===h?"Genomic Profiles":h,v=Fn(),g=Object(o.a)(v,3),y=(g[0],g[1]),j=g[2],E=wn(),x=Cn(Jn.genomicProfiles,t),C=Object(o.a)(x,1)[0],S=C.dataset,L=C.cellSetColor,w=C.cellSetSelection,T=Un(_c),_=Object(o.a)(T,3),k=_[0],I=_[1],A=_[2],N=Xn(),P=Object(o.a)(N,3),R=P[0],M=P[1],D=P[2],z=function(e,t,n,r,a,l,c){var s=Object(i.useState)(),u=Object(o.a)(s,2),p=u[0],d=u[1],f=In();return Object(i.useEffect)((function(){e[t]&&(e[t].loaders["genomic-profiles"]?e[t].loaders["genomic-profiles"].load().catch((function(e){return Kn(e,f)})).then((function(e){if(e){var t=e.data,a=e.url,o=e.coordinationValues;d(t),r(a),Qn(o,l,c),n("genomic-profiles")}})):(d(null),a?Kn(new te(t,"genomic-profiles",null,null),f):n("genomic-profiles")))}),[e,t]),[p]}(E,S,I,M,!0),H=Object(o.a)(z,1)[0],F=Object(i.useMemo)((function(){if(!H||1!==R.length)return null;var e=R[0].url,t="dark"===n?"#C0C0C0":"#000000",r="dark"===n?"#000000":"#f1f1f1",a="dark"===n?"dimgray":"silver",o=[{type:"horizontal-chromosome-labels",server:d,tilesetUid:kc[m].chromosomes,uid:"chromosome-labels",options:{color:t,fontSize:12,fontIsLeftAligned:!1,showMousePosition:!0,mousePositionColor:t},height:30},{type:"horizontal-gene-annotations",server:d,tilesetUid:kc[m].genes,uid:"gene-annotations",options:{name:"Gene Annotations (hg38)",fontSize:10,labelPosition:"hidden",labelLeftMargin:0,labelRightMargin:0,labelTopMargin:0,labelBottomMargin:0,minHeight:24,geneAnnotationHeight:16,geneLabelPosition:"outside",geneStrandSpacing:4,showMousePosition:!0,mousePositionColor:t,plusStrandColor:t,minusStrandColor:t,labelColor:"black",labelBackgroundColor:r,trackBorderWidth:0,trackBorderColor:"black"},height:70}],i=Object(Tc.a)(o.map((function(e){return e.height}))),l=(y-i-10)/H.row_infos.length,s=H.row_infos.map((function(r,o){var i,s=r[c],p=Array.isArray(s),d=u?r[u]:p?s[s.length-1]:s,f=!!p&&(null===w||void 0===w?void 0:w.find((function(e){return O()(e,s)}))),m=p?null===L||void 0===L||null===(i=L.find((function(e){return O()(e.path,s)})))||void 0===i?void 0:i.color:null,h=p?s.join("__"):s,b={type:"horizontal-bar",uid:"bar-track-".concat(h),data:{type:"zarr-multivec",url:e,row:o},options:{name:d,showMousePosition:!0,mousePositionColor:t,labelColor:"dark"===n?"white":"black",labelBackgroundColor:"dark"===n?"black":"white",labelShowAssembly:!1},height:l};if(m&&f){var v=m;b.options.barFillColor="rgb(".concat(v[0],",").concat(v[1],",").concat(v[2],")")}else b.options.barFillColor=a;return b}));return{tracks:{top:[].concat(o,Object(G.a)(s)),left:[],center:[],right:[],bottom:[],whole:[],gallery:[]},layout:{w:12,h:12,x:0,y:0,static:!1}}}),[H,R,n,y,c,u,w,L,d,m]);return Object(i.useEffect)((function(){D(),A()}),[E,S]),l.a.createElement("div",{className:"higlass-title-wrapper"},l.a.createElement(Mr,{title:b,removeGridComponent:r,theme:n,isReady:k,urls:R},l.a.createElement("div",{className:"higlass-lazy-wrapper",ref:j},F?l.a.createElement(gc,{coordinationScopes:t,theme:n,hgViewConfig:F,height:y}):null)))},cellSetExpression:function(e){var t=e.coordinationScopes,n=e.removeGridComponent,r=e.theme,a=wn(),c=Cn(Jn.cellSetExpression,t),s=Object(o.a)(c,2),u=s[0],p=u.dataset,d=u.geneSelection,f=u.geneExpressionTransform,m=u.cellSetSelection,h=u.cellSetColor,b=u.additionalCellSets,v=s[1].setGeneExpressionTransform,g=Fn(),y=Object(o.a)(g,3),O=y[0],j=y[1],E=y[2],x=Xn(),C=Object(o.a)(x,3),S=C[0],L=C[1],w=C[2],T=Un(Mc),_=Object(o.a)(T,3),k=_[0],I=_[1],A=_[2],N=Object(i.useReducer)((function(e){var t=!e;return v(t?"log1p":null),t}),f),P=Object(o.a)(N,2),R=P[0],M=P[1];Object(i.useEffect)((function(){w(),A()}),[a,p]);var G=rr(a,p,I,!1,d),D=Object(o.a)(G,1)[0],z=ar(a,p,I,L,!1),H=Object(o.a)(z,1)[0],F=tr(a,p,I,L,!0),B=Nc(D,H,Object(o.a)(F,1)[0],b,d,m,h,R),U=Object(o.a)(B,3),X=U[0],Z=U[1],V=U[2],Y=d&&d.length>=1?d[0]:null;return l.a.createElement(Mr,{title:"Expression by Cell Set".concat(Y?" (".concat(Y,")"):""),removeGridComponent:n,urls:S,theme:r,isReady:k,options:l.a.createElement(Pc,{useGeneExpressionTransform:R,toggleGeneExpressionTransform:M})},l.a.createElement("div",{ref:E,className:"vega-container"},X?l.a.createElement(Rc,{domainMax:V,colors:Z,data:X,theme:r,width:O,height:j,useGeneExpressionTransform:R}):l.a.createElement("span",null,"Select a gene.")))},higlass:function(e){var t=e.coordinationScopes,n=e.theme,r=e.hgViewConfig,a=e.removeGridComponent,i=Fn(),c=Object(o.a)(i,3),s=(c[0],c[1]),u=c[2],p=Un(yc),d=Object(o.a)(p,3),f=d[0],m=(d[1],d[2],Xn()),h=Object(o.a)(m,3),b=h[0];return h[1],h[2],l.a.createElement("div",{className:"higlass-title-wrapper"},l.a.createElement(Mr,{title:"HiGlass",removeGridComponent:a,theme:n,isReady:f,urls:b},l.a.createElement("div",{className:"higlass-lazy-wrapper",ref:u},l.a.createElement(gc,{coordinationScopes:t,theme:n,hgViewConfig:r,height:s}))))}};function Dc(e){if(void 0===Gc[e])throw new Error('Could not find definition for "'.concat(e,'" in registry.'));return Gc[e]}function zc(e,t){var n,r=Object.keys((null===e||void 0===e||null===(n=e.coordinationSpace)||void 0===n?void 0:n[t])||{}),a=e.layout.map((function(e){var n;return null===(n=e.coordinationScopes)||void 0===n?void 0:n[t]}));return Array.from(new Set([].concat(Object(G.a)(r),Object(G.a)(a))))}function Hc(e){var t=e,n=t,r=n.layout,a=n.datasets;return Object.values(Wn).forEach((function(e){if(!r.every((function(t){var n;return!Jn[t.component].includes(e)||(null===(n=t.coordinationScopes)||void 0===n?void 0:n[e])}))){var n=qn[e];"dataset"===e&&a.length>=1&&(n=a[0].uid),t=$n.includes(e)?function(e,t,n){var r=Object(je.a)({},e,{layout:Object(G.a)(e.layout)}),a={};return r.layout.forEach((function(o,i){var l;if(Jn[o.component].includes(t)&&!(null===(l=o.coordinationScopes)||void 0===l?void 0:l[t])){var c=B([].concat(Object(G.a)(zc(e,t)),Object(G.a)(Object.keys(a))));a[c]=n,r.layout[i]=Object(je.a)({},o,{coordinationScopes:Object(je.a)({},o.coordinationScopes,Object(D.a)({},t,c))})}})),r.coordinationSpace=Object(je.a)({},r.coordinationSpace,Object(D.a)({},t,Object(je.a)({},r.coordinationSpace[t],{},a))),r}(t,e,n):function(e,t,n){var r,a=B(zc(e,t));return Object(je.a)({},e,{coordinationSpace:Object(je.a)({},e.coordinationSpace,Object(D.a)({},t,Object(je.a)({},null===e||void 0===e||null===(r=e.coordinationSpace)||void 0===r?void 0:r[t],Object(D.a)({},a,n)))),layout:e.layout.map((function(e){var n;return Object(je.a)({},e,{coordinationScopes:Object(je.a)({},e.coordinationScopes,{},Jn[e.component].includes(t)&&!(null===(n=e.coordinationScopes)||void 0===n?void 0:n[t])?Object(D.a)({},t,a):{})})}))})}(t,e,n)}})),t}function Fc(e,t,n){var r,a=Object.keys(n["".concat(e,"Zoom")]),i=Object.keys(n["".concat(e,"TargetX")]),l=Object.keys(n["".concat(e,"TargetY")]),c=B(a),s=B(i),u=B(l),p=t.zoom,d=Object(o.a)(t.target,2),f=d[0],m=d[1];return n["".concat(e,"Zoom")][c]=p,n["".concat(e,"TargetX")][s]=f,n["".concat(e,"TargetY")][u]=m,r={},Object(D.a)(r,"".concat(e,"Zoom"),c),Object(D.a)(r,"".concat(e,"TargetX"),s),Object(D.a)(r,"".concat(e,"TargetY"),u),r}function Bc(e,t){if("0.1.0"===e)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={embeddingType:{},embeddingZoom:{},embeddingTargetX:{},embeddingTargetY:{},spatialZoom:{},spatialTargetX:{},spatialTargetY:{}},r=[];e.staticLayout.forEach((function(e){var t,a=Object(je.a)({},e,{coordinationScopes:{}});if("scatterplot"===e.component&&(e.props.mapping&&(n.embeddingType[e.props.mapping]=e.props.mapping,a=Object(je.a)({},a,{coordinationScopes:Object(je.a)({},a.coordinationScopes,{embeddingType:e.props.mapping})})),e.props.view)){var o=Fc("embedding",e.props.view,n);a=Object(je.a)({},a,{coordinationScopes:Object(je.a)({},a.coordinationScopes,{},o)})}if("spatial"===e.component&&(null===e||void 0===e||null===(t=e.props)||void 0===t?void 0:t.view)){var i=Fc("spatial",e.props.view,n);a=Object(je.a)({},a,{coordinationScopes:Object(je.a)({},a.coordinationScopes,{},i)})}r.push(a)}));var a=t||$()();return{version:"1.0.1",name:e.name,description:e.description,public:e.public,datasets:[{uid:a,name:a,files:e.layers.map((function(e){return{type:e.type.toLowerCase(),fileType:e.fileType,url:e.url}}))}],initStrategy:"auto",coordinationSpace:n,layout:r}}(t);if("1.0.0"===e)return function(e){var t=Object(je.a)({},e.coordinationSpace);function n(e){var n="raster"===e;t["spatial".concat(F(e),"Layer").concat(n?"s":"")]={},Object.entries(t.spatialLayers).forEach((function(r){var a=Object(o.a)(r,2),i=a[0],l=a[1];if(Array.isArray(l)&&l.find((function(t){return t.type===e}))){var c=l.filter((function(t){return t.type===e})).map((function(e){var t=Object(je.a)({},e);return delete t.type,t}));t["spatial".concat(F(e),"Layer").concat(n?"s":"")][i]=n?c:c[0]}else t["spatial".concat(F(e),"Layer").concat(n?"s":"")][i]=null}))}t.spatialLayers&&(n("raster"),n("cells"),n("molecules"),n("neighborhoods"),delete t.spatialLayers);var r=e.layout.map((function(e){var t=Object(je.a)({},e);function n(e){var n="raster"===e;Jn[t.component].includes("spatial".concat(F(e),"Layer").concat(n?"s":""))&&(t.coordinationScopes["spatial".concat(F(e),"Layer").concat(n?"s":"")]=t.coordinationScopes.spatialLayers)}return t.coordinationScopes&&t.coordinationScopes.spatialLayers&&(n("raster"),n("cells"),n("molecules"),n("neighborhoods"),delete t.coordinationScopes.spatialLayers),t}));return Object(je.a)({},e,{coordinationSpace:t,layout:r,version:"1.0.1"})}(t);throw new Error("Unable to upgrade from unknown version ".concat(e))}var Uc=Object(b.a)({disableGlobal:!0});function Xc(e){var t=e.config,n=e.rowHeight,r=e.height,a=e.theme,c=e.onWarn,s=e.onConfigChange,u=e.onLoaderChange,p=e.validateOnConfigChange,d=void 0!==p&&p,m=Object(i.useMemo)((function(){if(!t)return[{title:"No such dataset",unformatted:"The dataset configuration could not be found."},!1];if(!t.version)return[{title:"Missing version",unformatted:"The dataset configuration is missing a version, preventing validation."},!1];var e=t;if("0.1.0"===e.version){var n=(new h.a).compile(_);if(!n(e))return[{title:"Config validation failed",preformatted:JSON.stringify(n.errors,null,2)},!1];e=Bc("0.1.0",e)}if("1.0.0"===e.version){var r=(new h.a).addSchema(k).addSchema(I).compile(T);if(!r(e))return[{title:"Config validation failed",preformatted:JSON.stringify(r.errors,null,2)},!1];e=Bc("1.0.0",e)}console.groupCollapsed("\ud83d\ude84 Vitessce (".concat(j.version,") view configuration")),console.info("data:,".concat(JSON.stringify(e))),console.info(JSON.stringify(e,null,2)),console.groupEnd();var a=(new h.a).addSchema(k).addSchema(I).compile(w);return a(e)?[function(e){return"auto"===e.initStrategy?Hc(e):e}(e),!0]:[{title:"Config validation failed",preformatted:JSON.stringify(a.errors,null,2)},!1]}),[t]),b=Object(o.a)(m,2),y=b[0],E=b[1];return Object(i.useEffect)((function(){E&&!O()(y,t)&&s&&s(y)}),[E,t,y,s]),E?l.a.createElement(v.b,{generateClassName:Uc},l.a.createElement(g.a,{theme:L[a]},l.a.createElement(Mn,{config:y,getComponent:Dc,rowHeight:n,height:r,theme:a}),l.a.createElement(Gn,{onWarn:c,onConfigChange:s,onLoaderChange:u,validateOnConfigChange:d}))):l.a.createElement(f,Object.assign({theme:a},y))}n(1310),n(1311),n(1312);function Zc(e){var t=e.response,n=e.theme,r=Object(i.useState)(!0),a=Object(o.a)(r,2),c=a[0],s=a[1],u=Object(i.useRef)();return Object(i.useEffect)((function(){t.then((function(e){u.current=e,s(!1)}))}),[t]),c?l.a.createElement(f,{title:"Loading...",theme:n}):l.a.createElement(u.current)}function Vc(e){return"\n    ok: ".concat(e.ok,"\n    status: ").concat(e.status,"\n    statusText: ").concat(e.statusText,"\n    redirected: ").concat(e.redirected,"\n    type: ").concat(e.type,"\n    url: ").concat(e.url)}n(844),n(610);a.a.render(function(){var e=fetch("config.json").then((function(e){return function(e,t){return e.ok?e.text().then((function(n){try{var r=window.location.href.split("?")[0],a=n.replaceAll("http://localhost/",r),o=JSON.parse(a);return Promise.resolve((function(){return l.a.createElement(Xc,{config:o,theme:t,onConfigChange:void 0,validateOnConfigChange:!1})}))}catch(i){return Promise.resolve((function(){return l.a.createElement(f,{title:"Error parsing JSON",preformatted:Vc(e),unformatted:"".concat(i.message,": ").concat(n),theme:t})}))}})):Promise.resolve((function(){return l.a.createElement(f,{title:"Fetch response not OK",preformatted:Vc(e),theme:t})}))}(e,"light")})).catch((function(e){return Promise.resolve((function(){return l.a.createElement(f,{title:"Error fetching",unformatted:e.message,theme:"light"})}))}));return l.a.createElement(Zc,{response:e,theme:"light"})}(),document.getElementById("vitessce-container"))},177:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#cell-sets","title":"Vitessce cell sets data","type":"object","definitions":{"stringArray":{"type":"array","items":{"type":"string"}},"stringProbabilityTupleArray":{"type":"array","items":{"type":"array","additionalItems":false,"items":[{"type":"string"},{"oneOf":[{"type":"number","minimum":0,"maximum":1},{"type":"null"}]}]}},"colorArray":{"type":"array","items":{"type":"integer","minimum":0,"maximum":255},"minItems":3,"maxItems":3},"treeNodeLeaf":{"type":"object","additionalProperties":false,"required":["name"],"properties":{"name":{"type":"string"},"color":{"$ref":"#/definitions/colorArray"},"set":{"$ref":"#/definitions/stringArray"}}},"treeNodeNonLeaf":{"type":"object","additionalProperties":false,"required":["name"],"properties":{"name":{"type":"string"},"color":{"$ref":"#/definitions/colorArray"},"children":{"type":"array","items":{"$ref":"#/definitions/treeNode"}}}},"treeNode":{"oneOf":[{"$ref":"#/definitions/treeNodeNonLeaf"},{"$ref":"#/definitions/treeNodeLeaf"}]},"version0.1.2":{"type":"object","additionalProperties":false,"required":["version","datatype","tree"],"properties":{"dataset":{"type":"string"},"version":{"type":"string","enum":["0.1.2"]},"datatype":{"type":"string","enum":["cell"]},"tree":{"type":"array","items":{"$ref":"#/definitions/treeNodeNonLeaf"}}}},"treeNodeLeafProbabilistic":{"type":"object","additionalProperties":false,"required":["name"],"properties":{"name":{"type":"string"},"color":{"$ref":"#/definitions/colorArray"},"set":{"$ref":"#/definitions/stringProbabilityTupleArray"}}},"treeNodeNonLeafProbabilistic":{"type":"object","additionalProperties":false,"required":["name"],"properties":{"name":{"type":"string"},"color":{"$ref":"#/definitions/colorArray"},"children":{"type":"array","items":{"$ref":"#/definitions/treeNodeProbabilistic"}}}},"treeNodeProbabilistic":{"oneOf":[{"$ref":"#/definitions/treeNodeNonLeafProbabilistic"},{"$ref":"#/definitions/treeNodeLeafProbabilistic"}]},"version0.1.3":{"type":"object","additionalProperties":false,"required":["version","datatype","tree"],"properties":{"dataset":{"type":"string"},"version":{"type":"string","enum":["0.1.3"]},"datatype":{"type":"string","enum":["cell"]},"tree":{"type":"array","items":{"$ref":"#/definitions/treeNodeNonLeafProbabilistic"}}}}},"oneOf":[{"$ref":"#/definitions/version0.1.2"},{"$ref":"#/definitions/version0.1.3"}]}')},203:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#raster","title":"Vitessce image data","type":"object","definitions":{"transform":{"type":"object","additionalProperties":false,"oneOf":[{"required":["scale","translate"]},{"required":["matrix"]}],"properties":{"scale":{"type":"number"},"translate":{"type":"object","additionalProperties":false,"required":["y","x"],"properties":{"y":{"type":"number"},"x":{"type":"number"}}},"matrix":{"type":"array","items":{"type":"number"},"minItems":16,"maxItems":16}}},"dimensions":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["field","type","values"],"properties":{"field":{"type":"string"},"type":{"type":"string","enum":["quantitative","nominal","ordinal","temporal"]},"values":{"type":["array","null"],"items":{"type":"string"}}}}},"metadata":{"type":"object","additionalProperties":false,"anyOf":[{"required":["dimensions","isPyramid"]},{"required":["transform"]},{"required":["omeTiffOffsetsUrl"]},{"required":["isBitmask"]}],"properties":{"dimensions":{"$ref":"#/definitions/dimensions"},"isPyramid":{"type":"boolean"},"transform":{"$ref":"#/definitions/transform"},"isBitmask":{"type":"boolean"},"omeTiffOffsetsUrl":{"type":"string","format":"uri"}}},"requestInit":{"type":"object","additionalProperties":false,"required":[],"properties":{"method":{"type":"string"},"headers":{"type":"object"},"body":{"type":"string"},"mode":{"type":"string"},"credentials":{"type":"string"},"cache":{"type":"string"},"redirect":{"type":"string"},"referrer":{"type":"string"},"integrity":{"type":"string"}}},"image":{"type":"object","additionalProperties":false,"required":["name","url","type"],"properties":{"name":{"type":"string"},"url":{"type":"string","format":"uri"},"type":{"type":"string"},"metadata":{"$ref":"#/definitions/metadata"},"requestInit":{"$ref":"#/definitions/requestInit"}}}},"additionalProperties":false,"required":["schemaVersion","images"],"properties":{"schemaVersion":{"type":"string"},"usePhysicalSizeScaling":{"type":"boolean","description":"Default is false: passing true in will infer scaling from the reported physcial size"},"renderLayers":{"type":"array","items":{"type":"string"}},"images":{"type":"array","items":{"$ref":"#/definitions/image"}}}}')},211:function(e){e.exports=JSON.parse('{"name":"vitessce","version":"1.1.11","description":"Vitessce app and React component library","author":"C McCallum","homepage":"http://vitessce.io/","license":"MIT","repository":"https://github.com/hubmapconsortium/vitessce/","keywords":["react-component"],"files":["dist","src"],"main":"dist/umd/production/index.min.js","module":"dist/es/production/index.min.js","peerDependencies":{"react":"^16.8.6","react-dom":"^16.8.6"},"dependencies":{"@hms-dbmi/viv":"^0.10.4","@loaders.gl/3d-tiles":"^2.3.0","@loaders.gl/core":"^2.3.0","@loaders.gl/images":"^2.3.0","@loaders.gl/loader-utils":"^2.3.0","@luma.gl/core":"^8.4.0","@material-ui/core":"^4.8.3","@material-ui/icons":"^4.9.1","@turf/boolean-contains":"^6.0.1","@turf/boolean-overlap":"^6.0.1","@turf/boolean-point-in-polygon":"^6.0.1","@turf/boolean-within":"^6.0.1","@turf/centroid":"^6.0.2","@turf/helpers":"^6.1.4","ajv":"^6.10.0","bowser":"^2.11.0","classnames":"^2.2.6","clsx":"^1.1.1","concaveman":"^1.2.0","d3-array":"^2.4.0","d3-dsv":"^1.1.1","d3-force":"^2.1.1","d3-quadtree":"^1.0.7","d3-scale-chromatic":"^1.3.3","deck.gl":"^8.4.0","dynamic-import-polyfill":"^0.1.1","fast-deep-equal":"^3.1.3","glslify":"^7.0.0","higlass":"1.11.4","higlass-register":"^0.3.0","higlass-zarr-datafetchers":"^0.2.0","json2csv":"^4.5.2","lodash":"^4.17.15","lz-string":"^1.4.4","math.gl":"^3.1.3","mathjs":"^9.2.0","nebula.gl":"^0.21.1","package.json":"^2.0.1","prop-types":"^15.7.2","rc-tooltip":"^4.0.3","rc-tree":"2.1.0","react-color":"^2.18.0","react-grid-layout":"^1.1.1","react-vega":"^7.3.0","react-virtualized":"^9.22.2","short-number":"^1.0.6","store":"^2.0.12","tinycolor2":"^1.4.1","uuid":"^3.3.2","vega":"^5.13.0","vega-lite":"^4.13.0","vega-tooltip":"^0.23.0","whatwg-fetch":"^3.0.0","window-pixi":"5.3.3","zarr":"^0.4.0","zustand":"^3.0.2"},"devDependencies":{"@babel/core":"7.9.0","@svgr/webpack":"5.3.1","@typescript-eslint/eslint-plugin":"^2.10.0","@typescript-eslint/parser":"^2.10.0","babel-eslint":"10.0.3","babel-loader":"8.1.0","babel-plugin-glsl":"^1.0.0","babel-plugin-named-asset-import":"^0.3.6","babel-preset-react-app":"^9.1.2","camelcase":"^5.3.1","case-sensitive-paths-webpack-plugin":"2.3.0","concurrently":"^5.3.0","css-loader":"3.4.2","cypress":"^3.6.1","cypress-fail-on-console-error":"^2.0.6","dotenv":"8.2.0","dotenv-expand":"5.1.0","enzyme":"^3.9.0","enzyme-adapter-react-16":"^1.11.2","eslint":"^6.6.0","eslint-config-airbnb":"^17.1.0","eslint-config-react-app":"^5.2.0","eslint-loader":"3.0.3","eslint-plugin-cypress":"^2.2.1","eslint-plugin-flowtype":"4.6.0","eslint-plugin-import":"2.20.0","eslint-plugin-jsx-a11y":"6.2.3","eslint-plugin-react":"7.18.0","eslint-plugin-react-hooks":"^1.6.1","eslint-plugin-vitessce-rules":"file:eslint","expect":"^24.5.0","file-loader":"4.3.0","fs-extra":"^8.1.0","glsl-colormap":"^1.0.1","html-webpack-plugin":"4.0.0-beta.11","http-server":"^0.12.3","identity-obj-proxy":"3.0.0","js-yaml":"^3.13.1","karma":"4.4.1","karma-chrome-launcher":"3.1.0","karma-mocha":"1.3.0","karma-mocha-reporter":"2.2.5","karma-sourcemap-loader":"0.3.7","karma-webpack":"4.0.2","mini-css-extract-plugin":"0.9.0","mocha":"7.1.0","node-sass":"^5.0.0","object.fromentries":"^2.0.2","optimize-css-assets-webpack-plugin":"5.0.3","pnp-webpack-plugin":"1.6.0","postcss-flexbugs-fixes":"4.1.0","postcss-loader":"3.0.0","postcss-normalize":"8.0.1","postcss-preset-env":"6.7.0","postcss-safe-parser":"4.0.1","react":"^16.8.6","react-app-polyfill":"^1.0.6","react-dev-utils":"^10.2.0","react-dom":"^16.8.6","resolve":"1.15.0","resolve-url-loader":"3.1.1","sass-loader":"^10.0.1","semver":"6.3.0","style-loader":"0.23.1","terser-webpack-plugin":"2.3.4","url-loader":"2.3.0","wait-on":"^3.2.0","webpack":"4.41.5","webpack-dev-server":"3.10.2","webpack-node-externals":"^2.5.2","workbox-webpack-plugin":"4.3.1","worker-loader":"^2.0.0"},"resolutions":{"@turf/difference":"6.0.1"},"scripts":{"build-demo:prod":"node scripts/build-demo.js production","build-lib:prod":"node scripts/build-lib.js production","build-demo:dev":"node scripts/build-demo.js development","build-lib:dev":"node scripts/build-lib.js development","build:prod":"npm run build-demo:prod && npm run build-lib:prod","build:dev":"npm run build-demo:dev && npm run build-lib:dev","prepublishOnly":"npm run build-lib:prod","clean":"rm -r dist-demo dist","start":"node scripts/start-demo.js","start:fixtures":"http-server src/loaders/fixtures/ --cors=\\"*\\" -s","start:fixtures-concurrently":"concurrently --kill-others \\"npm run start:fixtures\\"","test":"npm run start:fixtures-concurrently -- --success first \\"karma start scripts/karma.config.js --single-run\\"","test:watch":"npm run start:fixtures-concurrently -- \\"karma start scripts/karma.config.js --auto-watch\\"","cypress:open":"npm run start:fixtures-concurrently -- \\"cypress open\\"","cypress:run":"npm run start:fixtures-concurrently -- --success first --kill-others \\"cypress run\\"","lint-fix":"eslint -c .eslintrc.yml --ext .js --fix src/"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"babel":{"presets":["react-app"],"plugins":["glsl"]}}')},383:function(e,t){},384:function(e,t){},449:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#dataset","title":"Vitessce data set","type":"object","definitions":{"components":{"description":"The layout array defines the views, or components, rendered in the grid.","type":"array","items":{"type":"object","additionalProperties":false,"required":["component","x","y"],"properties":{"component":{"type":"string","description":"Specify a component using a name defined in the component registry."},"props":{"type":"object","description":"Extra prop values for the component."},"x":{"type":"integer"},"y":{"type":"integer"},"w":{"type":"integer"},"h":{"type":"integer"},"coordinationScopes":{"type":"object","description":"Component-level coordination scope mappings define which coordination object values a particular component can read and write, for each coordination type.","additionalProperties":false,"required":[],"properties":{"dataset":{"type":"string"},"embeddingType":{"type":"string"},"embeddingZoom":{"type":"string"},"embeddingRotation":{"type":"string"},"embeddingTargetX":{"type":"string"},"embeddingTargetY":{"type":"string"},"embeddingTargetZ":{"type":"string"},"embeddingCellSetPolygonsVisible":{"type":"string"},"embeddingCellSetLabelsVisible":{"type":"string"},"embeddingCellSetLabelSize":{"type":"string"},"embeddingCellRadius":{"type":"string"},"spatialZoom":{"type":"string"},"spatialRotation":{"type":"string"},"spatialTargetX":{"type":"string"},"spatialTargetY":{"type":"string"},"spatialTargetZ":{"type":"string"},"spatialRotationX":{"type":"string"},"spatialRotationY":{"type":"string"},"spatialRotationZ":{"type":"string"},"spatialRotationOrbit":{"type":"string"},"spatialOrbitAxis":{"type":"string"},"spatialAxisFixed":{"type":"string"},"heatmapZoomX":{"type":"string"},"heatmapZoomY":{"type":"string"},"heatmapTargetX":{"type":"string"},"heatmapTargetY":{"type":"string"},"cellFilter":{"type":"string"},"cellHighlight":{"type":"string"},"cellSetSelection":{"type":"string"},"cellSetHighlight":{"type":"string"},"cellSetColor":{"type":"string"},"geneFilter":{"type":"string"},"geneHighlight":{"type":"string"},"geneSelection":{"type":"string"},"geneExpressionTransform":{"type":"string"},"geneExpressionColormap":{"type":"string"},"geneExpressionColormapRange":{"type":"string"},"cellColorEncoding":{"type":"string"},"spatialRasterLayers":{"type":"string"},"spatialCellsLayer":{"type":"string"},"spatialMoleculesLayer":{"type":"string"},"spatialNeighborhoodsLayer":{"type":"string"},"genomicZoomX":{"type":"string"},"genomicZoomY":{"type":"string"},"genomicTargetX":{"type":"string"},"genomicTargetY":{"type":"string"},"additionalCellSets":{"type":"string"},"moleculeHighlight":{"type":"string"}}}}}},"annDataCellSets":{"type":"array","description":"Array of cell set configuration, following closely the conventions of the tabular schema","items":{"type":"object","additionalProperties":false,"required":["groupName","setName"],"properties":{"groupName":{"type":"string","description":"The display name for the set, like \'Cell Type\' or \'Louvain.\'"},"setName":{"type":"string","description":"The location in the AnnData store for the set, like \'obs/louvain\' or \'obs/celltype.\'"}}}},"annDataCells":{"type":"object","description":"The properties of this object are the configuration for how to layout scatterplots and spatial information","minProperties":1,"additionalProperties":false,"required":[],"properties":{"xy":{"type":"string","description":"The location in the AnnData store of cell centroids, like \'obsm/X_centroids.\'"},"poly":{"type":"string","description":"The location in the AnnData store of cell polygon outlines, like \'obsm/X_polygons.\'"},"factors":{"type":"array","description":"List of locations in the AnnData store of cell sets, like \'obs/louvain\'","items":{"type":"string"}},"mappings":{"patternProperties":{".":{"type":"object","description":"An object containing key-values for mappings like { UMAP: { key: \'obsm/X_umap\', dims: [0, 1] } }.","additionalProperties":false,"required":["key"],"properties":{"key":{"type":"string","description":"Where to look in the AnnData store for this mapping, like \'obsm/X_umap.\'"},"dims":{"type":"array","description":"Which indices of the obsm object to take for a scatterplot, allowing for, for example, different PCs from obsm/X_pca","minItems":2,"maxItems":2,"items":{"type":"number"}}}}}}}},"annDataExpressionMatrix":{"type":"object","description":"The properties of this object are the configuration for how to fetch the cell x genes matrix","additionalProperties":false,"required":["matrix"],"properties":{"matrix":{"type":"string","description":"The location in the AnnData store of the cell x gene matrix, like \'obsm/hvg_subset.\' or \'X\'"},"geneFilter":{"type":"string","description":"The location in the AnnData store of a filter for the genes if using a subset of the data, like \'var.highly_variable.\' if the matrix comes from \'obsm/hvg_subset.\'"},"matrixGeneFilter":{"type":"string","description":"The location in the AnnData store of a filter for the matrix data (used in heatmap and histogram), like \'var.highly_variable.\'\'"}}},"requestInit":{"type":"object","description":"The properties of this object correspond to the parameters of the JavaScript fetch() function.","additionalProperties":false,"required":[],"properties":{"method":{"type":"string"},"headers":{"type":"object"},"body":{"type":"string"},"mode":{"type":"string"},"credentials":{"type":"string"},"cache":{"type":"string"},"redirect":{"type":"string"},"referrer":{"type":"string"},"integrity":{"type":"string"}}},"rasterLayer":{"description":"The properties of this object are the rendering settings for the raster layer.","additionalProperties":false,"required":["channels","colormap","index","opacity"],"properties":{"channels":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["selection"],"properties":{"color":{"type":"array","items":{"type":"number"},"description":"The color to use when rendering this channel under the null colormap."},"selection":{"type":"object","description":"Determines the channel selection, e.g. some Z and time slice."},"slider":{"type":"array","items":{"type":"number"},"description":"Determines the range for color mapping."},"visible":{"type":"boolean","description":"Determines whether this channel of the layer will be rendered in the spatial component."}}}},"colormap":{"oneOf":[{"type":"string","description":"The name of the colormap to use for this layer."},{"type":"null","description":"Use the solid color definitions."}]},"transparentColor":{"oneOf":[{"type":"array","minItems":3,"maxItems":3,"items":{"type":"number","description":"One of R G or B (0 - 255)."},"description":"Determines the color to be set to opacity 0"},{"type":"null","description":"No selection."}]},"index":{"type":"number","description":"The index of the layer among the array of layers available in the image file."},"opacity":{"type":"number"},"modelMatrix":{"oneOf":[{"type":"array","minItems":16,"maxItems":16,"description":"transformation matrix for this layer"},{"type":"null","description":"Use no transformation."}]},"domainType":{"type":"string","enum":["Full","Min/Max"],"description":"Determines the extent of the channel slider input element in the layer controller."},"resolution":{"type":"number","description":"Resolution of 3D volumetric rendering"},"xSlice":{"oneOf":[{"type":"array","minItems":2,"maxItems":2,"description":"Slice bounds"},{"type":"null","description":"No slicing"}]},"renderingMode":{"type":"string","description":"Rendering mode of 3D volumetric rendering"},"ySlice":{"oneOf":[{"type":"array","minItems":2,"maxItems":2,"description":"Slice bounds"},{"type":"null","description":"No slicing"}]},"zSlice":{"oneOf":[{"type":"array","minItems":2,"maxItems":2,"description":"Slice bounds"},{"type":"null","description":"No slicing"}]},"type":{"type":"string"},"use3d":{"type":"boolean"},"visible":{"type":"boolean","description":"Determines whether this entire layer will be rendered in the spatial component."}}},"moleculesLayer":{"type":"object","description":"The properties of this object are the rendering settings for the molecules layer.","additionalProperties":false,"required":["visible","radius","opacity"],"properties":{"visible":{"type":"boolean"},"radius":{"type":"number"},"opacity":{"type":"number"}}},"cellsLayer":{"type":"object","description":"The properties of this object are the rendering settings for the cells layer.","additionalProperties":false,"required":["visible","stroked","radius","opacity"],"properties":{"visible":{"type":"boolean"},"stroked":{"type":"boolean"},"radius":{"type":"number"},"opacity":{"type":"number"}}},"neighborhoodsLayer":{"type":"object","description":"The properties of this object are the rendering settings for the neighborhoods layer.","additionalProperties":false,"required":["visible"],"properties":{"visible":{"type":"boolean"}}},"spatialRasterLayers":{"type":"array","description":"Array of Spatial Layers","items":{"$ref":"#/definitions/rasterLayer"}}},"additionalProperties":false,"required":["version","name","datasets","layout","initStrategy"],"properties":{"name":{"type":"string"},"public":{"type":"boolean"},"description":{"type":"string"},"datasets":{"type":"array","description":"The datasets array defines groups of files, where the files within each dataset reference the same entities (cells, genes, cell sets, etc).","items":{"type":"object","additionalProperties":false,"required":["uid","files"],"properties":{"uid":{"type":"string"},"name":{"type":"string"},"description":{"type":"string"},"files":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["type","fileType"],"properties":{"name":{"type":"string"},"type":{"type":"string"},"fileType":{"type":"string"},"url":{"type":"string"},"options":{"oneOf":[{"$ref":"#/definitions/annDataCellSets"},{"$ref":"https://github.com/hubmapconsortium/vitessce/#raster"},{"$ref":"#/definitions/annDataCells"},{"$ref":"#/definitions/annDataExpressionMatrix"}]},"requestInit":{"$ref":"#/definitions/requestInit"}}}}}}},"coordinationSpace":{"type":"object","description":"The coordination space stores the values for each scope of each coordination object.","additionalProperties":false,"required":[],"properties":{"dataset":{"type":"object","patternProperties":{".":{"type":"string"}}},"embeddingZoom":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"embeddingRotation":{"type":"object","patternProperties":{".":{"type":"number"}}},"embeddingTargetX":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"embeddingTargetY":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"embeddingTargetZ":{"type":"object","patternProperties":{".":{"type":"number"}}},"embeddingType":{"type":"object","patternProperties":{".":{"type":"string"}}},"embeddingCellSetPolygonsVisible":{"type":"object","patternProperties":{".":{"type":"boolean"}}},"embeddingCellSetLabelsVisible":{"type":"object","patternProperties":{".":{"type":"boolean"}}},"embeddingCellSetLabelSize":{"type":"object","patternProperties":{".":{"type":"number"}}},"embeddingCellRadius":{"type":"object","patternProperties":{".":{"type":"number"}}},"spatialZoom":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"spatialRotation":{"type":"object","patternProperties":{".":{"type":"number"}}},"spatialTargetX":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"spatialTargetY":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"spatialTargetZ":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"spatialRotationX":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set. Only useful for 3D viewing."},{"type":"number"}]}}},"spatialRotationY":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set. Only useful for 3D viewing."},{"type":"number"}]}}},"spatialRotationZ":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set. Only useful for 3D viewing."},{"type":"number"}]}}},"spatialRotationOrbit":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set. Only useful for 3D viewing."},{"type":"number"}]}}},"spatialOrbitAxis":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set. Only useful for 3D viewing."},{"type":"string"}]}}},"spatialAxisFixed":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"Whether or not to have a fixed axis for the camera. Only useful for 3D viewing."},{"type":"boolean"}]}}},"spatialRasterLayers":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided and auto layer initialization is enabled, layers will be automatically initialized."},{"$ref":"#/definitions/spatialRasterLayers"}]}}},"spatialCellsLayer":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided and auto layer initialization is enabled, layers will be automatically initialized."},{"$ref":"#/definitions/cellsLayer"}]}}},"spatialNeighborhoodsLayer":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided and auto layer initialization is enabled, layers will be automatically initialized."},{"$ref":"#/definitions/neighborhoodsLayer"}]}}},"spatialMoleculesLayer":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided and auto layer initialization is enabled, layers will be automatically initialized."},{"$ref":"#/definitions/moleculesLayer"}]}}},"heatmapZoomX":{"type":"object","patternProperties":{".":{"type":"number"}}},"heatmapZoomY":{"type":"object","patternProperties":{".":{"type":"number"}}},"heatmapTargetX":{"type":"object","patternProperties":{".":{"type":"number"}}},"heatmapTargetY":{"type":"object","patternProperties":{".":{"type":"number"}}},"cellFilter":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cells will be filtered out initially."},{"type":"array","items":{"type":"string"}}]}}},"cellHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cell will be highlighted initially."},{"type":"string"}]}}},"cellSetSelection":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided and auto cell set initialization is enabled, cell set selections will be automatically initialized."},{"type":"array"}]}}},"cellSetHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cell sets will be highlighted initially."},{"type":"string"}]}}},"cellSetColor":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, cell set colors will be automatically initialized."},{"type":"array","items":{"type":"object","additionalProperties":false,"required":["path","color"],"properties":{"path":{"type":"array","items":{"type":"string"}},"color":{"type":"array","items":{"type":"number"}}}}}]}}},"cellColorEncoding":{"type":"object","patternProperties":{".":{"type":"string"}}},"geneFilter":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no genes will be filtered out initially."},{"type":"array","items":{"type":"string"}}]}}},"geneHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no genes will be highlighted initially."},{"type":"string"}]}}},"geneSelection":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null"},{"type":"array","items":{"type":"string"}}]}}},"geneExpressionTransform":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null"},{"type":"string","pattern":"log1p"}]}}},"geneExpressionColormap":{"type":"object","patternProperties":{".":{"type":"string"}}},"geneExpressionColormapRange":{"type":"object","patternProperties":{".":{"type":"array","items":{"type":"number"}}}},"genomicZoomX":{"type":"object","patternProperties":{".":{"type":"number"}}},"genomicZoomY":{"type":"object","patternProperties":{".":{"type":"number"}}},"genomicTargetX":{"type":"object","patternProperties":{".":{"type":"number"}}},"genomicTargetY":{"type":"object","patternProperties":{".":{"type":"number"}}},"additionalCellSets":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cell will be highlighted initially."},{"$ref":"https://github.com/hubmapconsortium/vitessce/#cell-sets"}]}}},"moleculeHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no molecule will be highlighted initially."},{"type":"string"}]}}}}},"layout":{"$ref":"#/definitions/components"},"initStrategy":{"type":"string","enum":["none","auto"],"description":"The initialization strategy determines how missing coordination objects and coordination scope mappings are initially filled in."},"version":{"type":"string","enum":["1.0.1"],"description":"The schema version for the view config."}}}')},597:function(e,t){},598:function(e,t){},599:function(e,t){},605:function(e,t){},781:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#dataset","title":"Vitessce data set","type":"object","definitions":{"components":{"description":"The layout array defines the views, or components, rendered in the grid.","type":"array","items":{"type":"object","additionalProperties":false,"required":["component","x","y"],"properties":{"component":{"type":"string","description":"Specify a component using a name defined in the component registry."},"props":{"type":"object","description":"Extra prop values for the component."},"x":{"type":"integer"},"y":{"type":"integer"},"w":{"type":"integer"},"h":{"type":"integer"},"coordinationScopes":{"type":"object","description":"Component-level coordination scope mappings define which coordination object values a particular component can read and write, for each coordination type.","additionalProperties":false,"required":[],"properties":{"dataset":{"type":"string"},"embeddingType":{"type":"string"},"embeddingZoom":{"type":"string"},"embeddingRotation":{"type":"string"},"embeddingTargetX":{"type":"string"},"embeddingTargetY":{"type":"string"},"embeddingTargetZ":{"type":"string"},"embeddingCellSetPolygonsVisible":{"type":"string"},"embeddingCellSetLabelsVisible":{"type":"string"},"embeddingCellSetLabelSize":{"type":"string"},"embeddingCellRadius":{"type":"string"},"spatialZoom":{"type":"string"},"spatialRotation":{"type":"string"},"spatialTargetX":{"type":"string"},"spatialTargetY":{"type":"string"},"spatialTargetZ":{"type":"string"},"heatmapZoomX":{"type":"string"},"heatmapZoomY":{"type":"string"},"heatmapTargetX":{"type":"string"},"heatmapTargetY":{"type":"string"},"cellFilter":{"type":"string"},"cellHighlight":{"type":"string"},"cellSetSelection":{"type":"string"},"cellSetHighlight":{"type":"string"},"cellSetColor":{"type":"string"},"geneFilter":{"type":"string"},"geneHighlight":{"type":"string"},"geneSelection":{"type":"string"},"geneExpressionTransform":{"type":"string"},"geneExpressionColormap":{"type":"string"},"geneExpressionColormapRange":{"type":"string"},"cellColorEncoding":{"type":"string"},"spatialLayers":{"type":"string"},"genomicZoomX":{"type":"string"},"genomicZoomY":{"type":"string"},"genomicTargetX":{"type":"string"},"genomicTargetY":{"type":"string"},"additionalCellSets":{"type":"string"},"moleculeHighlight":{"type":"string"}}}}}},"annDataCellSets":{"type":"array","description":"Array of cell set configuration, following closely the conventions of the tabular schema","items":{"type":"object","additionalProperties":false,"required":["groupName","setName"],"properties":{"groupName":{"type":"string","description":"The display name for the set, like \'Cell Type\' or \'Louvain.\'"},"setName":{"type":"string","description":"The location in the AnnData store for the set, like \'obs/louvain\' or \'obs/celltype.\'"}}}},"annDataCells":{"type":"object","description":"The properties of this object are the configuration for how to layout scatterplots and spatial information","minProperties":1,"additionalProperties":false,"required":[],"properties":{"xy":{"type":"string","description":"The location in the AnnData store of cell centroids, like \'obsm/X_centroids.\'"},"poly":{"type":"string","description":"The location in the AnnData store of cell polygon outlines, like \'obsm/X_polygons.\'"},"factors":{"type":"array","description":"List of locations in the AnnData store of cell sets, like \'obs/louvain\'","items":{"type":"string"}},"mappings":{"patternProperties":{".":{"type":"object","description":"An object containing key-values for mappings like { UMAP: { key: \'obsm/X_umap\', dims: [0, 1] } }.","additionalProperties":false,"required":["key"],"properties":{"key":{"type":"string","description":"Where to look in the AnnData store for this mapping, like \'obsm/X_umap.\'"},"dims":{"type":"array","description":"Which indices of the obsm object to take for a scatterplot, allowing for, for example, different PCs from obsm/X_pca","minItems":2,"maxItems":2,"items":{"type":"number"}}}}}}}},"annDataExpressionMatrix":{"type":"object","description":"The properties of this object are the configuration for how to fetch the cell x genes matrix","additionalProperties":false,"required":["matrix"],"properties":{"matrix":{"type":"string","description":"The location in the AnnData store of the cell x gene matrix, like \'obsm/hvg_subset.\' or \'X\'"},"geneFilter":{"type":"string","description":"The location in the AnnData store of a filter for the genes if using a subset of the data, like \'var.highly_variable.\' if the matrix comes from \'obsm/hvg_subset.\'"},"matrixGeneFilter":{"type":"string","description":"The location in the AnnData store of a filter for the matrix data (used in heatmap and histogram), like \'var.highly_variable.\'\'"}}},"requestInit":{"type":"object","description":"The properties of this object correspond to the parameters of the JavaScript fetch() function.","additionalProperties":false,"required":[],"properties":{"method":{"type":"string"},"headers":{"type":"object"},"body":{"type":"string"},"mode":{"type":"string"},"credentials":{"type":"string"},"cache":{"type":"string"},"redirect":{"type":"string"},"referrer":{"type":"string"},"integrity":{"type":"string"}}},"rasterLayer":{"description":"The properties of this object are the rendering settings for the raster layer.","additionalProperties":false,"required":["channels","colormap","index","opacity","type"],"properties":{"channels":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["selection"],"properties":{"color":{"type":"array","items":{"type":"number"},"description":"The color to use when rendering this channel under the null colormap."},"selection":{"type":"object","description":"Determines the channel selection, e.g. some Z and time slice."},"slider":{"type":"array","items":{"type":"number"},"description":"Determines the range for color mapping."},"visible":{"type":"boolean","description":"Determines whether this channel of the layer will be rendered in the spatial component."}}}},"colormap":{"oneOf":[{"type":"string","description":"The name of the colormap to use for this layer."},{"type":"null","description":"Use the solid color definitions."}]},"transparentColor":{"oneOf":[{"type":"array","minItems":3,"maxItems":3,"items":{"type":"number","description":"One of R G or B (0 - 255)."},"description":"Determines the color to be set to opacity 0"},{"type":"null","description":"No selection."}]},"index":{"type":"number","description":"The index of the layer among the array of layers available in the image file."},"modelMatrix":{"oneOf":[{"type":"array","minItems":16,"maxItems":16,"description":"transformation matrix for this layer"},{"type":"null","description":"Use no transformation."}]},"opacity":{"type":"number"},"domainType":{"type":"string","enum":["Full","Min/Max"],"description":"Determines the extent of the channel slider input element in the layer controller."},"type":{"type":"string","enum":["raster"]}}},"moleculesLayer":{"description":"The properties of this object are the rendering settings for the molecules layer.","additionalProperties":false,"required":["visible","radius","opacity","type"],"properties":{"visible":{"type":"boolean"},"radius":{"type":"number"},"opacity":{"type":"number"},"type":{"type":"string","enum":["molecules"]}}},"cellsLayer":{"description":"The properties of this object are the rendering settings for the cells layer.","additionalProperties":false,"required":["visible","stroked","radius","opacity","type"],"properties":{"visible":{"type":"boolean"},"stroked":{"type":"boolean"},"radius":{"type":"number"},"opacity":{"type":"number"},"type":{"type":"string","enum":["cells"]}}},"neighborhoodsLayer":{"description":"The properties of this object are the rendering settings for the neighborhoods layer.","additionalProperties":false,"required":["visible","type"],"properties":{"visible":{"type":"boolean"},"type":{"type":"string","enum":["neighborhoods"]}}},"spatialLayers":{"type":"array","description":"Array of Spatial Layers","items":{"oneOf":[{"$ref":"#/definitions/rasterLayer"},{"$ref":"#/definitions/cellsLayer"},{"$ref":"#/definitions/moleculesLayer"},{"$ref":"#/definitions/neighborhoodsLayer"}]}}},"additionalProperties":false,"required":["version","name","datasets","layout","initStrategy"],"properties":{"name":{"type":"string"},"public":{"type":"boolean"},"description":{"type":"string"},"datasets":{"type":"array","description":"The datasets array defines groups of files, where the files within each dataset reference the same entities (cells, genes, cell sets, etc).","items":{"type":"object","additionalProperties":false,"required":["uid","files"],"properties":{"uid":{"type":"string"},"name":{"type":"string"},"description":{"type":"string"},"files":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["type","fileType"],"properties":{"name":{"type":"string"},"type":{"type":"string"},"fileType":{"type":"string"},"url":{"type":"string"},"options":{"oneOf":[{"$ref":"#/definitions/annDataCellSets"},{"$ref":"https://github.com/hubmapconsortium/vitessce/#raster"},{"$ref":"#/definitions/annDataCells"},{"$ref":"#/definitions/annDataExpressionMatrix"}]},"requestInit":{"$ref":"#/definitions/requestInit"}}}}}}},"coordinationSpace":{"type":"object","description":"The coordination space stores the values for each scope of each coordination object.","additionalProperties":false,"required":[],"properties":{"dataset":{"type":"object","patternProperties":{".":{"type":"string"}}},"embeddingZoom":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"embeddingRotation":{"type":"object","patternProperties":{".":{"type":"number"}}},"embeddingTargetX":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"embeddingTargetY":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"embeddingTargetZ":{"type":"object","patternProperties":{".":{"type":"number"}}},"embeddingType":{"type":"object","patternProperties":{".":{"type":"string"}}},"embeddingCellSetPolygonsVisible":{"type":"object","patternProperties":{".":{"type":"boolean"}}},"embeddingCellSetLabelsVisible":{"type":"object","patternProperties":{".":{"type":"boolean"}}},"embeddingCellSetLabelSize":{"type":"object","patternProperties":{".":{"type":"number"}}},"embeddingCellRadius":{"type":"object","patternProperties":{".":{"type":"number"}}},"spatialZoom":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"spatialRotation":{"type":"object","patternProperties":{".":{"type":"number"}}},"spatialTargetX":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"spatialTargetY":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, value will be automatically set."},{"type":"number"}]}}},"spatialTargetZ":{"type":"object","patternProperties":{".":{"type":"number"}}},"spatialLayers":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided and auto layer initialization is enabled, layers will be automatically initialized."},{"$ref":"#/definitions/spatialLayers"}]}}},"heatmapZoomX":{"type":"object","patternProperties":{".":{"type":"number"}}},"heatmapZoomY":{"type":"object","patternProperties":{".":{"type":"number"}}},"heatmapTargetX":{"type":"object","patternProperties":{".":{"type":"number"}}},"heatmapTargetY":{"type":"object","patternProperties":{".":{"type":"number"}}},"cellFilter":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cells will be filtered out initially."},{"type":"array","items":{"type":"string"}}]}}},"cellHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cell will be highlighted initially."},{"type":"string"}]}}},"cellSetSelection":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided and auto cell set initialization is enabled, cell set selections will be automatically initialized."},{"type":"array"}]}}},"cellSetHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cell sets will be highlighted initially."},{"type":"string"}]}}},"cellSetColor":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, cell set colors will be automatically initialized."},{"type":"array","items":{"type":"object","additionalProperties":false,"required":["path","color"],"properties":{"path":{"type":"array","items":{"type":"string"}},"color":{"type":"array","items":{"type":"number"}}}}}]}}},"cellColorEncoding":{"type":"object","patternProperties":{".":{"type":"string"}}},"geneFilter":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no genes will be filtered out initially."},{"type":"array","items":{"type":"string"}}]}}},"geneHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no genes will be highlighted initially."},{"type":"string"}]}}},"geneSelection":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null"},{"type":"array","items":{"type":"string"}}]}}},"geneExpressionTransform":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null"},{"type":"string","pattern":"log1p"}]}}},"geneExpressionColormap":{"type":"object","patternProperties":{".":{"type":"string"}}},"geneExpressionColormapRange":{"type":"object","patternProperties":{".":{"type":"array","items":{"type":"number"}}}},"genomicZoomX":{"type":"object","patternProperties":{".":{"type":"number"}}},"genomicZoomY":{"type":"object","patternProperties":{".":{"type":"number"}}},"genomicTargetX":{"type":"object","patternProperties":{".":{"type":"number"}}},"genomicTargetY":{"type":"object","patternProperties":{".":{"type":"number"}}},"additionalCellSets":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no cell will be highlighted initially."},{"$ref":"https://github.com/hubmapconsortium/vitessce/#cell-sets"}]}}},"moleculeHighlight":{"type":"object","patternProperties":{".":{"oneOf":[{"type":"null","description":"If null is provided, no molecule will be highlighted initially."},{"type":"string"}]}}}}},"layout":{"$ref":"#/definitions/components"},"initStrategy":{"type":"string","enum":["none","auto"],"description":"The initialization strategy determines how missing coordination objects and coordination scope mappings are initially filled in."},"version":{"type":"string","enum":["1.0.0"],"description":"The schema version for the view config."}}}')},782:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#dataset","title":"Vitessce data set","type":"object","definitions":{"components":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["component","x","y"],"properties":{"component":{"type":"string"},"props":{"type":"object"},"x":{"type":"integer"},"y":{"type":"integer"},"w":{"type":"integer"},"h":{"type":"integer"}}}},"requestInit":{"type":"object","additionalProperties":false,"required":[],"properties":{"method":{"type":"string"},"headers":{"type":"object"},"body":{"type":"string"},"mode":{"type":"string"},"credentials":{"type":"string"},"cache":{"type":"string"},"redirect":{"type":"string"},"referrer":{"type":"string"},"integrity":{"type":"string"}}}},"additionalProperties":false,"required":["version","name","layers"],"properties":{"name":{"type":"string"},"public":{"type":"boolean"},"description":{"type":"string"},"layers":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["name","type","fileType","url"],"properties":{"name":{"type":"string"},"type":{"type":"string"},"fileType":{"type":"string"},"url":{"type":"string"},"requestInit":{"$ref":"#/definitions/requestInit"}}}},"staticLayout":{"$ref":"#/definitions/components"},"version":{"type":"string","enum":["0.1.0"]}}}')},783:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#cells","title":"Vitessce cell data","type":"object","definitions":{"coord":{"type":"array","minItems":2,"maxItems":2,"items":{"type":"number"}},"positiveFloatValues":{"type":"object","patternProperties":{".":{"type":"number","minimum":0}}},"stringValues":{"type":"object","patternProperties":{".":{"type":"string"}}}},"patternProperties":{".":{"additionalProperties":false,"required":[],"properties":{"mappings":{"type":"object","patternProperties":{".":{"$ref":"#/definitions/coord"}}},"xy":{"$ref":"#/definitions/coord"},"genes":{"$ref":"#/definitions/positiveFloatValues"},"factors":{"$ref":"#/definitions/stringValues"},"poly":{"type":"array","items":{"$ref":"#/definitions/coord"}}}}}}')},784:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#molecules","title":"Vitessce molecule data","type":"object","definitions":{"coord":{"type":"array","maxItems":2,"minItems":2,"items":{"type":"number"}}},"patternProperties":{".":{"type":"array","items":{"$ref":"#/definitions/coord"}}}}')},785:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#neighborhoods","title":"Vitessce neighborhood data","type":"object","definitions":{"coord":{"type":"array","maxItems":2,"minItems":2,"items":{"type":"number"}}},"patternProperties":{".":{"additionalProperties":false,"required":["poly"],"properties":{"poly":{"type":"array","maxItems":3,"minItems":3,"items":{"$ref":"#/definitions/coord"}}}}}}')},786:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#genes","title":"Vitessce gene data","type":"object","definitions":{"positiveFloatValues":{"type":"object","patternProperties":{".":{"type":"number","minimum":0}}}},"patternProperties":{".":{"additionalProperties":false,"required":["max","cells"],"properties":{"max":{"type":"number"},"cells":{"$ref":"#/definitions/positiveFloatValues"}}}}}')},787:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#clusters","title":"Vitessce cluster data","type":"object","definitions":{"stringArray":{"type":"array","items":{"type":"string"}},"matrix":{"type":"array","items":{"type":"array","items":{"type":"number","minimum":0,"maximum":1}}}},"additionalProperties":false,"required":["rows","cols","matrix"],"properties":{"rows":{"$ref":"#/definitions/stringArray"},"cols":{"$ref":"#/definitions/stringArray"},"matrix":{"$ref":"#/definitions/matrix"}}}')},808:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://github.com/hubmapconsortium/vitessce/#cell-sets-tabular","title":"Vitessce cell sets data, tabular format","definitions":{"colorArray":{"type":"array","items":{"type":"integer","minimum":0,"maximum":255},"minItems":3,"maxItems":3}},"type":"array","items":{"type":"object","additionalProperties":false,"required":["groupName","setName","obsId"],"properties":{"groupName":{"type":"string"},"setName":{"type":"string"},"setColor":{"$ref":"#/definitions/colorArray"},"obsId":{"type":"string"},"predictionScore":{"oneOf":[{"type":"number","minimum":0,"maximum":1},{"type":"null"}]}}}}')},831:function(e,t,n){e.exports=function(){return n(1281)('!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="./",e(e.s=23)}([function(t,n){t.exports=function(t){var n=typeof t;return null!=t&&("object"==n||"function"==n)}},function(t,n,e){var r=e(6),o=e(3);t.exports=function(t,n,e){return void 0===e&&(e=n,n=void 0),void 0!==e&&(e=(e=o(e))===e?e:0),void 0!==n&&(n=(n=o(n))===n?n:0),r(o(t),n,e)}},function(t,n,e){var r=e(14)();t.exports=r},function(t,n,e){var r=e(0),o=e(7),i=/^\\s+|\\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,f=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(o(t))return NaN;if(r(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=r(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(i,"");var e=c.test(t);return e||f.test(t)?l(t.slice(2),e?2:8):u.test(t)?NaN:+t}},function(t,n,e){var r=e(5),o=e(11),i=e(12),u=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":u&&u in Object(t)?o(t):i(t)}},function(t,n,e){var r=e(8).Symbol;t.exports=r},function(t,n){t.exports=function(t,n,e){return t===t&&(void 0!==e&&(t=t<=e?t:e),void 0!==n&&(t=t>=n?t:n)),t}},function(t,n,e){var r=e(4),o=e(13);t.exports=function(t){return"symbol"==typeof t||o(t)&&"[object Symbol]"==r(t)}},function(t,n,e){var r=e(9),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},function(t,n,e){(function(n){var e="object"==typeof n&&n&&n.Object===Object&&n;t.exports=e}).call(this,e(10))},function(t,n){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(r){"object"===typeof window&&(e=window)}t.exports=e},function(t,n,e){var r=e(5),o=Object.prototype,i=o.hasOwnProperty,u=o.toString,c=r?r.toStringTag:void 0;t.exports=function(t){var n=i.call(t,c),e=t[c];try{t[c]=void 0;var r=!0}catch(f){}var o=u.call(t);return r&&(n?t[c]=e:delete t[c]),o}},function(t,n){var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},function(t,n){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,n,e){var r=e(15),o=e(16),i=e(22);t.exports=function(t){return function(n,e,u){return u&&"number"!=typeof u&&o(n,e,u)&&(e=u=void 0),n=i(n),void 0===e?(e=n,n=0):e=i(e),u=void 0===u?n<e?1:-1:i(u),r(n,e,u,t)}}},function(t,n){var e=Math.ceil,r=Math.max;t.exports=function(t,n,o,i){for(var u=-1,c=r(e((n-t)/(o||1)),0),f=Array(c);c--;)f[i?c:++u]=t,t+=o;return f}},function(t,n,e){var r=e(17),o=e(18),i=e(21),u=e(0);t.exports=function(t,n,e){if(!u(e))return!1;var c=typeof n;return!!("number"==c?o(e)&&i(n,e.length):"string"==c&&n in e)&&r(e[n],t)}},function(t,n){t.exports=function(t,n){return t===n||t!==t&&n!==n}},function(t,n,e){var r=e(19),o=e(20);t.exports=function(t){return null!=t&&o(t.length)&&!r(t)}},function(t,n,e){var r=e(4),o=e(0);t.exports=function(t){if(!o(t))return!1;var n=r(t);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n}},function(t,n){t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},function(t,n){var e=/^(?:0|[1-9]\\d*)$/;t.exports=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<n}},function(t,n,e){var r=e(3);t.exports=function(t){return t?(t=r(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t===t?t:0:0===t?t:0}},function(t,n,e){"use strict";e.r(n);e(1);var r=e(2),o=e.n(r);function i(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var u,c=9728,f=10240,l=10241,a=10242,s=10243,p=33071;i(u={},l,c),i(u,f,c),i(u,a,p),i(u,s,p);function v(t,n){var e,r,i,u=n.tileSize,c=n.tileI,f=n.tileJ,l=n.numCells,a=n.numGenes,s=n.cellOrdering,p=n.cells,v=new Uint8Array(u*u),d=o()(u);return d.forEach((function(n){(r=f*u+n)<l&&(i=p.indexOf(s[r]))>=-1&&d.forEach((function(r){e=t[i*a+(c*u+r)],v[(u-r-1)*u+n]=e}))})),v}function d(t,n){var e,r,i,u,c=n.tileSize,f=n.tileI,l=n.tileJ,a=n.numCells,s=n.numGenes,p=n.cellOrdering,v=n.cells,d=new Uint8Array(c*c),b=o()(c);return b.forEach((function(n){(r=f*c+n)<a&&(u=v.indexOf(p[r]))>=-1&&b.forEach((function(r){e=(i=l*c+r)<s?t[u*s+i]:0,d[(c-n-1)*c+r]=e}))})),d}if("undefined"!==typeof self){const t={getTile:function({curr:t,tileI:n,tileJ:e,tileSize:r,cellOrdering:o,rows:i,cols:u,data:c,transpose:f}){const l=new Uint8Array(c),a=u.length;return[{tile:(f?v:d)(l,{tileSize:r,tileI:n,tileJ:e,numCells:o.length,numGenes:a,cellOrdering:o,cells:i}),buffer:c,curr:t},[c]]}};self.addEventListener("message",n=>{try{const[e,r]=n.data,[o,i]=t[e](r);self.postMessage(o,i)}catch(e){console.warn(e)}})}}]);\n//# sourceMappingURL=6f6f723a7874f4178a42.worker.js.map',null)}},880:function(e,t,n){e.exports=n(1313)},985:function(e,t){},988:function(e,t){},990:function(e,t){}},[[880,1,2]]]);
//# sourceMappingURL=main.482a441f.chunk.js.map